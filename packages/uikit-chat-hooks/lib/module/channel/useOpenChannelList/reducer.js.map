{"version":3,"names":["useReducer","getOpenChannels","mergeObjectArrays","defaultReducer","_ref","action","draft","type","error","value","key","status","channels","forEach","freshChannel","idx","openChannels","findIndex","staleChannel","url","channelUrls","c","splice","clearBeforeAction","useOpenChannelListReducer","loading","refreshing","dispatch","updateChannels","deleteChannels","appendChannels","updateLoading","updateRefreshing","updateError"],"sources":["reducer.ts"],"sourcesContent":["import { useReducer } from 'react';\n\nimport type { SendbirdChannel, SendbirdOpenChannel } from '@sendbird/uikit-utils';\nimport { getOpenChannels, mergeObjectArrays } from '@sendbird/uikit-utils';\n\ntype Action =\n  | {\n      type: 'update_error';\n      value: { error: unknown | null };\n    }\n  | {\n      type: 'update_loading' | 'update_refreshing';\n      value: { status: boolean };\n    }\n  | {\n      type: 'update_channels';\n      value: { channels: SendbirdChannel[] };\n    }\n  | {\n      type: 'delete_channels';\n      value: { channelUrls: string[] };\n    }\n  | {\n      type: 'append_channels';\n      value: { channels: SendbirdChannel[]; clearBeforeAction: boolean };\n    };\n\ntype State = {\n  error: unknown | null;\n  loading: boolean;\n  refreshing: boolean;\n  openChannels: SendbirdOpenChannel[];\n};\n\nconst defaultReducer = ({ ...draft }: State, action: Action) => {\n  switch (action.type) {\n    case 'update_error': {\n      draft.error = action.value.error;\n      break;\n    }\n    case 'update_refreshing':\n    case 'update_loading': {\n      const key = action.type === 'update_loading' ? 'loading' : 'refreshing';\n      draft[key] = action.value.status;\n      break;\n    }\n    case 'update_channels': {\n      getOpenChannels(action.value.channels).forEach((freshChannel) => {\n        const idx = draft.openChannels.findIndex((staleChannel) => staleChannel.url === freshChannel.url);\n        if (idx > -1) draft.openChannels[idx] = freshChannel;\n      });\n      break;\n    }\n    case 'delete_channels': {\n      action.value.channelUrls.forEach((url) => {\n        const idx = draft.openChannels.findIndex((c) => c.url === url);\n        if (idx > -1) draft.openChannels.splice(idx, 1);\n      });\n      break;\n    }\n    case 'append_channels': {\n      const openChannels = getOpenChannels(action.value.channels);\n      if (action.value.clearBeforeAction) {\n        draft.openChannels = openChannels;\n      } else {\n        draft.openChannels = mergeObjectArrays(draft.openChannels, openChannels, 'url');\n      }\n      break;\n    }\n  }\n  return draft;\n};\n\nexport const useOpenChannelListReducer = () => {\n  const [{ error, loading, refreshing, openChannels }, dispatch] = useReducer(defaultReducer, {\n    loading: true,\n    refreshing: false,\n    openChannels: [],\n    error: null,\n  });\n\n  const updateChannels = (channels: SendbirdChannel[]) => {\n    dispatch({ type: 'update_channels', value: { channels } });\n  };\n  const deleteChannels = (channelUrls: string[]) => {\n    dispatch({ type: 'delete_channels', value: { channelUrls } });\n  };\n  const appendChannels = (channels: SendbirdChannel[], clearBeforeAction: boolean) => {\n    dispatch({ type: 'append_channels', value: { channels, clearBeforeAction } });\n  };\n  const updateLoading = (status: boolean) => {\n    dispatch({ type: 'update_loading', value: { status } });\n  };\n  const updateRefreshing = (status: boolean) => {\n    dispatch({ type: 'update_refreshing', value: { status } });\n  };\n\n  const updateError = (error: unknown | null) => {\n    dispatch({ type: 'update_error', value: { error } });\n  };\n\n  return {\n    updateError,\n    updateLoading,\n    updateRefreshing,\n    updateChannels,\n    deleteChannels,\n    appendChannels,\n\n    error,\n    loading,\n    refreshing,\n    openChannels,\n  };\n};\n"],"mappings":"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"}