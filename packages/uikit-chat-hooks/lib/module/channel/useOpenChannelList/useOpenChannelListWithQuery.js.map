{"version":3,"names":["useRef","useAsyncEffect","useFreshCallback","useUniqHandlerId","useChannelHandler","useOpenChannelListReducer","createOpenChannelListQuery","sdk","queryCreator","passedQuery","openChannel","useOpenChannelListWithQuery","userId","options","queryRef","handlerId","error","loading","openChannels","refreshing","updateChannels","appendChannels","deleteChannels","updateRefreshing","updateLoading","updateError","init","uid","_queryRef$current","current","hasNext","channels","next","updateChannel","channel","isOpenChannel","onChannelChanged","onChannelFrozen","onChannelUnfrozen","onChannelDeleted","url","onUserEntered","user","isMe","find","it","refresh","e","_queryRef$current2"],"sources":["useOpenChannelListWithQuery.ts"],"sourcesContent":["import { useRef } from 'react';\n\nimport type { SendbirdBaseChannel, SendbirdChatSDK, SendbirdOpenChannelListQuery } from '@sendbird/uikit-utils';\nimport { useAsyncEffect, useFreshCallback, useUniqHandlerId } from '@sendbird/uikit-utils';\n\nimport { useChannelHandler } from '../../handler/useChannelHandler';\nimport type { UseOpenChannelList, UseOpenChannelListOptions } from '../../types';\nimport { useOpenChannelListReducer } from './reducer';\n\nconst createOpenChannelListQuery = (sdk: SendbirdChatSDK, queryCreator: UseOpenChannelListOptions['queryCreator']) => {\n  const passedQuery = queryCreator?.();\n  if (passedQuery) return passedQuery;\n  return sdk.openChannel.createOpenChannelListQuery({});\n};\n\nexport const useOpenChannelListWithQuery: UseOpenChannelList = (sdk, userId, options) => {\n  const queryRef = useRef<SendbirdOpenChannelListQuery>();\n  const handlerId = useUniqHandlerId('useOpenChannelListWithQuery');\n\n  const {\n    error,\n    loading,\n    openChannels,\n    refreshing,\n    updateChannels,\n    appendChannels,\n    deleteChannels,\n    updateRefreshing,\n    updateLoading,\n    updateError,\n  } = useOpenChannelListReducer();\n\n  const init = useFreshCallback(async (uid?: string) => {\n    if (uid) {\n      queryRef.current = createOpenChannelListQuery(sdk, options?.queryCreator);\n\n      if (queryRef.current?.hasNext) {\n        const channels = await queryRef.current.next();\n        appendChannels(channels, true);\n      }\n    }\n  });\n\n  const updateChannel = (channel: SendbirdBaseChannel) => {\n    if (channel.isOpenChannel()) updateChannels([channel]);\n  };\n\n  useChannelHandler(\n    sdk,\n    handlerId,\n    {\n      onChannelChanged: updateChannel,\n      onChannelFrozen: updateChannel,\n      onChannelUnfrozen: updateChannel,\n      onChannelDeleted: (url) => deleteChannels([url]),\n      onUserEntered: (channel, user) => {\n        const isMe = user.userId === userId;\n        if (isMe && channel.isOpenChannel() && !openChannels.find((it) => it.url === channel.url)) {\n          appendChannels([], true);\n          refresh();\n        }\n      },\n    },\n    'open',\n  );\n\n  useAsyncEffect(async () => {\n    updateLoading(true);\n    updateError(null);\n    try {\n      await init(userId);\n    } catch (e) {\n      updateError(e);\n      appendChannels([], true);\n    } finally {\n      updateLoading(false);\n    }\n  }, [userId]);\n\n  const refresh = useFreshCallback(async () => {\n    updateRefreshing(true);\n    updateError(null);\n    try {\n      await init(userId);\n    } catch (e) {\n      updateError(e);\n      appendChannels([], true);\n    } finally {\n      updateRefreshing(false);\n    }\n  });\n\n  const next = useFreshCallback(async () => {\n    if (queryRef.current?.hasNext) {\n      const channels = await queryRef.current.next();\n      appendChannels(channels, false);\n    }\n  });\n\n  return {\n    error,\n    loading,\n    openChannels,\n    refresh,\n    refreshing,\n    next,\n  };\n};\n"],"mappings":"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"}