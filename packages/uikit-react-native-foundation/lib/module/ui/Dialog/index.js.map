{"version":3,"names":["React","useCallback","useContext","useRef","useForceUpdate","ActionMenu","Alert","BottomSheet","Prompt","AlertContext","createContext","ActionMenuContext","PromptContext","BottomSheetContext","DISMISS_TIMEOUT","DialogProvider","_ref","_workingDialogJob$cur","_workingDialogJob$cur2","_defaultLabels$alert","_workingDialogJob$cur3","_defaultLabels$prompt","_defaultLabels$prompt2","_defaultLabels$prompt3","_workingDialogJob$cur4","defaultLabels","children","waitDismissTimeout","waitDismissPromise","waitDismiss","resolver","current","setTimeout","completeDismiss","clearTimeout","undefined","render","dialogQueue","workingDialogJob","visibleState","isProcessing","Boolean","updateToShow","updateToHide","Promise","resolve","consumeQueue","job","shift","createJob","type","props","jobItem","push","alert","openMenu","openPrompt","openSheet","createElement","Provider","value","onHide","onDismiss","visible","title","menuItems","message","buttons","text","ok","onSubmit","defaultValue","submitLabel","prompt","cancelLabel","cancel","placeholder","sheetItems","HeaderComponent","useActionMenu","context","Error","useAlert","usePrompt","useBottomSheet"],"sources":["index.tsx"],"sourcesContent":["import React, { useCallback, useContext, useRef } from 'react';\n\nimport { useForceUpdate } from '@sendbird/uikit-utils';\n\nimport type { ActionMenuItem } from '../ActionMenu';\nimport ActionMenu from '../ActionMenu';\nimport type { AlertItem } from '../Alert';\nimport Alert from '../Alert';\nimport type { BottomSheetItem } from '../BottomSheet';\nimport BottomSheet from '../BottomSheet';\nimport type { PromptItem } from '../Prompt';\nimport Prompt from '../Prompt';\n\ntype DialogJob =\n  | {\n      type: 'ActionMenu';\n      props: ActionMenuItem;\n    }\n  | {\n      type: 'Alert';\n      props: AlertItem;\n    }\n  | {\n      type: 'Prompt';\n      props: PromptItem;\n    }\n  | {\n      type: 'BottomSheet';\n      props: BottomSheetItem;\n    };\n\ntype DialogPropsBy<T extends DialogJob['type'], U extends DialogJob = DialogJob> = U extends { type: T; props: infer P }\n  ? P\n  : never;\n\ntype DialogContextType = {\n  openMenu: (props: DialogPropsBy<'ActionMenu'>) => void;\n  alert: (props: DialogPropsBy<'Alert'>) => void;\n  openPrompt: (props: DialogPropsBy<'Prompt'>) => void;\n  openSheet: (props: DialogPropsBy<'BottomSheet'>) => void;\n};\n\nconst AlertContext = React.createContext<Pick<DialogContextType, 'alert'> | null>(null);\nconst ActionMenuContext = React.createContext<Pick<DialogContextType, 'openMenu'> | null>(null);\nconst PromptContext = React.createContext<Pick<DialogContextType, 'openPrompt'> | null>(null);\nconst BottomSheetContext = React.createContext<Pick<DialogContextType, 'openSheet'> | null>(null);\n\ntype Props = React.PropsWithChildren<{\n  defaultLabels?: {\n    alert?: { ok?: string };\n    prompt?: { placeholder?: string; ok?: string; cancel?: string };\n  };\n}>;\nconst DISMISS_TIMEOUT = 3000;\nexport const DialogProvider = ({ defaultLabels, children }: Props) => {\n  const waitDismissTimeout = useRef<NodeJS.Timeout>();\n  const waitDismissPromise = useRef<() => void>();\n  const waitDismiss = useCallback((resolver: () => void) => {\n    waitDismissPromise.current = resolver;\n    waitDismissTimeout.current = setTimeout(completeDismiss, DISMISS_TIMEOUT);\n  }, []);\n  const completeDismiss = useCallback(() => {\n    if (waitDismissTimeout.current) clearTimeout(waitDismissTimeout.current);\n    if (waitDismissPromise.current) waitDismissPromise.current();\n    waitDismissTimeout.current = undefined;\n    waitDismissPromise.current = undefined;\n  }, []);\n\n  const render = useForceUpdate();\n  const dialogQueue = useRef<DialogJob[]>([]);\n  const workingDialogJob = useRef<DialogJob>();\n  const visibleState = useRef(false);\n\n  const isProcessing = () => Boolean(workingDialogJob.current);\n  const updateToShow = useCallback(() => {\n    visibleState.current = true;\n    render();\n  }, []);\n  const updateToHide = useCallback((): Promise<void> => {\n    return new Promise((resolve) => {\n      visibleState.current = false;\n      render();\n      waitDismiss(resolve);\n    });\n  }, []);\n  const consumeQueue = useCallback(() => {\n    completeDismiss();\n    const job = dialogQueue.current.shift();\n    if (job) {\n      workingDialogJob.current = job;\n      updateToShow();\n    } else {\n      workingDialogJob.current = undefined;\n    }\n  }, []);\n\n  const createJob =\n    <T extends DialogJob['type']>(type: T) =>\n    (props: DialogPropsBy<T>) => {\n      const jobItem = { type, props } as DialogJob;\n      if (isProcessing()) dialogQueue.current.push(jobItem);\n      else {\n        workingDialogJob.current = jobItem;\n        updateToShow();\n      }\n    };\n\n  const alert = useCallback(createJob('Alert'), []);\n  const openMenu = useCallback(createJob('ActionMenu'), []);\n  const openPrompt = useCallback(createJob('Prompt'), []);\n  const openSheet = useCallback(createJob('BottomSheet'), []);\n\n  return (\n    <AlertContext.Provider value={{ alert }}>\n      <ActionMenuContext.Provider value={{ openMenu }}>\n        <PromptContext.Provider value={{ openPrompt }}>\n          <BottomSheetContext.Provider value={{ openSheet }}>\n            {children}\n            {workingDialogJob.current?.type === 'ActionMenu' && (\n              <ActionMenu\n                onHide={updateToHide}\n                onDismiss={consumeQueue}\n                visible={visibleState.current}\n                title={workingDialogJob.current.props.title}\n                menuItems={workingDialogJob.current.props.menuItems}\n              />\n            )}\n            {workingDialogJob.current?.type === 'Alert' && (\n              <Alert\n                onHide={updateToHide}\n                onDismiss={consumeQueue}\n                visible={visibleState.current}\n                title={workingDialogJob.current.props.title}\n                message={workingDialogJob.current.props.message}\n                buttons={workingDialogJob.current.props.buttons ?? [{ text: defaultLabels?.alert?.ok || 'OK' }]}\n              />\n            )}\n            {workingDialogJob.current?.type === 'Prompt' && (\n              <Prompt\n                onHide={updateToHide}\n                onDismiss={consumeQueue}\n                visible={visibleState.current}\n                title={workingDialogJob.current.props.title}\n                onSubmit={workingDialogJob.current.props.onSubmit}\n                defaultValue={workingDialogJob.current.props.defaultValue}\n                submitLabel={workingDialogJob.current.props.submitLabel ?? defaultLabels?.prompt?.ok}\n                cancelLabel={workingDialogJob.current.props.cancelLabel ?? defaultLabels?.prompt?.cancel}\n                placeholder={workingDialogJob.current.props.placeholder ?? defaultLabels?.prompt?.placeholder}\n              />\n            )}\n            {workingDialogJob.current?.type === 'BottomSheet' && (\n              <BottomSheet\n                onHide={updateToHide}\n                onDismiss={consumeQueue}\n                visible={visibleState.current}\n                sheetItems={workingDialogJob.current.props.sheetItems}\n                HeaderComponent={workingDialogJob.current.props.HeaderComponent}\n              />\n            )}\n          </BottomSheetContext.Provider>\n        </PromptContext.Provider>\n      </ActionMenuContext.Provider>\n    </AlertContext.Provider>\n  );\n};\n\nexport const useActionMenu = () => {\n  const context = useContext(ActionMenuContext);\n  if (!context) throw new Error('ActionMenuContext is not provided, wrap your app with DialogProvider');\n  return context;\n};\nexport const useAlert = () => {\n  const context = useContext(AlertContext);\n  if (!context) throw new Error('AlertContext is not provided, wrap your app with DialogProvider');\n  return context;\n};\nexport const usePrompt = () => {\n  const context = useContext(PromptContext);\n  if (!context) throw new Error('PromptContext is not provided, wrap your app with DialogProvider');\n  return context;\n};\nexport const useBottomSheet = () => {\n  const context = useContext(BottomSheetContext);\n  if (!context) throw new Error('BottomSheetContext is not provided, wrap your app with DialogProvider');\n  return context;\n};\n"],"mappings":"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"}