{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_uikitUtils","_createStyleSheet","_interopRequireDefault","_useUIKitTheme","_Box","_Icon","_ImageWithPlaceholder","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","VideoThumbnail","_ref","fetchThumbnailFromVideoSource","style","source","videoSource","iconSize","palette","select","useUIKitTheme","thumbnail","loading","useRetry","isImage","path","createElement","StyleSheet","absoluteFill","backgroundColor","dark","background400","light","background100","uri","alignItems","justifyContent","icon","size","color","onBackgroundLight02","containerStyle","styles","playIcon","onBackgroundDark01","exports","fetch","retryCount","arguments","length","undefined","state","setState","useState","retryCountRef","useRef","fetchThumbnail","current","useEffect","_timeout","_cancelled","tryFetchThumbnail","timeout","retry","finish","setTimeout","then","result","catch","clearTimeout","createStyleSheet","padding","borderRadius"],"sources":["index.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { StyleProp, StyleSheet, ViewStyle } from 'react-native';\n\nimport { isImage } from '@sendbird/uikit-utils';\n\nimport createStyleSheet from '../../styles/createStyleSheet';\nimport useUIKitTheme from '../../theme/useUIKitTheme';\nimport Box from '../Box';\nimport Icon from '../Icon';\nimport ImageWithPlaceholder from '../ImageWithPlaceholder';\n\ntype Props = {\n  source: string;\n  fetchThumbnailFromVideoSource: (uri: string) => Promise<{ path: string } | null>;\n\n  style?: StyleProp<ViewStyle>;\n  iconSize?: number;\n  /** @deprecated please use `source` prop **/\n  videoSource?: string;\n};\n\nexport const VideoThumbnail = ({ fetchThumbnailFromVideoSource, style, source, videoSource, iconSize = 28 }: Props) => {\n  const { palette, select } = useUIKitTheme();\n  const { thumbnail, loading } = useRetry(async () => {\n    if (isImage(source ?? videoSource)) return { path: source ?? videoSource };\n    return fetchThumbnailFromVideoSource(source ?? videoSource);\n  });\n\n  return (\n    <Box style={style}>\n      {loading ? (\n        <Box\n          style={StyleSheet.absoluteFill}\n          backgroundColor={select({ dark: palette.background400, light: palette.background100 })}\n        />\n      ) : (\n        <ImageWithPlaceholder source={{ uri: thumbnail ?? 'invalid-image' }} style={StyleSheet.absoluteFill} />\n      )}\n\n      {(loading || thumbnail !== null) && iconSize > 0 && (\n        <Box style={StyleSheet.absoluteFill} alignItems={'center'} justifyContent={'center'}>\n          <Icon\n            icon={'play'}\n            size={iconSize}\n            color={palette.onBackgroundLight02}\n            containerStyle={[styles.playIcon, { backgroundColor: palette.onBackgroundDark01 }]}\n          />\n        </Box>\n      )}\n    </Box>\n  );\n};\n\nconst useRetry = (fetch: () => Promise<{ path: string } | null>, retryCount = 5) => {\n  const [state, setState] = useState({ thumbnail: null as null | string, loading: true });\n  const retryCountRef = useRef(0);\n  const fetchThumbnail = useRef(fetch);\n  fetchThumbnail.current = fetch;\n\n  useEffect(() => {\n    let _timeout: NodeJS.Timeout;\n    let _cancelled = false;\n\n    if (!state.thumbnail) {\n      const tryFetchThumbnail = (timeout: number) => {\n        const retry = () => {\n          retryCountRef.current++;\n          tryFetchThumbnail(timeout + 5000);\n        };\n\n        const finish = (path: string | null) => {\n          if (!_cancelled) setState({ loading: false, thumbnail: path });\n        };\n\n        if (retryCountRef.current < retryCount) {\n          _timeout = setTimeout(() => {\n            fetchThumbnail\n              .current()\n              .then((result) => {\n                if (result === null) retry();\n                else finish(result.path);\n              })\n              .catch(() => retry());\n          }, timeout);\n        } else {\n          finish(null);\n        }\n      };\n\n      tryFetchThumbnail(0);\n    }\n\n    return () => {\n      _cancelled = true;\n      clearTimeout(_timeout);\n    };\n  }, [state.thumbnail]);\n\n  return state;\n};\n\nconst styles = createStyleSheet({\n  playIcon: {\n    padding: 10,\n    borderRadius: 50,\n  },\n});\n"],"mappings":"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"}