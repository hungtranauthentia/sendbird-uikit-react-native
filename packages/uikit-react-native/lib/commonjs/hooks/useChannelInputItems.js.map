{"version":3,"names":["_uikitReactNativeFoundation","require","_uikitUtils","_SBUError","_interopRequireDefault","_SBUUtils","_useContext","obj","__esModule","default","useChannelInputItems","channel","sendFileMessage","sbOptions","imageCompressionConfig","useSendbirdChat","STRINGS","useLocalization","fileService","mediaService","usePlatformService","alert","useAlert","toast","useToast","sheetItems","input","useIIFE","isOpenChannel","uikit","openChannel","isGroupChannel","groupChannel","enableDocument","camera","enablePhoto","enableVideo","gallery","push","title","LABELS","CHANNEL_INPUT_ATTACHMENT_CAMERA_PHOTO","icon","onPress","mediaFile","openCamera","mediaType","onOpenFailure","error","code","SBUError","CODE","ERR_PERMISSIONS_DENIED","DIALOG","ALERT_PERMISSIONS_TITLE","message","ALERT_PERMISSIONS_MESSAGE","PERMISSION_CAMERA","PERMISSION_APP_NAME","buttons","text","ALERT_PERMISSIONS_OK","SBUUtils","openSettings","show","TOAST","OPEN_CAMERA_ERROR","isImage","uri","type","shouldCompressImage","chat","imageCompressionEnabled","safeRun","compressed","compressImage","maxWidth","width","maxHeight","height","compressionRate","size","CHANNEL_INPUT_ATTACHMENT_CAMERA_VIDEO","CHANNEL_INPUT_ATTACHMENT_PHOTO_LIBRARY","mediaFiles","openMediaLibrary","selectionLimit","PERMISSION_DEVICE_STORAGE","OPEN_PHOTO_LIBRARY_ERROR","CHANNEL_INPUT_ATTACHMENT_FILES","documentFile","openDocument","OPEN_FILES_ERROR","exports"],"sources":["useChannelInputItems.ts"],"sourcesContent":["import { BottomSheetItem, useAlert, useToast } from '@sendbird/uikit-react-native-foundation';\nimport { SendbirdChannel, isImage, shouldCompressImage, useIIFE } from '@sendbird/uikit-utils';\n\nimport SBUError from '../libs/SBUError';\nimport SBUUtils from '../libs/SBUUtils';\nimport { FileType } from '../platform/types';\nimport { useLocalization, usePlatformService, useSendbirdChat } from './useContext';\n\nexport const useChannelInputItems = (channel: SendbirdChannel, sendFileMessage: (file: FileType) => void) => {\n  const { sbOptions, imageCompressionConfig } = useSendbirdChat();\n  const { STRINGS } = useLocalization();\n  const { fileService, mediaService } = usePlatformService();\n  const { alert } = useAlert();\n  const toast = useToast();\n\n  const sheetItems: BottomSheetItem['sheetItems'] = [];\n  const input = useIIFE(() => {\n    switch (true) {\n      case channel.isOpenChannel():\n        return sbOptions.uikit.openChannel.channel.input;\n      case channel.isGroupChannel():\n        return sbOptions.uikit.groupChannel.channel.input;\n      default:\n        return {\n          enableDocument: true,\n          camera: { enablePhoto: true, enableVideo: true },\n          gallery: { enablePhoto: true, enableVideo: true },\n        };\n    }\n  });\n\n  if (input.camera.enablePhoto) {\n    sheetItems.push({\n      title: STRINGS.LABELS.CHANNEL_INPUT_ATTACHMENT_CAMERA_PHOTO,\n      icon: 'camera',\n      onPress: async () => {\n        const mediaFile = await fileService.openCamera({\n          mediaType: 'photo',\n          onOpenFailure: (error) => {\n            if (error.code === SBUError.CODE.ERR_PERMISSIONS_DENIED) {\n              alert({\n                title: STRINGS.DIALOG.ALERT_PERMISSIONS_TITLE,\n                message: STRINGS.DIALOG.ALERT_PERMISSIONS_MESSAGE(\n                  STRINGS.LABELS.PERMISSION_CAMERA,\n                  STRINGS.LABELS.PERMISSION_APP_NAME,\n                ),\n                buttons: [{ text: STRINGS.DIALOG.ALERT_PERMISSIONS_OK, onPress: () => SBUUtils.openSettings() }],\n              });\n            } else {\n              toast.show(STRINGS.TOAST.OPEN_CAMERA_ERROR, 'error');\n            }\n          },\n        });\n\n        if (mediaFile) {\n          // Image compression\n          if (\n            isImage(mediaFile.uri, mediaFile.type) &&\n            shouldCompressImage(mediaFile.type, sbOptions.chat.imageCompressionEnabled)\n          ) {\n            await SBUUtils.safeRun(async () => {\n              const compressed = await mediaService.compressImage({\n                uri: mediaFile.uri,\n                maxWidth: imageCompressionConfig.width,\n                maxHeight: imageCompressionConfig.height,\n                compressionRate: imageCompressionConfig.compressionRate,\n              });\n\n              if (compressed) {\n                mediaFile.uri = compressed.uri;\n                mediaFile.size = compressed.size;\n              }\n            });\n          }\n\n          sendFileMessage(mediaFile);\n        }\n      },\n    });\n  }\n\n  if (input.camera.enableVideo) {\n    sheetItems.push({\n      title: STRINGS.LABELS.CHANNEL_INPUT_ATTACHMENT_CAMERA_VIDEO,\n      icon: 'camera',\n      onPress: async () => {\n        const mediaFile = await fileService.openCamera({\n          mediaType: 'video',\n          onOpenFailure: (error) => {\n            if (error.code === SBUError.CODE.ERR_PERMISSIONS_DENIED) {\n              alert({\n                title: STRINGS.DIALOG.ALERT_PERMISSIONS_TITLE,\n                message: STRINGS.DIALOG.ALERT_PERMISSIONS_MESSAGE(\n                  STRINGS.LABELS.PERMISSION_CAMERA,\n                  STRINGS.LABELS.PERMISSION_APP_NAME,\n                ),\n                buttons: [{ text: STRINGS.DIALOG.ALERT_PERMISSIONS_OK, onPress: () => SBUUtils.openSettings() }],\n              });\n            } else {\n              toast.show(STRINGS.TOAST.OPEN_CAMERA_ERROR, 'error');\n            }\n          },\n        });\n\n        if (mediaFile) {\n          sendFileMessage(mediaFile);\n        }\n      },\n    });\n  }\n\n  if (input.gallery.enablePhoto || input.gallery.enableVideo) {\n    const mediaType = (() => {\n      switch (true) {\n        case input.gallery.enablePhoto && input.gallery.enableVideo:\n          return 'all';\n        case input.gallery.enablePhoto && !input.gallery.enableVideo:\n          return 'photo';\n        case !input.gallery.enablePhoto && input.gallery.enableVideo:\n          return 'video';\n        default:\n          return 'all';\n      }\n    })();\n\n    sheetItems.push({\n      title: STRINGS.LABELS.CHANNEL_INPUT_ATTACHMENT_PHOTO_LIBRARY,\n      icon: 'photo',\n      onPress: async () => {\n        const mediaFiles = await fileService.openMediaLibrary({\n          selectionLimit: 1,\n          mediaType,\n          onOpenFailure: (error) => {\n            if (error.code === SBUError.CODE.ERR_PERMISSIONS_DENIED) {\n              alert({\n                title: STRINGS.DIALOG.ALERT_PERMISSIONS_TITLE,\n                message: STRINGS.DIALOG.ALERT_PERMISSIONS_MESSAGE(\n                  STRINGS.LABELS.PERMISSION_DEVICE_STORAGE,\n                  STRINGS.LABELS.PERMISSION_APP_NAME,\n                ),\n                buttons: [{ text: STRINGS.DIALOG.ALERT_PERMISSIONS_OK, onPress: () => SBUUtils.openSettings() }],\n              });\n            } else {\n              toast.show(STRINGS.TOAST.OPEN_PHOTO_LIBRARY_ERROR, 'error');\n            }\n          },\n        });\n\n        if (mediaFiles && mediaFiles[0]) {\n          const mediaFile = mediaFiles[0];\n\n          // Image compression\n          if (\n            isImage(mediaFile.uri, mediaFile.type) &&\n            shouldCompressImage(mediaFile.type, sbOptions.chat.imageCompressionEnabled)\n          ) {\n            await SBUUtils.safeRun(async () => {\n              const compressed = await mediaService.compressImage({\n                uri: mediaFile.uri,\n                maxWidth: imageCompressionConfig.width,\n                maxHeight: imageCompressionConfig.height,\n                compressionRate: imageCompressionConfig.compressionRate,\n              });\n\n              if (compressed) {\n                mediaFile.uri = compressed.uri;\n                mediaFile.size = compressed.size;\n              }\n            });\n          }\n\n          sendFileMessage(mediaFile);\n        }\n      },\n    });\n  }\n\n  if (input.enableDocument) {\n    sheetItems.push({\n      title: STRINGS.LABELS.CHANNEL_INPUT_ATTACHMENT_FILES,\n      icon: 'document',\n      onPress: async () => {\n        const documentFile = await fileService.openDocument({\n          onOpenFailure: () => toast.show(STRINGS.TOAST.OPEN_FILES_ERROR, 'error'),\n        });\n\n        if (documentFile) {\n          // Image compression\n          if (\n            isImage(documentFile.uri, documentFile.type) &&\n            shouldCompressImage(documentFile.type, sbOptions.chat.imageCompressionEnabled)\n          ) {\n            await SBUUtils.safeRun(async () => {\n              const compressed = await mediaService.compressImage({\n                uri: documentFile.uri,\n                maxWidth: imageCompressionConfig.width,\n                maxHeight: imageCompressionConfig.height,\n                compressionRate: imageCompressionConfig.compressionRate,\n              });\n\n              if (compressed) {\n                documentFile.uri = compressed.uri;\n                documentFile.size = compressed.size;\n              }\n            });\n          }\n\n          sendFileMessage(documentFile);\n        }\n      },\n    });\n  }\n\n  return sheetItems;\n};\n"],"mappings":"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"}