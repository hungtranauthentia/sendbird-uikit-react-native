{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_reactNativeSafeAreaContext","_uikitReactNativeFoundation","_uikitUtils","_useContext","_FileViewerContent","_interopRequireDefault","_FileViewerFooter","_FileViewerHeader","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","FileViewer","_ref","headerShown","maxZoom","minZoom","headerTopInset","fileMessage","onClose","onPressDownload","onPressDelete","deleteMessage","topInset","statusBarTranslucent","useHeaderStyle","bottom","useSafeAreaInsets","palette","useUIKitTheme","alert","useAlert","show","useToast","fileService","usePlatformService","currentUser","useSendbirdChat","STRINGS","useLocalization","fileType","getFileType","type","getFileExtension","url","canDelete","isMyMessage","userId","basicTopInset","onPressDeleteButton","title","LABELS","CHANNEL_MESSAGE_DELETE_CONFIRM_TITLE","buttons","text","CHANNEL_MESSAGE_DELETE_CONFIRM_CANCEL","CHANNEL_MESSAGE_DELETE_CONFIRM_OK","style","onPress","then","catch","TOAST","DELETE_MSG_ERROR","onPressDownloadButton","toMegabyte","size","DOWNLOAD_START","save","fileUrl","fileName","name","response","DOWNLOAD_OK","Logger","log","err","DOWNLOAD_ERROR","useEffect","createElement","Box","flex","backgroundColor","background700","StatusBar","barStyle","animated","FILE_VIEWER","TITLE","subtitle","SUBTITLE","bottomInset","src","deleteShown","_default","exports"],"sources":["index.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { StatusBar } from 'react-native';\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\n\nimport { Box, useAlert, useHeaderStyle, useToast, useUIKitTheme } from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdFileMessage } from '@sendbird/uikit-utils';\nimport { Logger, getFileExtension, getFileType, isMyMessage, toMegabyte } from '@sendbird/uikit-utils';\n\nimport { useLocalization, usePlatformService, useSendbirdChat } from '../../hooks/useContext';\nimport FileViewerContent from './FileViewerContent';\nimport FileViewerFooter from './FileViewerFooter';\nimport FileViewerHeader from './FileViewerHeader';\n\ntype Props = {\n  fileMessage: SendbirdFileMessage;\n  deleteMessage: () => Promise<void>;\n\n  onClose: () => void;\n  onPressDownload?: (message: SendbirdFileMessage) => void;\n  onPressDelete?: (message: SendbirdFileMessage) => void;\n\n  headerShown?: boolean;\n  headerTopInset?: number;\n\n  /** This prop is only available on the Image viewer */\n  minZoom?: number;\n  /** This prop is only available on the Image viewer */\n  maxZoom?: number;\n};\n\nconst FileViewer = ({\n  headerShown = true,\n  maxZoom = 3,\n  minZoom = 1,\n  headerTopInset,\n  fileMessage,\n  onClose,\n  onPressDownload,\n  onPressDelete,\n  deleteMessage,\n}: Props) => {\n  const { topInset, statusBarTranslucent } = useHeaderStyle();\n  const { bottom } = useSafeAreaInsets();\n  const { palette } = useUIKitTheme();\n  const { alert } = useAlert();\n  const { show } = useToast();\n\n  const { fileService } = usePlatformService();\n  const { currentUser } = useSendbirdChat();\n  const { STRINGS } = useLocalization();\n\n  const fileType = getFileType(fileMessage.type || getFileExtension(fileMessage.url));\n  const canDelete = isMyMessage(fileMessage, currentUser?.userId);\n  const basicTopInset = statusBarTranslucent ? topInset : 0;\n\n  const onPressDeleteButton = () => {\n    if (!canDelete) return;\n\n    if (onPressDelete) {\n      onPressDelete(fileMessage);\n    } else {\n      alert({\n        title: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_TITLE,\n        buttons: [\n          {\n            text: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_CANCEL,\n          },\n          {\n            text: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_OK,\n            style: 'destructive',\n            onPress: () => {\n              deleteMessage()\n                .then(() => {\n                  onClose();\n                })\n                .catch(() => {\n                  show(STRINGS.TOAST.DELETE_MSG_ERROR, 'error');\n                });\n            },\n          },\n        ],\n      });\n    }\n  };\n\n  const onPressDownloadButton = () => {\n    if (onPressDownload) {\n      onPressDownload(fileMessage);\n    } else {\n      if (toMegabyte(fileMessage.size) > 4) {\n        show(STRINGS.TOAST.DOWNLOAD_START, 'success');\n      }\n\n      fileService\n        .save({ fileUrl: fileMessage.url, fileName: fileMessage.name, fileType: fileMessage.type })\n        .then((response) => {\n          show(STRINGS.TOAST.DOWNLOAD_OK, 'success');\n          Logger.log('File saved to', response);\n        })\n        .catch((err) => {\n          show(STRINGS.TOAST.DOWNLOAD_ERROR, 'error');\n          Logger.log('File save failure', err);\n        });\n    }\n  };\n\n  useEffect(() => {\n    if (fileType === 'file') onClose();\n  }, []);\n\n  return (\n    <Box flex={1} backgroundColor={palette.background700}>\n      <StatusBar barStyle={'light-content'} animated />\n      <FileViewerHeader\n        topInset={headerTopInset ?? basicTopInset}\n        headerShown={headerShown}\n        title={STRINGS.FILE_VIEWER.TITLE(fileMessage)}\n        subtitle={STRINGS.FILE_VIEWER.SUBTITLE(fileMessage)}\n        onClose={onClose}\n      />\n      <FileViewerContent\n        topInset={headerTopInset ?? basicTopInset}\n        bottomInset={bottom}\n        type={fileType}\n        src={fileMessage.url}\n        maxZoom={maxZoom}\n        minZoom={minZoom}\n      />\n      <FileViewerFooter\n        bottomInset={bottom}\n        deleteShown={canDelete}\n        onPressDelete={onPressDeleteButton}\n        onPressDownload={onPressDownloadButton}\n      />\n    </Box>\n  );\n};\n\nexport default FileViewer;\n"],"mappings":"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"}