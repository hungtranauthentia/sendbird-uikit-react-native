{"version":3,"names":["_reactNativeZoomableView","require","_react","_interopRequireWildcard","_reactNative","_uikitReactNativeFoundation","_uikitUtils","_useContext","_SBUUtils","_interopRequireDefault","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_extends","assign","bind","target","i","arguments","length","source","apply","FileViewerContent","_ref","type","src","topInset","bottomInset","maxZoom","minZoom","onPress","loading","setLoading","useState","defaultHeight","useHeaderStyle","mediaService","usePlatformService","palette","useUIKitTheme","uri","onLoadEnd","mediaViewer","useIIFE","createElement","ZoomableImageView","style","StyleSheet","absoluteFill","resizeMode","zoomProps","onTouchEnd","VideoComponent","top","bottom","onLoad","Box","styles","container","LoadingSpinner","position","size","color","primary300","_ref2","props","width","height","useWindowDimensions","imageSize","useRef","contentSizeProps","setContentSizeProps","contentWidth","contentHeight","useLayoutEffect","SBUUtils","safeRun","image","current","getImageSize","viewRatio","imageRatio","fitDirection","ratio","actualSize","ReactNativeZoomableView","visualTouchFeedbackEnabled","initialZoom","Image","createStyleSheet","zIndex","flex","alignItems","justifyContent","_default","exports"],"sources":["FileViewerContent.tsx"],"sourcesContent":["import { ReactNativeZoomableView, ReactNativeZoomableViewProps } from '@openspacelabs/react-native-zoomable-view';\nimport React, { useLayoutEffect, useRef, useState } from 'react';\nimport { ImageProps, ImageStyle, ImageURISource, StyleProp, StyleSheet, useWindowDimensions } from 'react-native';\n\nimport {\n  Box,\n  Image,\n  LoadingSpinner,\n  createStyleSheet,\n  useHeaderStyle,\n  useUIKitTheme,\n} from '@sendbird/uikit-react-native-foundation';\nimport { FileType, useIIFE } from '@sendbird/uikit-utils';\n\nimport { usePlatformService } from '../../hooks/useContext';\nimport SBUUtils from '../../libs/SBUUtils';\n\ntype Props = {\n  type: FileType;\n  src: string;\n  topInset?: number;\n  bottomInset?: number;\n  maxZoom?: number;\n  minZoom?: number;\n  onPress?: () => void;\n};\nconst FileViewerContent = ({ type, src, topInset = 0, bottomInset = 0, maxZoom = 4, minZoom = 1, onPress }: Props) => {\n  const [loading, setLoading] = useState(true);\n\n  const { defaultHeight } = useHeaderStyle();\n  const { mediaService } = usePlatformService();\n  const { palette } = useUIKitTheme();\n\n  const source = { uri: src };\n  const onLoadEnd = () => setLoading(false);\n  const mediaViewer = useIIFE(() => {\n    switch (type) {\n      case 'image': {\n        return (\n          <ZoomableImageView\n            source={source}\n            style={StyleSheet.absoluteFill}\n            resizeMode={'contain'}\n            onLoadEnd={onLoadEnd}\n            zoomProps={{\n              minZoom,\n              maxZoom,\n              onTouchEnd: onPress,\n            }}\n          />\n        );\n      }\n\n      case 'video':\n      case 'audio': {\n        return (\n          <mediaService.VideoComponent\n            source={source}\n            style={[StyleSheet.absoluteFill, { top: topInset, bottom: defaultHeight + bottomInset }]}\n            resizeMode={'contain'}\n            onLoad={onLoadEnd}\n          />\n        );\n      }\n\n      default: {\n        return null;\n      }\n    }\n  });\n\n  return (\n    <Box style={styles.container}>\n      {mediaViewer}\n      {loading && <LoadingSpinner style={{ position: 'absolute' }} size={40} color={palette.primary300} />}\n    </Box>\n  );\n};\n\nconst ZoomableImageView = ({\n  zoomProps,\n  ...props\n}: {\n  source: ImageURISource;\n  style: StyleProp<ImageStyle>;\n  resizeMode: ImageProps['resizeMode'];\n  onLoadEnd: () => void;\n  zoomProps?: ReactNativeZoomableViewProps;\n}) => {\n  const { width, height } = useWindowDimensions();\n\n  const imageSize = useRef<{ width: number; height: number }>();\n  const [contentSizeProps, setContentSizeProps] = useState<ReactNativeZoomableViewProps>({\n    contentWidth: width,\n    contentHeight: height,\n  });\n\n  useLayoutEffect(() => {\n    SBUUtils.safeRun(async () => {\n      if (props.source.uri) {\n        const image = imageSize.current ?? (await SBUUtils.getImageSize(props.source.uri));\n        imageSize.current = image;\n\n        const viewRatio = width / height;\n        const imageRatio = image.width / image.height;\n\n        const fitDirection = viewRatio > imageRatio ? 'height' : 'width';\n        const ratio = fitDirection === 'height' ? height / image.height : width / image.width;\n        const actualSize = { width: image.width * ratio, height: image.height * ratio };\n\n        setContentSizeProps({\n          contentWidth: actualSize.width,\n          contentHeight: actualSize.height,\n        });\n      }\n    });\n  }, [props.source.uri, width, height]);\n\n  return (\n    <ReactNativeZoomableView\n      visualTouchFeedbackEnabled={false}\n      style={{ width, height }}\n      initialZoom={1}\n      {...contentSizeProps}\n      {...zoomProps}\n    >\n      <Image {...props} />\n    </ReactNativeZoomableView>\n  );\n};\n\nconst styles = createStyleSheet({\n  container: {\n    zIndex: -1,\n    flex: 1,\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n});\n\nexport default FileViewerContent;\n"],"mappings":"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"}