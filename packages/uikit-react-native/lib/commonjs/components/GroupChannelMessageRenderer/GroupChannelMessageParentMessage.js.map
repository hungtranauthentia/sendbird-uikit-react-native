{"version":3,"names":["_react","_interopRequireWildcard","require","_uikitReactNativeFoundation","_uikitUtils","_moduleContext","_useContext","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","GroupChannelMessageParentMessage","_ref","variant","channel","message","childMessage","onPress","currentUser","useSendbirdChat","groupChannelPubSub","useContext","GroupChannelContexts","PubSub","select","colors","palette","useUIKitTheme","STRINGS","useLocalization","mediaService","usePlatformService","parentMessage","setParentMessage","useState","type","getMessageType","useEffect","subscribe","_ref2","data","updatedParent","messages","find","it","messageId","renderMessageWithText","createElement","Box","style","styles","bubbleContainer","backgroundColor","light","background100","dark","background400","Text","body3","color","onBackground03","suppressHighlighting","numberOfLines","ellipsizeMode","renderFileMessageAsVideoThumbnail","url","VideoThumbnail","image","iconSize","source","fetchThumbnailFromVideoSource","uri","getVideoThumbnail","timeMills","renderFileMessageAsPreview","ImageWithPlaceholder","renderFileMessageAsDownloadable","name","Icon","icon","getFileIconFromMessageType","size","containerStyle","fileIcon","truncate","mode","maxLen","parentMessageComponent","useIIFE","messageOffsetTimestamp","createdAt","LABELS","MESSAGE_UNAVAILABLE","getThumbnailUriFromFileMessage","VOICE_MESSAGE","alignItems","paddingLeft","paddingRight","PressBox","senderLabel","marginRight","caption1","REPLY_FROM_SENDER_TO_RECEIVER","userId","flexDirection","justifyContent","messageContainer","createStyleSheet","opacity","marginTop","marginBottom","maxWidth","overflow","borderRadius","paddingHorizontal","paddingBottom","paddingTop","width","height","_default","exports"],"sources":["GroupChannelMessageParentMessage.tsx"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\n\nimport {\n  Box,\n  Icon,\n  ImageWithPlaceholder,\n  PressBox,\n  Text,\n  VideoThumbnail,\n  createStyleSheet,\n  useUIKitTheme,\n} from '@sendbird/uikit-react-native-foundation';\nimport {\n  SendbirdFileMessage,\n  SendbirdGroupChannel,\n  SendbirdMessage,\n  SendbirdUserMessage,\n  getFileIconFromMessageType,\n  getMessageType,\n  getThumbnailUriFromFileMessage,\n  truncate,\n  useIIFE,\n} from '@sendbird/uikit-utils';\n\nimport { GroupChannelContexts } from '../../domain/groupChannel/module/moduleContext';\nimport { useLocalization, usePlatformService, useSendbirdChat } from '../../hooks/useContext';\n\ntype Props = {\n  variant: 'outgoing' | 'incoming';\n  channel: SendbirdGroupChannel;\n  message: SendbirdUserMessage | SendbirdFileMessage;\n  childMessage: SendbirdUserMessage | SendbirdFileMessage;\n  onPress?: (message: SendbirdMessage) => void;\n};\n\nconst GroupChannelMessageParentMessage = ({ variant, channel, message, childMessage, onPress }: Props) => {\n  const { currentUser } = useSendbirdChat();\n  const groupChannelPubSub = useContext(GroupChannelContexts.PubSub);\n  const { select, colors, palette } = useUIKitTheme();\n  const { STRINGS } = useLocalization();\n  const { mediaService } = usePlatformService();\n\n  const [parentMessage, setParentMessage] = useState(() => message);\n  const type = getMessageType(parentMessage);\n\n  useEffect(() => {\n    return groupChannelPubSub.subscribe(({ type, data }) => {\n      if (type === 'MESSAGES_UPDATED') {\n        const updatedParent = data.messages.find((it): it is SendbirdUserMessage | SendbirdFileMessage => {\n          return it.messageId === parentMessage.messageId;\n        });\n        if (updatedParent) setParentMessage(updatedParent);\n      }\n    });\n  }, []);\n\n  const renderMessageWithText = (message: string) => {\n    return (\n      <Box\n        style={styles.bubbleContainer}\n        backgroundColor={select({ light: palette.background100, dark: palette.background400 })}\n      >\n        <Text body3 color={colors.onBackground03} suppressHighlighting numberOfLines={2} ellipsizeMode={'tail'}>\n          {message}\n        </Text>\n      </Box>\n    );\n  };\n\n  const renderFileMessageAsVideoThumbnail = (url: string) => {\n    return (\n      <VideoThumbnail\n        style={styles.image}\n        iconSize={18}\n        source={url}\n        fetchThumbnailFromVideoSource={(uri) => mediaService.getVideoThumbnail({ url: uri, timeMills: 1000 })}\n      />\n    );\n  };\n  const renderFileMessageAsPreview = (url: string) => {\n    return <ImageWithPlaceholder style={styles.image} source={{ uri: url }} />;\n  };\n  const renderFileMessageAsDownloadable = (name: string) => {\n    return (\n      <Box\n        style={styles.bubbleContainer}\n        backgroundColor={select({ light: palette.background100, dark: palette.background400 })}\n      >\n        <Icon\n          icon={getFileIconFromMessageType(type)}\n          size={16}\n          color={colors.onBackground03}\n          containerStyle={styles.fileIcon}\n        />\n        <Text body3 color={colors.onBackground03} numberOfLines={1} ellipsizeMode={'middle'}>\n          {truncate(name, { mode: 'mid', maxLen: 20 })}\n        </Text>\n      </Box>\n    );\n  };\n\n  const parentMessageComponent = useIIFE(() => {\n    if (channel.messageOffsetTimestamp > parentMessage.createdAt) {\n      return renderMessageWithText(STRINGS.LABELS.MESSAGE_UNAVAILABLE);\n    }\n\n    switch (type) {\n      case 'user':\n      case 'user.opengraph': {\n        return renderMessageWithText((parentMessage as SendbirdUserMessage).message);\n      }\n      case 'file':\n      case 'file.audio': {\n        return renderFileMessageAsDownloadable((parentMessage as SendbirdFileMessage).name);\n      }\n      case 'file.video': {\n        return renderFileMessageAsVideoThumbnail(getThumbnailUriFromFileMessage(parentMessage as SendbirdFileMessage));\n      }\n      case 'file.image': {\n        return renderFileMessageAsPreview(getThumbnailUriFromFileMessage(parentMessage as SendbirdFileMessage));\n      }\n      case 'file.voice': {\n        return renderMessageWithText(STRINGS.LABELS.VOICE_MESSAGE);\n      }\n      default: {\n        return null;\n      }\n    }\n  });\n\n  return (\n    <Box>\n      <Box\n        alignItems={variant === 'outgoing' ? 'flex-end' : 'flex-start'}\n        paddingLeft={variant === 'outgoing' ? 0 : 12}\n        paddingRight={variant === 'outgoing' ? 12 : 0}\n      >\n        <PressBox onPress={() => onPress?.(parentMessage)} style={styles.senderLabel}>\n          <Icon icon={'reply-filled'} size={13} color={colors.onBackground03} containerStyle={{ marginRight: 4 }} />\n          <Text caption1 color={colors.onBackground03}>\n            {STRINGS.LABELS.REPLY_FROM_SENDER_TO_RECEIVER(childMessage, parentMessage, currentUser?.userId)}\n          </Text>\n        </PressBox>\n      </Box>\n      <Box\n        flexDirection={'row'}\n        justifyContent={variant === 'outgoing' ? 'flex-end' : 'flex-start'}\n        style={styles.messageContainer}\n      >\n        <PressBox onPress={() => onPress?.(parentMessage)}>{parentMessageComponent}</PressBox>\n      </Box>\n    </Box>\n  );\n};\n\nconst styles = createStyleSheet({\n  messageContainer: {\n    opacity: 0.5,\n    marginTop: 4,\n    marginBottom: -6,\n  },\n  bubbleContainer: {\n    maxWidth: 220,\n    overflow: 'hidden',\n    flexDirection: 'row',\n    alignItems: 'center',\n    borderRadius: 16,\n    paddingHorizontal: 12,\n    paddingBottom: 12,\n    paddingTop: 6,\n  },\n  image: {\n    width: 156,\n    height: 104,\n    borderRadius: 16,\n    overflow: 'hidden',\n  },\n  fileIcon: {\n    width: 16,\n    height: 16,\n    borderRadius: 10,\n    marginRight: 4,\n    marginTop: 2,\n  },\n  senderLabel: {\n    flexDirection: 'row',\n  },\n});\n\nexport default GroupChannelMessageParentMessage;\n"],"mappings":"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"}