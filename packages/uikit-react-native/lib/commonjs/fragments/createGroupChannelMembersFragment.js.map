{"version":3,"names":["_react","_interopRequireWildcard","require","_uikitChatHooks","_uikitReactNativeFoundation","_uikitUtils","_StatusComposition","_interopRequireDefault","_UserActionBar","_createUserListModule","_useContext","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","RETURN_EMPTY_STRING","createGroupChannelMembersFragment","initModule","UserListModule","createUserListModule","_ref","channel","onPressHeaderLeft","onPressHeaderRight","renderUser","sortComparator","queryCreator","createMemberListQuery","limit","handlerId","useUniqHandlerId","refreshSchedule","useRef","STRINGS","useLocalization","sdk","currentUser","useSendbirdChat","openMenu","useActionMenu","show","useUserProfile","users","refresh","loading","next","error","upsertUser","deleteUser","useUserList","useChannelHandler","onUserLeft","eventChannel","user","isDifferentChannel","userId","onUserBanned","onOperatorUpdated","current","clearTimeout","setTimeout","onUserMuted","isGroupChannel","memberFromChannel","members","find","it","memberFromList","isMuted","onUserUnmuted","_renderUser","useFreshCallback","selectedUsers","setSelectedUsers","createElement","muted","uri","profileUrl","label","role","LABELS","USER_BAR_OPERATOR","name","nickname","USER_NO_NAME","USER_BAR_ME_POSTFIX","disabled","onPressActionMenu","ifOperator","myRole","menuItems","push","title","UNREGISTER_OPERATOR","REGISTER_AS_OPERATOR","onPress","removeOperators","addOperators","isBroadcast","ifThenOr","UNMUTE","MUTE","unmuteUser","muteUser","BAN","style","banUser","onPressAvatar","Provider","headerRight","headerTitle","GROUP_CHANNEL_MEMBERS","HEADER_TITLE","Header","shouldActivateHeaderRight","right","Icon","icon","LoadingComponent","StatusLoading","Boolean","ErrorComponent","StatusError","onPressRetry","List","onLoadNext","ListEmptyComponent","StatusEmpty","_default","exports"],"sources":["createGroupChannelMembersFragment.tsx"],"sourcesContent":["import React, { useRef } from 'react';\n\nimport { useChannelHandler, useUserList } from '@sendbird/uikit-chat-hooks';\nimport type { ActionMenuItem } from '@sendbird/uikit-react-native-foundation';\nimport { Icon, useActionMenu } from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdMember } from '@sendbird/uikit-utils';\nimport { ifOperator, ifThenOr, isDifferentChannel, useFreshCallback, useUniqHandlerId } from '@sendbird/uikit-utils';\n\nimport StatusComposition from '../components/StatusComposition';\nimport UserActionBar from '../components/UserActionBar';\nimport type { GroupChannelMembersFragment } from '../domain/groupChannelUserList/types';\nimport createUserListModule from '../domain/userList/module/createUserListModule';\nimport type { UserListModule } from '../domain/userList/types';\nimport { useLocalization, useSendbirdChat, useUserProfile } from '../hooks/useContext';\n\nconst RETURN_EMPTY_STRING = () => '';\n\nconst createGroupChannelMembersFragment = (\n  initModule?: Partial<UserListModule<SendbirdMember>>,\n): GroupChannelMembersFragment => {\n  const UserListModule = createUserListModule<SendbirdMember>(initModule);\n\n  return ({\n    channel,\n    onPressHeaderLeft,\n    onPressHeaderRight,\n    renderUser,\n    sortComparator,\n    queryCreator = () => channel.createMemberListQuery({ limit: 20 }),\n  }) => {\n    const handlerId = useUniqHandlerId('GroupChannelMembersFragment');\n\n    const refreshSchedule = useRef<NodeJS.Timeout>();\n    const { STRINGS } = useLocalization();\n    const { sdk, currentUser } = useSendbirdChat();\n    const { openMenu } = useActionMenu();\n    const { show } = useUserProfile();\n\n    const { users, refresh, loading, next, error, upsertUser, deleteUser } = useUserList(sdk, {\n      queryCreator,\n      sortComparator,\n    });\n\n    useChannelHandler(sdk, handlerId, {\n      onUserLeft(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        deleteUser(user.userId);\n      },\n      onUserBanned(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        deleteUser(user.userId);\n      },\n      onOperatorUpdated(eventChannel) {\n        if (isDifferentChannel(eventChannel, channel)) return;\n        if (refreshSchedule.current) clearTimeout(refreshSchedule.current);\n        refreshSchedule.current = setTimeout(() => refresh(), 500);\n      },\n      onUserMuted(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel) || !eventChannel.isGroupChannel()) return;\n\n        const memberFromChannel = eventChannel.members.find((it) => it.userId === user.userId);\n        if (memberFromChannel) return upsertUser(memberFromChannel);\n\n        const memberFromList = users.find((it) => it.userId === user.userId);\n        if (memberFromList) {\n          memberFromList.isMuted = true;\n          upsertUser(memberFromList);\n        }\n      },\n      onUserUnmuted(eventChannel, user) {\n        if (isDifferentChannel(eventChannel, channel) || !eventChannel.isGroupChannel()) return;\n\n        const memberFromChannel = eventChannel.members.find((it) => it.userId === user.userId);\n        if (memberFromChannel) return upsertUser(memberFromChannel);\n\n        const memberFromList = users.find((it) => it.userId === user.userId);\n        if (memberFromList) {\n          memberFromList.isMuted = false;\n          upsertUser(memberFromList);\n        }\n      },\n    });\n\n    const _renderUser: NonNullable<typeof renderUser> = useFreshCallback((user, selectedUsers, setSelectedUsers) => {\n      if (renderUser) return renderUser(user, selectedUsers, setSelectedUsers);\n\n      return (\n        <UserActionBar\n          muted={user.isMuted}\n          uri={user.profileUrl}\n          label={user.role === 'operator' ? STRINGS.LABELS.USER_BAR_OPERATOR : ''}\n          name={\n            (user.nickname || STRINGS.LABELS.USER_NO_NAME) +\n            (user.userId === currentUser?.userId ? STRINGS.LABELS.USER_BAR_ME_POSTFIX : '')\n          }\n          disabled={user.userId === currentUser?.userId}\n          onPressActionMenu={ifOperator(channel.myRole, () => {\n            const menuItems: ActionMenuItem['menuItems'] = [];\n\n            menuItems.push({\n              title: ifOperator(user.role, STRINGS.LABELS.UNREGISTER_OPERATOR, STRINGS.LABELS.REGISTER_AS_OPERATOR),\n              onPress: ifOperator(\n                user.role,\n                () => channel.removeOperators([user.userId]),\n                () => channel.addOperators([user.userId]),\n              ),\n            });\n\n            if (!channel.isBroadcast) {\n              menuItems.push({\n                title: ifThenOr(user.isMuted, STRINGS.LABELS.UNMUTE, STRINGS.LABELS.MUTE),\n                onPress: ifThenOr(\n                  user.isMuted,\n                  () => channel.unmuteUser(user),\n                  () => channel.muteUser(user),\n                ),\n              });\n            }\n\n            menuItems.push({\n              title: STRINGS.LABELS.BAN,\n              style: 'destructive',\n              onPress: () => channel.banUser(user),\n            });\n\n            openMenu({ title: user.nickname || STRINGS.LABELS.USER_NO_NAME, menuItems });\n          })}\n          onPressAvatar={() => show(user)}\n        />\n      );\n    });\n\n    return (\n      <UserListModule.Provider\n        headerRight={RETURN_EMPTY_STRING}\n        headerTitle={STRINGS.GROUP_CHANNEL_MEMBERS.HEADER_TITLE}\n      >\n        <UserListModule.Header\n          shouldActivateHeaderRight={() => true}\n          onPressHeaderLeft={onPressHeaderLeft}\n          right={<Icon icon={'plus'} />}\n          onPressHeaderRight={async () => onPressHeaderRight()}\n        />\n        <StatusComposition\n          loading={loading}\n          LoadingComponent={<UserListModule.StatusLoading />}\n          error={Boolean(error)}\n          ErrorComponent={<UserListModule.StatusError onPressRetry={refresh} />}\n        >\n          <UserListModule.List\n            users={users}\n            renderUser={_renderUser}\n            onLoadNext={next}\n            ListEmptyComponent={<UserListModule.StatusEmpty />}\n          />\n        </StatusComposition>\n      </UserListModule.Provider>\n    );\n  };\n};\n\nexport default createGroupChannelMembersFragment;\n"],"mappings":"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"}