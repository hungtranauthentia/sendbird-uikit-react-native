{"version":3,"names":["_react","_interopRequireWildcard","require","_chat","_uikitChatHooks","_uikitReactNativeFoundation","_uikitUtils","_OpenChannelMessageRenderer","_interopRequireDefault","_ScrollToBottomButton","_StatusComposition","_constants","_openChannel","_useContext","_pubsub","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","createOpenChannelFragment","initModule","OpenChannelModule","createOpenChannelModule","_ref","channel","onChannelDeleted","NOOP","onPressHeaderLeft","onPressHeaderRightWithSettings","onPressHeaderRightWithParticipants","onBeforeSendUserMessage","PASS","onBeforeSendFileMessage","onBeforeUpdateUserMessage","onBeforeUpdateFileMessage","onPressMediaMessage","renderMessage","renderNewMessagesButton","renderScrollToBottomButton","props","createElement","enableMessageGrouping","keyboardAvoidOffset","flatListProps","queryCreator","sortComparator","messageComparator","sdk","currentUser","useSendbirdChat","STRINGS","useLocalization","show","showToast","useToast","openChannelPubSub","useState","pubsub","messages","newMessages","next","prev","hasNext","sendFileMessage","sendUserMessage","updateFileMessage","updateUserMessage","resendMessage","deleteMessage","loading","useOpenChannelMessages","userId","onError","error","SendbirdError","code","SBErrorCode","RESOURCE_NOT_FOUND","CHANNEL_NOT_FOUND","BANNED_USER_SEND_MESSAGE_NOT_ALLOWED","TOAST","GET_CHANNEL_ERROR","UNKNOWN_ERROR","onMessagesReceived","publish","type","data","isOperator","UNKNOWN_USER_ID","_renderMessage","useFreshCallback","memoizedFlatListProps","useMemo","ListEmptyComponent","StatusEmpty","contentContainerStyle","flexGrow","onPending","message","onSent","onPressSendUserMessage","params","processedParams","onPressSendFileMessage","onPressUpdateUserMessage","messageId","onPressUpdateFileMessage","Provider","Header","rightIconName","onPressHeaderRight","LoadingComponent","StatusLoading","MessageList","currentUserId","onTopReached","onBottomReached","scrolledAwayFromBottom","onScrolledAwayFromBottom","onResendFailedMessage","onDeleteMessage","Input","shouldRenderInput","_default","exports"],"sources":["createOpenChannelFragment.tsx"],"sourcesContent":["import React, { useMemo, useState } from 'react';\n\nimport { SendbirdError } from '@sendbird/chat';\nimport { useOpenChannelMessages } from '@sendbird/uikit-chat-hooks';\nimport { useToast } from '@sendbird/uikit-react-native-foundation';\nimport {\n  NOOP,\n  PASS,\n  SBErrorCode,\n  SendbirdFileMessage,\n  SendbirdUserMessage,\n  messageComparator,\n  useFreshCallback,\n} from '@sendbird/uikit-utils';\n\nimport OpenChannelMessageRenderer from '../components/OpenChannelMessageRenderer';\nimport ScrollToBottomButton from '../components/ScrollToBottomButton';\nimport StatusComposition from '../components/StatusComposition';\nimport { UNKNOWN_USER_ID } from '../constants';\nimport { createOpenChannelModule } from '../domain/openChannel';\nimport type {\n  OpenChannelFragment,\n  OpenChannelModule,\n  OpenChannelProps,\n  OpenChannelPubSubContextPayload,\n} from '../domain/openChannel/types';\nimport { useLocalization, useSendbirdChat } from '../hooks/useContext';\nimport pubsub from '../utils/pubsub';\n\nconst createOpenChannelFragment = (initModule?: Partial<OpenChannelModule>): OpenChannelFragment => {\n  const OpenChannelModule = createOpenChannelModule(initModule);\n\n  return ({\n    channel,\n    onChannelDeleted = NOOP,\n    onPressHeaderLeft = NOOP,\n    onPressHeaderRightWithSettings = NOOP,\n    onPressHeaderRightWithParticipants = NOOP,\n\n    onBeforeSendUserMessage = PASS,\n    onBeforeSendFileMessage = PASS,\n    onBeforeUpdateUserMessage = PASS,\n    onBeforeUpdateFileMessage = PASS,\n    onPressMediaMessage = NOOP,\n\n    renderMessage,\n    renderNewMessagesButton = () => null,\n    renderScrollToBottomButton = (props) => <ScrollToBottomButton {...props} />,\n\n    enableMessageGrouping = true,\n    keyboardAvoidOffset,\n    flatListProps,\n    queryCreator,\n    sortComparator = messageComparator,\n  }) => {\n    const { sdk, currentUser } = useSendbirdChat();\n\n    const { STRINGS } = useLocalization();\n    const { show: showToast } = useToast();\n\n    const [openChannelPubSub] = useState(() => pubsub<OpenChannelPubSubContextPayload>());\n\n    const {\n      messages,\n      newMessages,\n      next,\n      prev,\n      hasNext,\n      sendFileMessage,\n      sendUserMessage,\n      updateFileMessage,\n      updateUserMessage,\n      resendMessage,\n      deleteMessage,\n      loading,\n    } = useOpenChannelMessages(sdk, channel, currentUser?.userId, {\n      queryCreator,\n      sortComparator,\n      onChannelDeleted,\n      onError(error) {\n        if (error instanceof SendbirdError) {\n          switch (error.code) {\n            case SBErrorCode.RESOURCE_NOT_FOUND:\n            case SBErrorCode.CHANNEL_NOT_FOUND:\n            case SBErrorCode.BANNED_USER_SEND_MESSAGE_NOT_ALLOWED: {\n              return showToast(STRINGS.TOAST.GET_CHANNEL_ERROR, 'error');\n            }\n          }\n        }\n\n        showToast(STRINGS.TOAST.UNKNOWN_ERROR, 'error');\n      },\n      onMessagesReceived(messages) {\n        openChannelPubSub.publish({ type: 'MESSAGES_RECEIVED', data: { messages } });\n      },\n    });\n\n    const isOperator = channel.isOperator(currentUser?.userId ?? UNKNOWN_USER_ID);\n\n    const _renderMessage: OpenChannelProps['MessageList']['renderMessage'] = useFreshCallback((props) => {\n      if (renderMessage) return renderMessage(props);\n      return <OpenChannelMessageRenderer {...props} />;\n    });\n\n    const memoizedFlatListProps = useMemo(\n      () => ({\n        ListEmptyComponent: <OpenChannelModule.StatusEmpty />,\n        contentContainerStyle: { flexGrow: 1 },\n        ...flatListProps,\n      }),\n      [loading, flatListProps],\n    );\n\n    const onPending = (message: SendbirdFileMessage | SendbirdUserMessage) => {\n      openChannelPubSub.publish({ type: 'MESSAGE_SENT_PENDING', data: { message } });\n    };\n    const onSent = (message: SendbirdFileMessage | SendbirdUserMessage) => {\n      openChannelPubSub.publish({ type: 'MESSAGE_SENT_SUCCESS', data: { message } });\n    };\n\n    const onPressSendUserMessage: OpenChannelProps['Input']['onPressSendUserMessage'] = useFreshCallback(\n      async (params) => {\n        const processedParams = await onBeforeSendUserMessage(params);\n        const message = await sendUserMessage(processedParams, onPending);\n        onSent(message);\n      },\n    );\n    const onPressSendFileMessage: OpenChannelProps['Input']['onPressSendFileMessage'] = useFreshCallback(\n      async (params) => {\n        const processedParams = await onBeforeSendFileMessage(params);\n        const message = await sendFileMessage(processedParams, onPending);\n        onSent(message);\n      },\n    );\n    const onPressUpdateUserMessage: OpenChannelProps['Input']['onPressUpdateUserMessage'] = useFreshCallback(\n      async (message, params) => {\n        const processedParams = await onBeforeUpdateUserMessage(params);\n        await updateUserMessage(message.messageId, processedParams);\n      },\n    );\n    const onPressUpdateFileMessage: OpenChannelProps['Input']['onPressUpdateFileMessage'] = useFreshCallback(\n      async (message, params) => {\n        const processedParams = await onBeforeUpdateFileMessage(params);\n        await updateFileMessage(message.messageId, processedParams);\n      },\n    );\n\n    return (\n      <OpenChannelModule.Provider\n        openChannelPubSub={openChannelPubSub}\n        channel={channel}\n        keyboardAvoidOffset={keyboardAvoidOffset}\n      >\n        <OpenChannelModule.Header\n          onPressHeaderLeft={onPressHeaderLeft}\n          rightIconName={isOperator ? 'info' : 'members'}\n          onPressHeaderRight={isOperator ? onPressHeaderRightWithSettings : onPressHeaderRightWithParticipants}\n        />\n        <StatusComposition loading={loading} LoadingComponent={<OpenChannelModule.StatusLoading />}>\n          <OpenChannelModule.MessageList\n            channel={channel}\n            hasNext={hasNext}\n            enableMessageGrouping={enableMessageGrouping}\n            currentUserId={currentUser?.userId}\n            renderMessage={_renderMessage}\n            messages={messages}\n            newMessages={newMessages}\n            onTopReached={prev}\n            onBottomReached={next}\n            scrolledAwayFromBottom={false}\n            onScrolledAwayFromBottom={NOOP}\n            renderNewMessagesButton={renderNewMessagesButton}\n            renderScrollToBottomButton={renderScrollToBottomButton}\n            onResendFailedMessage={resendMessage}\n            onDeleteMessage={deleteMessage}\n            onPressMediaMessage={onPressMediaMessage}\n            flatListProps={memoizedFlatListProps}\n          />\n          <OpenChannelModule.Input\n            shouldRenderInput\n            onPressSendUserMessage={onPressSendUserMessage}\n            onPressSendFileMessage={onPressSendFileMessage}\n            onPressUpdateUserMessage={onPressUpdateUserMessage}\n            onPressUpdateFileMessage={onPressUpdateFileMessage}\n          />\n        </StatusComposition>\n      </OpenChannelModule.Provider>\n    );\n  };\n};\n\nexport default createOpenChannelFragment;\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,uBAAA,CAAAC,OAAA;AAEA,IAAAC,KAAA,GAAAD,OAAA;AACA,IAAAE,eAAA,GAAAF,OAAA;AACA,IAAAG,2BAAA,GAAAH,OAAA;AACA,IAAAI,WAAA,GAAAJ,OAAA;AAUA,IAAAK,2BAAA,GAAAC,sBAAA,CAAAN,OAAA;AACA,IAAAO,qBAAA,GAAAD,sBAAA,CAAAN,OAAA;AACA,IAAAQ,kBAAA,GAAAF,sBAAA,CAAAN,OAAA;AACA,IAAAS,UAAA,GAAAT,OAAA;AACA,IAAAU,YAAA,GAAAV,OAAA;AAOA,IAAAW,WAAA,GAAAX,OAAA;AACA,IAAAY,OAAA,GAAAN,sBAAA,CAAAN,OAAA;AAAqC,SAAAM,uBAAAO,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAAA,SAAAG,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAlB,wBAAAc,GAAA,EAAAI,WAAA,SAAAA,WAAA,IAAAJ,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAQ,KAAA,GAAAL,wBAAA,CAAAC,WAAA,OAAAI,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAT,GAAA,YAAAQ,KAAA,CAAAE,GAAA,CAAAV,GAAA,SAAAW,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAhB,GAAA,QAAAgB,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAnB,GAAA,EAAAgB,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAf,GAAA,EAAAgB,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAhB,GAAA,CAAAgB,GAAA,SAAAL,MAAA,CAAAT,OAAA,GAAAF,GAAA,MAAAQ,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAArB,GAAA,EAAAW,MAAA,YAAAA,MAAA;AAErC,MAAMW,yBAAyB,GAAIC,UAAuC,IAA0B;EAClG,MAAMC,iBAAiB,GAAG,IAAAC,oCAAuB,EAACF,UAAU,CAAC;EAE7D,OAAOG,IAAA,IAsBD;IAAA,IAtBE;MACNC,OAAO;MACPC,gBAAgB,GAAGC,gBAAI;MACvBC,iBAAiB,GAAGD,gBAAI;MACxBE,8BAA8B,GAAGF,gBAAI;MACrCG,kCAAkC,GAAGH,gBAAI;MAEzCI,uBAAuB,GAAGC,gBAAI;MAC9BC,uBAAuB,GAAGD,gBAAI;MAC9BE,yBAAyB,GAAGF,gBAAI;MAChCG,yBAAyB,GAAGH,gBAAI;MAChCI,mBAAmB,GAAGT,gBAAI;MAE1BU,aAAa;MACbC,uBAAuB,GAAGA,CAAA,KAAM,IAAI;MACpCC,0BAA0B,GAAIC,KAAK,iBAAKzD,MAAA,CAAAiB,OAAA,CAAAyC,aAAA,CAACjD,qBAAA,CAAAQ,OAAoB,EAAKwC,KAAK,CAAI;MAE3EE,qBAAqB,GAAG,IAAI;MAC5BC,mBAAmB;MACnBC,aAAa;MACbC,YAAY;MACZC,cAAc,GAAGC;IACnB,CAAC,GAAAvB,IAAA;IACC,MAAM;MAAEwB,GAAG;MAAEC;IAAY,CAAC,GAAG,IAAAC,2BAAe,GAAE;IAE9C,MAAM;MAAEC;IAAQ,CAAC,GAAG,IAAAC,2BAAe,GAAE;IACrC,MAAM;MAAEC,IAAI,EAAEC;IAAU,CAAC,GAAG,IAAAC,oCAAQ,GAAE;IAEtC,MAAM,CAACC,iBAAiB,CAAC,GAAG,IAAAC,eAAQ,EAAC,MAAM,IAAAC,eAAM,GAAmC,CAAC;IAErF,MAAM;MACJC,QAAQ;MACRC,WAAW;MACXC,IAAI;MACJC,IAAI;MACJC,OAAO;MACPC,eAAe;MACfC,eAAe;MACfC,iBAAiB;MACjBC,iBAAiB;MACjBC,aAAa;MACbC,aAAa;MACbC;IACF,CAAC,GAAG,IAAAC,sCAAsB,EAACvB,GAAG,EAAEvB,OAAO,EAAEwB,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEuB,MAAM,EAAE;MAC5D3B,YAAY;MACZC,cAAc;MACdpB,gBAAgB;MAChB+C,OAAOA,CAACC,KAAK,EAAE;QACb,IAAIA,KAAK,YAAYC,mBAAa,EAAE;UAClC,QAAQD,KAAK,CAACE,IAAI;YAChB,KAAKC,uBAAW,CAACC,kBAAkB;YACnC,KAAKD,uBAAW,CAACE,iBAAiB;YAClC,KAAKF,uBAAW,CAACG,oCAAoC;cAAE;gBACrD,OAAO1B,SAAS,CAACH,OAAO,CAAC8B,KAAK,CAACC,iBAAiB,EAAE,OAAO,CAAC;cAC5D;UAAC;QAEL;QAEA5B,SAAS,CAACH,OAAO,CAAC8B,KAAK,CAACE,aAAa,EAAE,OAAO,CAAC;MACjD,CAAC;MACDC,kBAAkBA,CAACzB,QAAQ,EAAE;QAC3BH,iBAAiB,CAAC6B,OAAO,CAAC;UAAEC,IAAI,EAAE,mBAAmB;UAAEC,IAAI,EAAE;YAAE5B;UAAS;QAAE,CAAC,CAAC;MAC9E;IACF,CAAC,CAAC;IAEF,MAAM6B,UAAU,GAAG/D,OAAO,CAAC+D,UAAU,CAAC,CAAAvC,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEuB,MAAM,KAAIiB,0BAAe,CAAC;IAE7E,MAAMC,cAAgE,GAAG,IAAAC,4BAAgB,EAAEnD,KAAK,IAAK;MACnG,IAAIH,aAAa,EAAE,OAAOA,aAAa,CAACG,KAAK,CAAC;MAC9C,oBAAOzD,MAAA,CAAAiB,OAAA,CAAAyC,aAAA,CAACnD,2BAAA,CAAAU,OAA0B,EAAKwC,KAAK,CAAI;IAClD,CAAC,CAAC;IAEF,MAAMoD,qBAAqB,GAAG,IAAAC,cAAO,EACnC,OAAO;MACLC,kBAAkB,eAAE/G,MAAA,CAAAiB,OAAA,CAAAyC,aAAA,CAACnB,iBAAiB,CAACyE,WAAW,OAAG;MACrDC,qBAAqB,EAAE;QAAEC,QAAQ,EAAE;MAAE,CAAC;MACtC,GAAGrD;IACL,CAAC,CAAC,EACF,CAAC0B,OAAO,EAAE1B,aAAa,CAAC,CACzB;IAED,MAAMsD,SAAS,GAAIC,OAAkD,IAAK;MACxE3C,iBAAiB,CAAC6B,OAAO,CAAC;QAAEC,IAAI,EAAE,sBAAsB;QAAEC,IAAI,EAAE;UAAEY;QAAQ;MAAE,CAAC,CAAC;IAChF,CAAC;IACD,MAAMC,MAAM,GAAID,OAAkD,IAAK;MACrE3C,iBAAiB,CAAC6B,OAAO,CAAC;QAAEC,IAAI,EAAE,sBAAsB;QAAEC,IAAI,EAAE;UAAEY;QAAQ;MAAE,CAAC,CAAC;IAChF,CAAC;IAED,MAAME,sBAA2E,GAAG,IAAAV,4BAAgB,EAClG,MAAOW,MAAM,IAAK;MAChB,MAAMC,eAAe,GAAG,MAAMxE,uBAAuB,CAACuE,MAAM,CAAC;MAC7D,MAAMH,OAAO,GAAG,MAAMlC,eAAe,CAACsC,eAAe,EAAEL,SAAS,CAAC;MACjEE,MAAM,CAACD,OAAO,CAAC;IACjB,CAAC,CACF;IACD,MAAMK,sBAA2E,GAAG,IAAAb,4BAAgB,EAClG,MAAOW,MAAM,IAAK;MAChB,MAAMC,eAAe,GAAG,MAAMtE,uBAAuB,CAACqE,MAAM,CAAC;MAC7D,MAAMH,OAAO,GAAG,MAAMnC,eAAe,CAACuC,eAAe,EAAEL,SAAS,CAAC;MACjEE,MAAM,CAACD,OAAO,CAAC;IACjB,CAAC,CACF;IACD,MAAMM,wBAA+E,GAAG,IAAAd,4BAAgB,EACtG,OAAOQ,OAAO,EAAEG,MAAM,KAAK;MACzB,MAAMC,eAAe,GAAG,MAAMrE,yBAAyB,CAACoE,MAAM,CAAC;MAC/D,MAAMnC,iBAAiB,CAACgC,OAAO,CAACO,SAAS,EAAEH,eAAe,CAAC;IAC7D,CAAC,CACF;IACD,MAAMI,wBAA+E,GAAG,IAAAhB,4BAAgB,EACtG,OAAOQ,OAAO,EAAEG,MAAM,KAAK;MACzB,MAAMC,eAAe,GAAG,MAAMpE,yBAAyB,CAACmE,MAAM,CAAC;MAC/D,MAAMpC,iBAAiB,CAACiC,OAAO,CAACO,SAAS,EAAEH,eAAe,CAAC;IAC7D,CAAC,CACF;IAED,oBACExH,MAAA,CAAAiB,OAAA,CAAAyC,aAAA,CAACnB,iBAAiB,CAACsF,QAAQ;MACzBpD,iBAAiB,EAAEA,iBAAkB;MACrC/B,OAAO,EAAEA,OAAQ;MACjBkB,mBAAmB,EAAEA;IAAoB,gBAEzC5D,MAAA,CAAAiB,OAAA,CAAAyC,aAAA,CAACnB,iBAAiB,CAACuF,MAAM;MACvBjF,iBAAiB,EAAEA,iBAAkB;MACrCkF,aAAa,EAAEtB,UAAU,GAAG,MAAM,GAAG,SAAU;MAC/CuB,kBAAkB,EAAEvB,UAAU,GAAG3D,8BAA8B,GAAGC;IAAmC,EACrG,eACF/C,MAAA,CAAAiB,OAAA,CAAAyC,aAAA,CAAChD,kBAAA,CAAAO,OAAiB;MAACsE,OAAO,EAAEA,OAAQ;MAAC0C,gBAAgB,eAAEjI,MAAA,CAAAiB,OAAA,CAAAyC,aAAA,CAACnB,iBAAiB,CAAC2F,aAAa;IAAI,gBACzFlI,MAAA,CAAAiB,OAAA,CAAAyC,aAAA,CAACnB,iBAAiB,CAAC4F,WAAW;MAC5BzF,OAAO,EAAEA,OAAQ;MACjBsC,OAAO,EAAEA,OAAQ;MACjBrB,qBAAqB,EAAEA,qBAAsB;MAC7CyE,aAAa,EAAElE,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEuB,MAAO;MACnCnC,aAAa,EAAEqD,cAAe;MAC9B/B,QAAQ,EAAEA,QAAS;MACnBC,WAAW,EAAEA,WAAY;MACzBwD,YAAY,EAAEtD,IAAK;MACnBuD,eAAe,EAAExD,IAAK;MACtByD,sBAAsB,EAAE,KAAM;MAC9BC,wBAAwB,EAAE5F,gBAAK;MAC/BW,uBAAuB,EAAEA,uBAAwB;MACjDC,0BAA0B,EAAEA,0BAA2B;MACvDiF,qBAAqB,EAAEpD,aAAc;MACrCqD,eAAe,EAAEpD,aAAc;MAC/BjC,mBAAmB,EAAEA,mBAAoB;MACzCQ,aAAa,EAAEgD;IAAsB,EACrC,eACF7G,MAAA,CAAAiB,OAAA,CAAAyC,aAAA,CAACnB,iBAAiB,CAACoG,KAAK;MACtBC,iBAAiB;MACjBtB,sBAAsB,EAAEA,sBAAuB;MAC/CG,sBAAsB,EAAEA,sBAAuB;MAC/CC,wBAAwB,EAAEA,wBAAyB;MACnDE,wBAAwB,EAAEA;IAAyB,EACnD,CACgB,CACO;EAEjC,CAAC;AACH,CAAC;AAAC,IAAAiB,QAAA,GAEaxG,yBAAyB;AAAAyG,OAAA,CAAA7H,OAAA,GAAA4H,QAAA"}