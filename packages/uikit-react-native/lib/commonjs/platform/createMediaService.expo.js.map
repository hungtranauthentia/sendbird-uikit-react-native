{"version":3,"names":["_react","_interopRequireDefault","require","_uikitUtils","_SBUUtils","_expoBackwardUtils","obj","__esModule","default","_extends","Object","assign","bind","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","createExpoMediaService","_ref","avModule","thumbnailModule","imageManipulator","fsModule","VideoComponent","_ref2","resizeMode","onLoad","props","createElement","Video","useNativeControls","getVideoThumbnail","_ref3","url","quality","timeMills","uri","getThumbnailAsync","time","path","compressImage","_ref4","maxWidth","maxHeight","compressionRate","originSize","SBUUtils","getImageSize","resizingSize","getDownscaleSize","width","height","compressedURI","manipulateAsync","resize","compress","Math","min","max","fileInfo","getInfoAsync","size","expoBackwardUtils","toFileSize","_default","exports"],"sources":["createMediaService.expo.tsx"],"sourcesContent":["import type * as ExpoAV from 'expo-av';\nimport type * as ExpoFS from 'expo-file-system';\nimport type * as ExpoImageManipulator from 'expo-image-manipulator';\nimport type * as ExpoVideoThumbnail from 'expo-video-thumbnails';\nimport React from 'react';\n\nimport { getDownscaleSize } from '@sendbird/uikit-utils';\n\nimport SBUUtils from '../libs/SBUUtils';\nimport expoBackwardUtils from '../utils/expoBackwardUtils';\nimport type { MediaServiceInterface } from './types';\n\ntype Modules = {\n  avModule: typeof ExpoAV;\n  thumbnailModule: typeof ExpoVideoThumbnail;\n  imageManipulator: typeof ExpoImageManipulator;\n  fsModule: typeof ExpoFS;\n};\n\nconst createExpoMediaService = ({\n  avModule,\n  thumbnailModule,\n  imageManipulator,\n  fsModule,\n}: Modules): MediaServiceInterface => {\n  return {\n    VideoComponent({ source, resizeMode, onLoad, ...props }) {\n      // FIXME: type error https://github.com/expo/expo/issues/17101\n      // @ts-ignore\n      return <avModule.Video {...props} source={source} resizeMode={resizeMode} onLoad={onLoad} useNativeControls />;\n    },\n    async getVideoThumbnail({ url, quality, timeMills }) {\n      try {\n        const { uri } = await thumbnailModule.getThumbnailAsync(url, { quality, time: timeMills });\n        return { path: uri };\n      } catch {\n        return null;\n      }\n    },\n    async compressImage({ maxWidth, maxHeight, compressionRate = 1, uri }) {\n      const originSize = await SBUUtils.getImageSize(uri);\n      const resizingSize = getDownscaleSize(originSize, { width: maxWidth, height: maxHeight });\n\n      const { uri: compressedURI } = await imageManipulator.manipulateAsync(uri, [{ resize: resizingSize }], {\n        compress: Math.min(Math.max(0, compressionRate), 1),\n      });\n      const fileInfo = await fsModule.getInfoAsync(uri);\n\n      return { uri: compressedURI, size: expoBackwardUtils.toFileSize(fileInfo) };\n    },\n  };\n};\n\nexport default createExpoMediaService;\n"],"mappings":"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"}