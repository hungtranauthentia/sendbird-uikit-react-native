{"version":3,"names":["_react","_interopRequireDefault","require","_uikitUtils","_SBUUtils","obj","__esModule","default","_extends","Object","assign","bind","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","createNativeMediaService","_ref","VideoComponent","thumbnailModule","imageResizerModule","_ref2","resizeMode","onLoad","props","createElement","controls","getVideoThumbnail","_ref3","url","timeMills","path","createThumbnail","format","timeStamp","cacheName","hash","split","compressImage","_ref4","uri","maxWidth","maxHeight","compressionRate","originSize","SBUUtils","getImageSize","width","height","getDownscaleSize","extension","getFileExtension","size","resizedSize","compressedURI","createResizedImage","Math","min","max","_default","exports"],"sources":["createMediaService.native.tsx"],"sourcesContent":["import type * as RNImageResizer from '@bam.tech/react-native-image-resizer';\nimport React from 'react';\nimport type * as RNCreateThumbnail from 'react-native-create-thumbnail';\nimport type RNVideo from 'react-native-video';\n\nimport { getDownscaleSize, getFileExtension, hash } from '@sendbird/uikit-utils';\n\nimport SBUUtils from '../libs/SBUUtils';\nimport type { MediaServiceInterface } from './types';\n\ntype Modules = {\n  VideoComponent: typeof RNVideo;\n  thumbnailModule: typeof RNCreateThumbnail;\n  imageResizerModule: typeof RNImageResizer;\n};\n\nconst createNativeMediaService = ({\n  VideoComponent,\n  thumbnailModule,\n  imageResizerModule,\n}: Modules): MediaServiceInterface => {\n  return {\n    VideoComponent({ source, resizeMode, onLoad, ...props }) {\n      return <VideoComponent {...props} source={source} resizeMode={resizeMode} onLoad={onLoad} controls />;\n    },\n    async getVideoThumbnail({ url, timeMills }) {\n      try {\n        const { path } = await thumbnailModule.createThumbnail({\n          url,\n          format: 'jpeg',\n          timeStamp: timeMills,\n          cacheName: hash(url.split('?')[0]),\n        });\n        return { path };\n      } catch {\n        return null;\n      }\n    },\n    async compressImage({ uri, maxWidth, maxHeight, compressionRate = 1 }) {\n      const originSize = await SBUUtils.getImageSize(uri);\n      const { width, height } = getDownscaleSize(originSize, { width: maxWidth, height: maxHeight });\n      const extension = (() => {\n        return { 'png': 'PNG', 'jpeg': 'JPEG', 'jpg': 'JPEG' }[getFileExtension(uri)] ?? 'JPEG';\n      })() as 'PNG' | 'JPEG';\n\n      const { size: resizedSize, uri: compressedURI } = await imageResizerModule.default.createResizedImage(\n        uri,\n        width,\n        height,\n        extension,\n        Math.min(Math.max(0, compressionRate), 1) * 100,\n      );\n\n      return { uri: compressedURI, size: resizedSize };\n    },\n  };\n};\n\nexport default createNativeMediaService;\n"],"mappings":"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"}