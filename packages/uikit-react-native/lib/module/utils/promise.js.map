{"version":3,"names":["iterableToArray","iterable","Array","from","x","prototype","slice","call","onSettledFulfill","value","status","onSettledReject","reason","mapAllSettled","item","Promise","then","bind","getAggregateError","errors","AggregateError","error","Error","name","PromisePolyfill","allSettled","values","all","map","race","resolve","reject","forEach","any","promises","hasResolved","rejectionReasons","resolveOnce","rejectionCheck","push","length","apply","global"],"sources":["promise.ts"],"sourcesContent":["import 'react-native';\n\n/**\n * This file contains subcomponents with separate copyright notices and license terms.\n * Your use of the source code for these subcomponents is subject to the terms and conditions of the following licenses.\n *\n * MIT License: https://github.com/then/promise\n *\n * Copyright (c) 2014 Forbes Lindesay\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n * Original code: https://github.com/then/promise/blob/master/src/es6-extensions.js\n * */\nlet iterableToArray = function <T>(iterable: Iterable<T | PromiseLike<T>>): (T | PromiseLike<T>)[] {\n  if (typeof Array.from === 'function') {\n    // ES2015+, iterables exist\n    iterableToArray = Array.from;\n    return Array.from(iterable);\n  }\n\n  // ES5, only arrays and array-likes exist\n  iterableToArray = function (x) {\n    return Array.prototype.slice.call(x);\n  };\n  return Array.prototype.slice.call(iterable);\n};\n\nfunction onSettledFulfill<T>(value: T) {\n  return { status: 'fulfilled', value: value } as const;\n}\n\nfunction onSettledReject<T>(reason: T) {\n  return { status: 'rejected', reason: reason } as const;\n}\n\nfunction mapAllSettled<T>(item: T | PromiseLike<T>): PromiseLike<PromiseSettledResult<T>> | PromiseSettledResult<T> {\n  if (item && (typeof item === 'object' || typeof item === 'function')) {\n    if (item instanceof Promise && item.then === Promise.prototype.then) {\n      return item.then(onSettledFulfill, onSettledReject);\n    }\n    // @ts-expect-error\n    const then = item.then;\n    if (typeof then === 'function') {\n      return new Promise<T>(then.bind(item)).then(onSettledFulfill, onSettledReject);\n    }\n  }\n\n  // @ts-expect-error\n  return onSettledFulfill(item);\n}\n\nfunction getAggregateError(errors: unknown[]) {\n  if (typeof AggregateError === 'function') {\n    return new AggregateError(errors, 'All promises were rejected');\n  }\n\n  const error = new Error('All promises were rejected') as Error & { errors: unknown[] };\n\n  error.name = 'AggregateError';\n  error.errors = errors;\n\n  return error;\n}\n\nexport const PromisePolyfill = {\n  allSettled<T extends readonly unknown[] | []>(values: T) {\n    return Promise.all(iterableToArray(values).map(mapAllSettled)) as Promise<{\n      -readonly [P in keyof T]: PromiseSettledResult<Awaited<T[P]>>;\n    }>;\n  },\n  race<T>(values: Iterable<T | PromiseLike<T>>): Promise<Awaited<T>> {\n    return new Promise(function (resolve, reject) {\n      iterableToArray(values).forEach(function (value) {\n        Promise.resolve(value).then(resolve, reject);\n      });\n    });\n  },\n  any<T>(values: Iterable<T | PromiseLike<T>>): Promise<Awaited<T>> {\n    return new Promise<Awaited<T>>(function (resolve, reject) {\n      const promises = iterableToArray(values);\n      let hasResolved = false;\n      const rejectionReasons: unknown[] = [];\n\n      function resolveOnce(value: Awaited<T>) {\n        if (!hasResolved) {\n          hasResolved = true;\n          resolve(value);\n        }\n      }\n\n      function rejectionCheck(reason: unknown) {\n        rejectionReasons.push(reason);\n\n        if (rejectionReasons.length === promises.length) {\n          reject(getAggregateError(rejectionReasons));\n        }\n      }\n\n      if (promises.length === 0) {\n        reject(getAggregateError(rejectionReasons));\n      } else {\n        promises.forEach(function (value) {\n          Promise.resolve(value).then(resolveOnce, rejectionCheck);\n        });\n      }\n    });\n  },\n  apply() {\n    // https://github.com/facebook/react-native/blob/main/packages/react-native/Libraries/Utilities/PolyfillFunctions.js\n    if (typeof global !== 'undefined' && 'Promise' in global) {\n      if (!global.Promise.allSettled) {\n        global.Promise.allSettled = this.allSettled;\n      }\n      if (!global.Promise.any) {\n        global.Promise.any = this.any;\n      }\n      if (!global.Promise.race) {\n        global.Promise.race = this.race;\n      }\n    }\n  },\n};\n"],"mappings":"AAAA,OAAO,cAAc;;AAErB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIA,eAAe,GAAG,SAAAA,CAAaC,QAAsC,EAA0B;EACjG,IAAI,OAAOC,KAAK,CAACC,IAAI,KAAK,UAAU,EAAE;IACpC;IACAH,eAAe,GAAGE,KAAK,CAACC,IAAI;IAC5B,OAAOD,KAAK,CAACC,IAAI,CAACF,QAAQ,CAAC;EAC7B;;EAEA;EACAD,eAAe,GAAG,SAAAA,CAAUI,CAAC,EAAE;IAC7B,OAAOF,KAAK,CAACG,SAAS,CAACC,KAAK,CAACC,IAAI,CAACH,CAAC,CAAC;EACtC,CAAC;EACD,OAAOF,KAAK,CAACG,SAAS,CAACC,KAAK,CAACC,IAAI,CAACN,QAAQ,CAAC;AAC7C,CAAC;AAED,SAASO,gBAAgBA,CAAIC,KAAQ,EAAE;EACrC,OAAO;IAAEC,MAAM,EAAE,WAAW;IAAED,KAAK,EAAEA;EAAM,CAAC;AAC9C;AAEA,SAASE,eAAeA,CAAIC,MAAS,EAAE;EACrC,OAAO;IAAEF,MAAM,EAAE,UAAU;IAAEE,MAAM,EAAEA;EAAO,CAAC;AAC/C;AAEA,SAASC,aAAaA,CAAIC,IAAwB,EAAkE;EAClH,IAAIA,IAAI,KAAK,OAAOA,IAAI,KAAK,QAAQ,IAAI,OAAOA,IAAI,KAAK,UAAU,CAAC,EAAE;IACpE,IAAIA,IAAI,YAAYC,OAAO,IAAID,IAAI,CAACE,IAAI,KAAKD,OAAO,CAACV,SAAS,CAACW,IAAI,EAAE;MACnE,OAAOF,IAAI,CAACE,IAAI,CAACR,gBAAgB,EAAEG,eAAe,CAAC;IACrD;IACA;IACA,MAAMK,IAAI,GAAGF,IAAI,CAACE,IAAI;IACtB,IAAI,OAAOA,IAAI,KAAK,UAAU,EAAE;MAC9B,OAAO,IAAID,OAAO,CAAIC,IAAI,CAACC,IAAI,CAACH,IAAI,CAAC,CAAC,CAACE,IAAI,CAACR,gBAAgB,EAAEG,eAAe,CAAC;IAChF;EACF;;EAEA;EACA,OAAOH,gBAAgB,CAACM,IAAI,CAAC;AAC/B;AAEA,SAASI,iBAAiBA,CAACC,MAAiB,EAAE;EAC5C,IAAI,OAAOC,cAAc,KAAK,UAAU,EAAE;IACxC,OAAO,IAAIA,cAAc,CAACD,MAAM,EAAE,4BAA4B,CAAC;EACjE;EAEA,MAAME,KAAK,GAAG,IAAIC,KAAK,CAAC,4BAA4B,CAAkC;EAEtFD,KAAK,CAACE,IAAI,GAAG,gBAAgB;EAC7BF,KAAK,CAACF,MAAM,GAAGA,MAAM;EAErB,OAAOE,KAAK;AACd;AAEA,OAAO,MAAMG,eAAe,GAAG;EAC7BC,UAAUA,CAAoCC,MAAS,EAAE;IACvD,OAAOX,OAAO,CAACY,GAAG,CAAC3B,eAAe,CAAC0B,MAAM,CAAC,CAACE,GAAG,CAACf,aAAa,CAAC,CAAC;EAGhE,CAAC;EACDgB,IAAIA,CAAIH,MAAoC,EAAuB;IACjE,OAAO,IAAIX,OAAO,CAAC,UAAUe,OAAO,EAAEC,MAAM,EAAE;MAC5C/B,eAAe,CAAC0B,MAAM,CAAC,CAACM,OAAO,CAAC,UAAUvB,KAAK,EAAE;QAC/CM,OAAO,CAACe,OAAO,CAACrB,KAAK,CAAC,CAACO,IAAI,CAACc,OAAO,EAAEC,MAAM,CAAC;MAC9C,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ,CAAC;EACDE,GAAGA,CAAIP,MAAoC,EAAuB;IAChE,OAAO,IAAIX,OAAO,CAAa,UAAUe,OAAO,EAAEC,MAAM,EAAE;MACxD,MAAMG,QAAQ,GAAGlC,eAAe,CAAC0B,MAAM,CAAC;MACxC,IAAIS,WAAW,GAAG,KAAK;MACvB,MAAMC,gBAA2B,GAAG,EAAE;MAEtC,SAASC,WAAWA,CAAC5B,KAAiB,EAAE;QACtC,IAAI,CAAC0B,WAAW,EAAE;UAChBA,WAAW,GAAG,IAAI;UAClBL,OAAO,CAACrB,KAAK,CAAC;QAChB;MACF;MAEA,SAAS6B,cAAcA,CAAC1B,MAAe,EAAE;QACvCwB,gBAAgB,CAACG,IAAI,CAAC3B,MAAM,CAAC;QAE7B,IAAIwB,gBAAgB,CAACI,MAAM,KAAKN,QAAQ,CAACM,MAAM,EAAE;UAC/CT,MAAM,CAACb,iBAAiB,CAACkB,gBAAgB,CAAC,CAAC;QAC7C;MACF;MAEA,IAAIF,QAAQ,CAACM,MAAM,KAAK,CAAC,EAAE;QACzBT,MAAM,CAACb,iBAAiB,CAACkB,gBAAgB,CAAC,CAAC;MAC7C,CAAC,MAAM;QACLF,QAAQ,CAACF,OAAO,CAAC,UAAUvB,KAAK,EAAE;UAChCM,OAAO,CAACe,OAAO,CAACrB,KAAK,CAAC,CAACO,IAAI,CAACqB,WAAW,EAAEC,cAAc,CAAC;QAC1D,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;EACJ,CAAC;EACDG,KAAKA,CAAA,EAAG;IACN;IACA,IAAI,OAAOC,MAAM,KAAK,WAAW,IAAI,SAAS,IAAIA,MAAM,EAAE;MACxD,IAAI,CAACA,MAAM,CAAC3B,OAAO,CAACU,UAAU,EAAE;QAC9BiB,MAAM,CAAC3B,OAAO,CAACU,UAAU,GAAG,IAAI,CAACA,UAAU;MAC7C;MACA,IAAI,CAACiB,MAAM,CAAC3B,OAAO,CAACkB,GAAG,EAAE;QACvBS,MAAM,CAAC3B,OAAO,CAACkB,GAAG,GAAG,IAAI,CAACA,GAAG;MAC/B;MACA,IAAI,CAACS,MAAM,CAAC3B,OAAO,CAACc,IAAI,EAAE;QACxBa,MAAM,CAAC3B,OAAO,CAACc,IAAI,GAAG,IAAI,CAACA,IAAI;MACjC;IACF;EACF;AACF,CAAC"}