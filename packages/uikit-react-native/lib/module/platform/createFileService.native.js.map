{"version":3,"names":["Platform","Logger","getFileExtension","getFileExtensionFromMime","getFileExtensionFromUri","getFileType","normalizeFileName","SBUError","nativePermissionGranted","normalizeFile","getAndroidStoragePermissionsByAPILevel","permissionModule","OS","Version","PERMISSIONS","ANDROID","READ_MEDIA_AUDIO","READ_MEDIA_IMAGES","READ_MEDIA_VIDEO","READ_EXTERNAL_STORAGE","WRITE_EXTERNAL_STORAGE","createNativeFileService","_ref","imagePickerModule","documentPickerModule","mediaLibraryModule","fsModule","cameraPermissions","select","ios","IOS","CAMERA","MICROPHONE","android","default","mediaLibraryPermissions","PHOTO_LIBRARY","PHOTO_LIBRARY_ADD_ONLY","NativeFileService","constructor","_defineProperty","options","dirname","Dirs","CacheDir","DocumentDir","context","filename","fileName","extension","fileType","fileUrl","path","buildDownloadPath","FileSystem","fetch","downloadedPath","file","name","type","hasCameraPermission","status","checkMultiple","requestCameraPermission","requestMultiple","hasMediaLibraryPermission","requestMediaLibraryPermission","openCamera","_response$assets","hasPermission","granted","_options$onOpenFailur","onOpenFailure","call","PERMISSIONS_DENIED","response","launchCamera","presentationStyle","cameraType","mediaType","didCancel","errorCode","_options$onOpenFailur2","DEVICE_UNAVAILABLE","Error","errorMessage","fileSize","size","uri","assets","openMediaLibrary","selectionLimit","_options$onOpenFailur3","launchImageLibrary","_options$onOpenFailur4","Promise","all","slice","map","_ref2","openDocument","pickSingle","e","isCancel","isInProgress","_options$onOpenFailur5","UNKNOWN","save","downloadFile","mediaTypeMap","externalDirMap","externalDir","cpExternal","catch","error","createRecordFilePath","customExtension","arguments","length","undefined","Date","now","recordFilePath","startsWith"],"sources":["createFileService.native.ts"],"sourcesContent":["import type { CameraRoll } from '@react-native-camera-roll/camera-roll';\nimport { Platform } from 'react-native';\nimport type * as DocumentPicker from 'react-native-document-picker';\nimport type * as FileAccess from 'react-native-file-access';\nimport type * as ImagePicker from 'react-native-image-picker';\nimport type * as Permissions from 'react-native-permissions';\nimport type { Permission } from 'react-native-permissions';\n\nimport {\n  Logger,\n  getFileExtension,\n  getFileExtensionFromMime,\n  getFileExtensionFromUri,\n  getFileType,\n  normalizeFileName,\n} from '@sendbird/uikit-utils';\n\nimport SBUError from '../libs/SBUError';\nimport nativePermissionGranted from '../utils/nativePermissionGranted';\nimport normalizeFile from '../utils/normalizeFile';\nimport type {\n  FilePickerResponse,\n  FileServiceInterface,\n  OpenCameraOptions,\n  OpenDocumentOptions,\n  OpenMediaLibraryOptions,\n  SaveOptions,\n} from './types';\n\nfunction getAndroidStoragePermissionsByAPILevel(permissionModule: typeof Permissions): Permission[] {\n  if (Platform.OS !== 'android') return [];\n\n  if (Platform.Version > 32) {\n    return [\n      permissionModule.PERMISSIONS.ANDROID.READ_MEDIA_AUDIO,\n      permissionModule.PERMISSIONS.ANDROID.READ_MEDIA_IMAGES,\n      permissionModule.PERMISSIONS.ANDROID.READ_MEDIA_VIDEO,\n    ];\n  }\n\n  if (Platform.Version > 28) {\n    return [permissionModule.PERMISSIONS.ANDROID.READ_EXTERNAL_STORAGE];\n  }\n\n  return [\n    permissionModule.PERMISSIONS.ANDROID.WRITE_EXTERNAL_STORAGE,\n    permissionModule.PERMISSIONS.ANDROID.READ_EXTERNAL_STORAGE,\n  ];\n}\n\nconst createNativeFileService = ({\n  imagePickerModule,\n  documentPickerModule,\n  permissionModule,\n  mediaLibraryModule,\n  fsModule,\n}: {\n  imagePickerModule: typeof ImagePicker;\n  documentPickerModule: typeof DocumentPicker;\n  permissionModule: typeof Permissions;\n  mediaLibraryModule: typeof CameraRoll;\n  fsModule: typeof FileAccess;\n}): FileServiceInterface => {\n  const cameraPermissions: Permission[] = Platform.select({\n    ios: [permissionModule.PERMISSIONS.IOS.CAMERA, permissionModule.PERMISSIONS.IOS.MICROPHONE],\n    android: [permissionModule.PERMISSIONS.ANDROID.CAMERA],\n    default: [],\n  });\n  const mediaLibraryPermissions: Permission[] = Platform.select({\n    ios: [permissionModule.PERMISSIONS.IOS.PHOTO_LIBRARY, permissionModule.PERMISSIONS.IOS.PHOTO_LIBRARY_ADD_ONLY],\n    android: getAndroidStoragePermissionsByAPILevel(permissionModule),\n    default: [],\n  });\n\n  class NativeFileService implements FileServiceInterface {\n    async hasCameraPermission(): Promise<boolean> {\n      const status = await permissionModule.checkMultiple(cameraPermissions);\n      return nativePermissionGranted(status);\n    }\n    async requestCameraPermission(): Promise<boolean> {\n      const status = await permissionModule.requestMultiple(cameraPermissions);\n      return nativePermissionGranted(status);\n    }\n    async hasMediaLibraryPermission(): Promise<boolean> {\n      const status = await permissionModule.checkMultiple(mediaLibraryPermissions);\n      return nativePermissionGranted(status);\n    }\n    async requestMediaLibraryPermission(): Promise<boolean> {\n      const status = await permissionModule.requestMultiple(mediaLibraryPermissions);\n      return nativePermissionGranted(status);\n    }\n\n    async openCamera(options?: OpenCameraOptions): Promise<FilePickerResponse> {\n      const hasPermission = await this.hasCameraPermission();\n      if (!hasPermission) {\n        const granted = await this.requestCameraPermission();\n        if (!granted) {\n          options?.onOpenFailure?.(SBUError.PERMISSIONS_DENIED);\n          return null;\n        }\n      }\n\n      const response = await imagePickerModule.launchCamera({\n        presentationStyle: 'fullScreen',\n        cameraType: options?.cameraType ?? 'back',\n        mediaType: (() => {\n          switch (options?.mediaType) {\n            case 'photo':\n              return 'photo';\n            case 'video':\n              return 'video';\n            case 'all':\n              return 'mixed';\n            default:\n              return 'photo';\n          }\n        })(),\n      });\n      if (response.didCancel) return null;\n      if (response.errorCode === 'camera_unavailable') {\n        options?.onOpenFailure?.(SBUError.DEVICE_UNAVAILABLE, new Error(response.errorMessage));\n        return null;\n      }\n\n      const { fileName: name, fileSize: size, type, uri } = response.assets?.[0] ?? {};\n      return normalizeFile({ uri, size, name, type });\n    }\n    async openMediaLibrary(options?: OpenMediaLibraryOptions): Promise<FilePickerResponse[] | null> {\n      /**\n       * NOTE: options.selectionLimit {@link https://github.com/react-native-image-picker/react-native-image-picker#options}\n       * We do not support 0 (any number of files)\n       **/\n      const selectionLimit = options?.selectionLimit || 1;\n      const hasPermission = await this.hasMediaLibraryPermission();\n      if (!hasPermission) {\n        const granted = await this.requestMediaLibraryPermission();\n        if (!granted) {\n          options?.onOpenFailure?.(SBUError.PERMISSIONS_DENIED);\n          return null;\n        }\n      }\n\n      const response = await imagePickerModule.launchImageLibrary({\n        presentationStyle: 'fullScreen',\n        selectionLimit,\n        mediaType: (() => {\n          switch (options?.mediaType) {\n            case 'photo':\n              return 'photo';\n            case 'video':\n              return 'video';\n            case 'all':\n              return 'mixed';\n            default:\n              return 'photo';\n          }\n        })(),\n      });\n      if (response.didCancel) return null;\n      if (response.errorCode === 'camera_unavailable') {\n        options?.onOpenFailure?.(SBUError.DEVICE_UNAVAILABLE, new Error(response.errorMessage));\n        return null;\n      }\n\n      return Promise.all(\n        (response.assets || [])\n          .slice(0, selectionLimit)\n          .map(({ fileName: name, fileSize: size, type, uri }) => normalizeFile({ uri, size, name, type })),\n      );\n    }\n    async openDocument(options?: OpenDocumentOptions): Promise<FilePickerResponse> {\n      try {\n        const { uri, size, name, type } = await documentPickerModule.pickSingle();\n        return normalizeFile({ uri, size, name, type });\n      } catch (e) {\n        if (!documentPickerModule.isCancel(e) && documentPickerModule.isInProgress(e)) {\n          options?.onOpenFailure?.(SBUError.UNKNOWN, e);\n        }\n        return null;\n      }\n    }\n    async save(options: SaveOptions): Promise<string> {\n      const hasPermission = await this.hasMediaLibraryPermission();\n      if (!hasPermission) {\n        const granted = await this.requestMediaLibraryPermission();\n        if (!granted) throw new Error('Permission not granted');\n      }\n\n      const { downloadedPath, file } = await this.downloadFile(options);\n\n      if (Platform.OS === 'ios') {\n        if (file.type === 'image' || file.type === 'video') {\n          const mediaTypeMap = { 'image': 'photo', 'video': 'video' } as const;\n          const mediaType = mediaTypeMap[file.type];\n          await mediaLibraryModule.save(downloadedPath, { type: mediaType });\n        }\n      }\n\n      if (Platform.OS === 'android') {\n        const externalDirMap = { 'file': 'downloads', 'audio': 'audio', 'image': 'images', 'video': 'video' } as const;\n        const externalDir = externalDirMap[file.type];\n        await fsModule.FileSystem.cpExternal(downloadedPath, file.name, externalDir).catch(() => {\n          Logger.error('Failed to save file to external storage. Retry saving to downloads directory instead.');\n          return fsModule.FileSystem.cpExternal(downloadedPath, file.name, 'downloads');\n        });\n      }\n\n      return downloadedPath;\n    }\n\n    private buildDownloadPath = async (options: SaveOptions) => {\n      const dirname = Platform.select({ android: fsModule.Dirs.CacheDir, default: fsModule.Dirs.DocumentDir });\n      const context = { dirname, filename: options.fileName };\n      const extension =\n        getFileExtension(options.fileName) ||\n        getFileExtensionFromMime(options.fileType) ||\n        getFileExtension(options.fileUrl) ||\n        (await getFileExtensionFromUri(options.fileUrl));\n\n      if (extension) context.filename = normalizeFileName(context.filename, extension);\n\n      return { path: `${context.dirname}/${context.filename}`, ...context };\n    };\n\n    private downloadFile = async (options: SaveOptions) => {\n      const { path, filename } = await this.buildDownloadPath(options);\n      await fsModule.FileSystem.fetch(options.fileUrl, { path });\n      return {\n        downloadedPath: path,\n        file: {\n          name: filename,\n          type: getFileType(getFileExtension(path)),\n        } as const,\n      };\n    };\n\n    createRecordFilePath(customExtension = 'm4a'): { recordFilePath: string; uri: string } {\n      const filename = `record-${Date.now()}.${customExtension}`;\n      const path = `${fsModule.Dirs.CacheDir}/${filename}`;\n      return Platform.select({\n        ios: {\n          uri: path,\n          recordFilePath: filename,\n        },\n        android: {\n          uri: path.startsWith('file://') ? path : 'file://' + path,\n          recordFilePath: path,\n        },\n        default: {\n          uri: path,\n          recordFilePath: path,\n        },\n      });\n    }\n  }\n\n  return new NativeFileService();\n};\n\nexport default createNativeFileService;\n"],"mappings":"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"}