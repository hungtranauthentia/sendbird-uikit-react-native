{"version":3,"names":["React","getDownscaleSize","getFileExtension","hash","SBUUtils","createNativeMediaService","_ref","VideoComponent","thumbnailModule","imageResizerModule","_ref2","source","resizeMode","onLoad","props","createElement","_extends","controls","getVideoThumbnail","_ref3","url","timeMills","path","createThumbnail","format","timeStamp","cacheName","split","compressImage","_ref4","uri","maxWidth","maxHeight","compressionRate","originSize","getImageSize","width","height","extension","size","resizedSize","compressedURI","default","createResizedImage","Math","min","max"],"sources":["createMediaService.native.tsx"],"sourcesContent":["import type * as RNImageResizer from '@bam.tech/react-native-image-resizer';\nimport React from 'react';\nimport type * as RNCreateThumbnail from 'react-native-create-thumbnail';\nimport type RNVideo from 'react-native-video';\n\nimport { getDownscaleSize, getFileExtension, hash } from '@sendbird/uikit-utils';\n\nimport SBUUtils from '../libs/SBUUtils';\nimport type { MediaServiceInterface } from './types';\n\ntype Modules = {\n  VideoComponent: typeof RNVideo;\n  thumbnailModule: typeof RNCreateThumbnail;\n  imageResizerModule: typeof RNImageResizer;\n};\n\nconst createNativeMediaService = ({\n  VideoComponent,\n  thumbnailModule,\n  imageResizerModule,\n}: Modules): MediaServiceInterface => {\n  return {\n    VideoComponent({ source, resizeMode, onLoad, ...props }) {\n      return <VideoComponent {...props} source={source} resizeMode={resizeMode} onLoad={onLoad} controls />;\n    },\n    async getVideoThumbnail({ url, timeMills }) {\n      try {\n        const { path } = await thumbnailModule.createThumbnail({\n          url,\n          format: 'jpeg',\n          timeStamp: timeMills,\n          cacheName: hash(url.split('?')[0]),\n        });\n        return { path };\n      } catch {\n        return null;\n      }\n    },\n    async compressImage({ uri, maxWidth, maxHeight, compressionRate = 1 }) {\n      const originSize = await SBUUtils.getImageSize(uri);\n      const { width, height } = getDownscaleSize(originSize, { width: maxWidth, height: maxHeight });\n      const extension = (() => {\n        return { 'png': 'PNG', 'jpeg': 'JPEG', 'jpg': 'JPEG' }[getFileExtension(uri)] ?? 'JPEG';\n      })() as 'PNG' | 'JPEG';\n\n      const { size: resizedSize, uri: compressedURI } = await imageResizerModule.default.createResizedImage(\n        uri,\n        width,\n        height,\n        extension,\n        Math.min(Math.max(0, compressionRate), 1) * 100,\n      );\n\n      return { uri: compressedURI, size: resizedSize };\n    },\n  };\n};\n\nexport default createNativeMediaService;\n"],"mappings":";AACA,OAAOA,KAAK,MAAM,OAAO;AAIzB,SAASC,gBAAgB,EAAEC,gBAAgB,EAAEC,IAAI,QAAQ,uBAAuB;AAEhF,OAAOC,QAAQ,MAAM,kBAAkB;AASvC,MAAMC,wBAAwB,GAAGC,IAAA,IAIK;EAAA,IAJJ;IAChCC,cAAc;IACdC,eAAe;IACfC;EACO,CAAC,GAAAH,IAAA;EACR,OAAO;IACLC,cAAcA,CAAAG,KAAA,EAA2C;MAAA,IAA1C;QAAEC,MAAM;QAAEC,UAAU;QAAEC,MAAM;QAAE,GAAGC;MAAM,CAAC,GAAAJ,KAAA;MACrD,oBAAOV,KAAA,CAAAe,aAAA,CAACR,cAAc,EAAAS,QAAA,KAAKF,KAAK;QAAEH,MAAM,EAAEA,MAAO;QAACC,UAAU,EAAEA,UAAW;QAACC,MAAM,EAAEA,MAAO;QAACI,QAAQ;MAAA,GAAG;IACvG,CAAC;IACD,MAAMC,iBAAiBA,CAAAC,KAAA,EAAqB;MAAA,IAApB;QAAEC,GAAG;QAAEC;MAAU,CAAC,GAAAF,KAAA;MACxC,IAAI;QACF,MAAM;UAAEG;QAAK,CAAC,GAAG,MAAMd,eAAe,CAACe,eAAe,CAAC;UACrDH,GAAG;UACHI,MAAM,EAAE,MAAM;UACdC,SAAS,EAAEJ,SAAS;UACpBK,SAAS,EAAEvB,IAAI,CAACiB,GAAG,CAACO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACnC,CAAC,CAAC;QACF,OAAO;UAAEL;QAAK,CAAC;MACjB,CAAC,CAAC,MAAM;QACN,OAAO,IAAI;MACb;IACF,CAAC;IACD,MAAMM,aAAaA,CAAAC,KAAA,EAAoD;MAAA,IAAnD;QAAEC,GAAG;QAAEC,QAAQ;QAAEC,SAAS;QAAEC,eAAe,GAAG;MAAE,CAAC,GAAAJ,KAAA;MACnE,MAAMK,UAAU,GAAG,MAAM9B,QAAQ,CAAC+B,YAAY,CAACL,GAAG,CAAC;MACnD,MAAM;QAAEM,KAAK;QAAEC;MAAO,CAAC,GAAGpC,gBAAgB,CAACiC,UAAU,EAAE;QAAEE,KAAK,EAAEL,QAAQ;QAAEM,MAAM,EAAEL;MAAU,CAAC,CAAC;MAC9F,MAAMM,SAAS,GAAG,CAAC,MAAM;QACvB,OAAO;UAAE,KAAK,EAAE,KAAK;UAAE,MAAM,EAAE,MAAM;UAAE,KAAK,EAAE;QAAO,CAAC,CAACpC,gBAAgB,CAAC4B,GAAG,CAAC,CAAC,IAAI,MAAM;MACzF,CAAC,GAAqB;MAEtB,MAAM;QAAES,IAAI,EAAEC,WAAW;QAAEV,GAAG,EAAEW;MAAc,CAAC,GAAG,MAAMhC,kBAAkB,CAACiC,OAAO,CAACC,kBAAkB,CACnGb,GAAG,EACHM,KAAK,EACLC,MAAM,EACNC,SAAS,EACTM,IAAI,CAACC,GAAG,CAACD,IAAI,CAACE,GAAG,CAAC,CAAC,EAAEb,eAAe,CAAC,EAAE,CAAC,CAAC,GAAG,GAAG,CAChD;MAED,OAAO;QAAEH,GAAG,EAAEW,aAAa;QAAEF,IAAI,EAAEC;MAAY,CAAC;IAClD;EACF,CAAC;AACH,CAAC;AAED,eAAenC,wBAAwB"}