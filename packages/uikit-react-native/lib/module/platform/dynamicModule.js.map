{"version":3,"names":["NativeModules","UIManager","Logger","checkLink","dmi","logLevel","nativeModule","isComponent","getViewManagerConfig","nativeModuleNamespace","message","packageName","url","console","error","warn","SBUDynamicModuleRegistry","getPackage","require","e","SBUDynamicModule","register","mdi","getInfo","name","get","arguments","length","undefined"],"sources":["dynamicModule.ts"],"sourcesContent":["/* eslint-disable no-console */\nimport type * as RNCNetInfo from '@react-native-community/netinfo';\nimport { NativeModules, UIManager } from 'react-native';\n\nimport { Logger } from '@sendbird/uikit-utils';\n\nexport type SBUNativeModule = keyof DynamicModules;\n\ninterface SBUDynamicModuleInfo {\n  packageName: SBUNativeModule;\n  nativeModuleNamespace: string;\n  getPackage: <T>(logLevel: 'error' | 'warn' | 'none') => T;\n  url: string;\n  isComponent?: boolean;\n}\n\nfunction checkLink(dmi: SBUDynamicModuleInfo, logLevel: 'error' | 'warn' | 'none') {\n  const nativeModule = (() => {\n    if (dmi.isComponent) {\n      return UIManager.getViewManagerConfig(dmi.nativeModuleNamespace);\n    } else {\n      return NativeModules[dmi.nativeModuleNamespace];\n    }\n  })();\n\n  if (!nativeModule) {\n    const message = `[UIKit] Cannot use native module, you should install and link ${dmi.packageName} (${dmi.url})`;\n    if (logLevel === 'error') console.error(message);\n    if (logLevel === 'warn') console.warn(message);\n  }\n}\n\nexport interface DynamicModules {\n  '@react-native-community/netinfo': typeof RNCNetInfo;\n}\n\nconst SBUDynamicModuleRegistry: Record<SBUNativeModule, SBUDynamicModuleInfo> = {\n  '@react-native-community/netinfo': {\n    packageName: '@react-native-community/netinfo',\n    nativeModuleNamespace: 'RNCNetInfo',\n    url: 'https://github.com/react-native-netinfo/react-native-netinfo',\n    getPackage(logLevel) {\n      checkLink(this, logLevel);\n\n      try {\n        return require('@react-native-community/netinfo');\n      } catch (e) {\n        return null;\n      }\n    },\n  },\n};\n\nconst SBUDynamicModule = {\n  register(mdi: SBUDynamicModuleInfo) {\n    SBUDynamicModuleRegistry[mdi.nativeModuleNamespace as SBUNativeModule] = mdi;\n  },\n  getInfo(name: SBUNativeModule) {\n    return SBUDynamicModuleRegistry[name] ?? null;\n  },\n  get<K extends SBUNativeModule, T extends DynamicModules[K]>(name: K, logLevel: 'error' | 'warn' | 'none' = 'error') {\n    const dmi = this.getInfo(name);\n    if (!dmi) Logger.warn(`${name} doesn't exist in the dynamic module`);\n    return dmi?.getPackage<T>(logLevel);\n  },\n};\n\nexport default SBUDynamicModule;\n"],"mappings":"AAAA;;AAEA,SAASA,aAAa,EAAEC,SAAS,QAAQ,cAAc;AAEvD,SAASC,MAAM,QAAQ,uBAAuB;AAY9C,SAASC,SAASA,CAACC,GAAyB,EAAEC,QAAmC,EAAE;EACjF,MAAMC,YAAY,GAAG,CAAC,MAAM;IAC1B,IAAIF,GAAG,CAACG,WAAW,EAAE;MACnB,OAAON,SAAS,CAACO,oBAAoB,CAACJ,GAAG,CAACK,qBAAqB,CAAC;IAClE,CAAC,MAAM;MACL,OAAOT,aAAa,CAACI,GAAG,CAACK,qBAAqB,CAAC;IACjD;EACF,CAAC,GAAG;EAEJ,IAAI,CAACH,YAAY,EAAE;IACjB,MAAMI,OAAO,GAAI,iEAAgEN,GAAG,CAACO,WAAY,KAAIP,GAAG,CAACQ,GAAI,GAAE;IAC/G,IAAIP,QAAQ,KAAK,OAAO,EAAEQ,OAAO,CAACC,KAAK,CAACJ,OAAO,CAAC;IAChD,IAAIL,QAAQ,KAAK,MAAM,EAAEQ,OAAO,CAACE,IAAI,CAACL,OAAO,CAAC;EAChD;AACF;AAMA,MAAMM,wBAAuE,GAAG;EAC9E,iCAAiC,EAAE;IACjCL,WAAW,EAAE,iCAAiC;IAC9CF,qBAAqB,EAAE,YAAY;IACnCG,GAAG,EAAE,8DAA8D;IACnEK,UAAUA,CAACZ,QAAQ,EAAE;MACnBF,SAAS,CAAC,IAAI,EAAEE,QAAQ,CAAC;MAEzB,IAAI;QACF,OAAOa,OAAO,CAAC,iCAAiC,CAAC;MACnD,CAAC,CAAC,OAAOC,CAAC,EAAE;QACV,OAAO,IAAI;MACb;IACF;EACF;AACF,CAAC;AAED,MAAMC,gBAAgB,GAAG;EACvBC,QAAQA,CAACC,GAAyB,EAAE;IAClCN,wBAAwB,CAACM,GAAG,CAACb,qBAAqB,CAAoB,GAAGa,GAAG;EAC9E,CAAC;EACDC,OAAOA,CAACC,IAAqB,EAAE;IAC7B,OAAOR,wBAAwB,CAACQ,IAAI,CAAC,IAAI,IAAI;EAC/C,CAAC;EACDC,GAAGA,CAAyDD,IAAO,EAAiD;IAAA,IAA/CnB,QAAmC,GAAAqB,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,OAAO;IAChH,MAAMtB,GAAG,GAAG,IAAI,CAACmB,OAAO,CAACC,IAAI,CAAC;IAC9B,IAAI,CAACpB,GAAG,EAAEF,MAAM,CAACa,IAAI,CAAE,GAAES,IAAK,sCAAqC,CAAC;IACpE,OAAOpB,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEa,UAAU,CAAIZ,QAAQ,CAAC;EACrC;AACF,CAAC;AAED,eAAee,gBAAgB"}