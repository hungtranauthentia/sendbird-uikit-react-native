{"version":3,"names":["React","useContext","useEffect","useChannelHandler","useToast","isDifferentChannel","useFreshCallback","useIsFirstMount","useUniqHandlerId","ChannelMessageList","MESSAGE_FOCUS_ANIMATION_DELAY","MESSAGE_SEARCH_SAFE_SCROLL_DELAY","useLocalization","useSendbirdChat","GroupChannelContexts","GroupChannelMessageList","props","toast","STRINGS","sdk","setMessageToEdit","setMessageToReply","Fragment","subscribe","PubSub","flatListRef","lazyScrollToBottom","lazyScrollToIndex","MessageList","id","isFirstMount","scrollToMessageWithCreatedAt","createdAt","focusAnimated","timeout","foundMessageIndex","messages","findIndex","it","isIncludedInList","setTimeout","onUpdateSearchItem","startingPoint","index","animated","channel","messageOffsetTimestamp","onResetMessageListWithStartingPoint","scrollToBottom","arguments","length","undefined","hasNext","onScrolledAwayFromBottom","onResetMessageList","onReactionUpdated","event","recentMessage","isRecentMessage","messageId","scrollReachedBottomAndCanScroll","scrolledAwayFromBottom","_ref","type","searchItem","onPressParentMessage","message","canScrollToParent","show","TOAST","FIND_PARENT_MSG_ERROR","createElement","_extends","ref","onReplyMessage","onEditMessage","onPressNewMessagesButton","onPressScrollToBottomButton","memo"],"sources":["GroupChannelMessageList.tsx"],"sourcesContent":["import React, { useContext, useEffect } from 'react';\n\nimport { useChannelHandler } from '@sendbird/uikit-chat-hooks';\nimport { useToast } from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdMessage } from '@sendbird/uikit-utils';\nimport { isDifferentChannel, useFreshCallback, useIsFirstMount, useUniqHandlerId } from '@sendbird/uikit-utils';\n\nimport ChannelMessageList from '../../../components/ChannelMessageList';\nimport { MESSAGE_FOCUS_ANIMATION_DELAY, MESSAGE_SEARCH_SAFE_SCROLL_DELAY } from '../../../constants';\nimport { useLocalization, useSendbirdChat } from '../../../hooks/useContext';\nimport { GroupChannelContexts } from '../module/moduleContext';\nimport type { GroupChannelProps } from '../types';\n\nconst GroupChannelMessageList = (props: GroupChannelProps['MessageList']) => {\n  const toast = useToast();\n  const { STRINGS } = useLocalization();\n  const { sdk } = useSendbirdChat();\n  const { setMessageToEdit, setMessageToReply } = useContext(GroupChannelContexts.Fragment);\n  const { subscribe } = useContext(GroupChannelContexts.PubSub);\n  const { flatListRef, lazyScrollToBottom, lazyScrollToIndex } = useContext(GroupChannelContexts.MessageList);\n\n  const id = useUniqHandlerId('GroupChannelMessageList');\n  const isFirstMount = useIsFirstMount();\n\n  const scrollToMessageWithCreatedAt = useFreshCallback(\n    (createdAt: number, focusAnimated: boolean, timeout: number): boolean => {\n      const foundMessageIndex = props.messages.findIndex((it) => it.createdAt === createdAt);\n      const isIncludedInList = foundMessageIndex > -1;\n\n      if (isIncludedInList) {\n        if (focusAnimated) {\n          setTimeout(() => props.onUpdateSearchItem({ startingPoint: createdAt }), MESSAGE_FOCUS_ANIMATION_DELAY);\n        }\n        lazyScrollToIndex({ index: foundMessageIndex, animated: true, timeout });\n      } else {\n        if (props.channel.messageOffsetTimestamp <= createdAt) {\n          if (focusAnimated) {\n            props.onUpdateSearchItem({ startingPoint: createdAt });\n          }\n          props.onResetMessageListWithStartingPoint(createdAt);\n        } else {\n          return false;\n        }\n      }\n      return true;\n    },\n  );\n\n  const scrollToBottom = useFreshCallback(async (animated = false) => {\n    if (props.hasNext()) {\n      props.onUpdateSearchItem(undefined);\n      props.onScrolledAwayFromBottom(false);\n\n      await props.onResetMessageList();\n      props.onScrolledAwayFromBottom(false);\n      lazyScrollToBottom({ animated });\n    } else {\n      lazyScrollToBottom({ animated });\n    }\n  });\n\n  useChannelHandler(sdk, id, {\n    onReactionUpdated(channel, event) {\n      if (isDifferentChannel(channel, props.channel)) return;\n      const recentMessage = props.messages[0];\n      const isRecentMessage = recentMessage && recentMessage.messageId === event.messageId;\n      const scrollReachedBottomAndCanScroll = !props.scrolledAwayFromBottom && !props.hasNext();\n      if (isRecentMessage && scrollReachedBottomAndCanScroll) {\n        lazyScrollToBottom({ animated: true, timeout: 250 });\n      }\n    },\n  });\n\n  useEffect(() => {\n    return subscribe(({ type }) => {\n      switch (type) {\n        case 'TYPING_BUBBLE_RENDERED':\n        case 'MESSAGES_RECEIVED': {\n          if (!props.scrolledAwayFromBottom) {\n            scrollToBottom(true);\n          }\n          break;\n        }\n        case 'MESSAGE_SENT_SUCCESS':\n        case 'MESSAGE_SENT_PENDING': {\n          scrollToBottom(false);\n          break;\n        }\n      }\n    });\n  }, [props.scrolledAwayFromBottom]);\n\n  useEffect(() => {\n    // Only trigger once when message list mount with initial props.searchItem\n    // - Search screen + searchItem > mount message list\n    // - Reset message list + searchItem > re-mount message list\n    if (isFirstMount && props.searchItem) {\n      scrollToMessageWithCreatedAt(props.searchItem.startingPoint, false, MESSAGE_SEARCH_SAFE_SCROLL_DELAY);\n    }\n  }, [isFirstMount]);\n\n  const onPressParentMessage = useFreshCallback((message: SendbirdMessage) => {\n    const canScrollToParent = scrollToMessageWithCreatedAt(message.createdAt, true, 0);\n    if (!canScrollToParent) toast.show(STRINGS.TOAST.FIND_PARENT_MSG_ERROR, 'error');\n  });\n\n  return (\n    <ChannelMessageList\n      {...props}\n      ref={flatListRef}\n      onReplyMessage={setMessageToReply}\n      onEditMessage={setMessageToEdit}\n      onPressParentMessage={onPressParentMessage}\n      onPressNewMessagesButton={scrollToBottom}\n      onPressScrollToBottomButton={scrollToBottom}\n    />\n  );\n};\n\nexport default React.memo(GroupChannelMessageList);\n"],"mappings":"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"}