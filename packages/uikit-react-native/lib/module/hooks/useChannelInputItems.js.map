{"version":3,"names":["useAlert","useToast","isImage","shouldCompressImage","useIIFE","SBUError","SBUUtils","useLocalization","usePlatformService","useSendbirdChat","useChannelInputItems","channel","sendFileMessage","sbOptions","imageCompressionConfig","STRINGS","fileService","mediaService","alert","toast","sheetItems","input","isOpenChannel","uikit","openChannel","isGroupChannel","groupChannel","enableDocument","camera","enablePhoto","enableVideo","gallery","push","title","LABELS","CHANNEL_INPUT_ATTACHMENT_CAMERA_PHOTO","icon","onPress","mediaFile","openCamera","mediaType","onOpenFailure","error","code","CODE","ERR_PERMISSIONS_DENIED","DIALOG","ALERT_PERMISSIONS_TITLE","message","ALERT_PERMISSIONS_MESSAGE","PERMISSION_CAMERA","PERMISSION_APP_NAME","buttons","text","ALERT_PERMISSIONS_OK","openSettings","show","TOAST","OPEN_CAMERA_ERROR","uri","type","chat","imageCompressionEnabled","safeRun","compressed","compressImage","maxWidth","width","maxHeight","height","compressionRate","size","CHANNEL_INPUT_ATTACHMENT_CAMERA_VIDEO","CHANNEL_INPUT_ATTACHMENT_PHOTO_LIBRARY","mediaFiles","openMediaLibrary","selectionLimit","PERMISSION_DEVICE_STORAGE","OPEN_PHOTO_LIBRARY_ERROR","CHANNEL_INPUT_ATTACHMENT_FILES","documentFile","openDocument","OPEN_FILES_ERROR"],"sources":["useChannelInputItems.ts"],"sourcesContent":["import { BottomSheetItem, useAlert, useToast } from '@sendbird/uikit-react-native-foundation';\nimport { SendbirdChannel, isImage, shouldCompressImage, useIIFE } from '@sendbird/uikit-utils';\n\nimport SBUError from '../libs/SBUError';\nimport SBUUtils from '../libs/SBUUtils';\nimport { FileType } from '../platform/types';\nimport { useLocalization, usePlatformService, useSendbirdChat } from './useContext';\n\nexport const useChannelInputItems = (channel: SendbirdChannel, sendFileMessage: (file: FileType) => void) => {\n  const { sbOptions, imageCompressionConfig } = useSendbirdChat();\n  const { STRINGS } = useLocalization();\n  const { fileService, mediaService } = usePlatformService();\n  const { alert } = useAlert();\n  const toast = useToast();\n\n  const sheetItems: BottomSheetItem['sheetItems'] = [];\n  const input = useIIFE(() => {\n    switch (true) {\n      case channel.isOpenChannel():\n        return sbOptions.uikit.openChannel.channel.input;\n      case channel.isGroupChannel():\n        return sbOptions.uikit.groupChannel.channel.input;\n      default:\n        return {\n          enableDocument: true,\n          camera: { enablePhoto: true, enableVideo: true },\n          gallery: { enablePhoto: true, enableVideo: true },\n        };\n    }\n  });\n\n  if (input.camera.enablePhoto) {\n    sheetItems.push({\n      title: STRINGS.LABELS.CHANNEL_INPUT_ATTACHMENT_CAMERA_PHOTO,\n      icon: 'camera',\n      onPress: async () => {\n        const mediaFile = await fileService.openCamera({\n          mediaType: 'photo',\n          onOpenFailure: (error) => {\n            if (error.code === SBUError.CODE.ERR_PERMISSIONS_DENIED) {\n              alert({\n                title: STRINGS.DIALOG.ALERT_PERMISSIONS_TITLE,\n                message: STRINGS.DIALOG.ALERT_PERMISSIONS_MESSAGE(\n                  STRINGS.LABELS.PERMISSION_CAMERA,\n                  STRINGS.LABELS.PERMISSION_APP_NAME,\n                ),\n                buttons: [{ text: STRINGS.DIALOG.ALERT_PERMISSIONS_OK, onPress: () => SBUUtils.openSettings() }],\n              });\n            } else {\n              toast.show(STRINGS.TOAST.OPEN_CAMERA_ERROR, 'error');\n            }\n          },\n        });\n\n        if (mediaFile) {\n          // Image compression\n          if (\n            isImage(mediaFile.uri, mediaFile.type) &&\n            shouldCompressImage(mediaFile.type, sbOptions.chat.imageCompressionEnabled)\n          ) {\n            await SBUUtils.safeRun(async () => {\n              const compressed = await mediaService.compressImage({\n                uri: mediaFile.uri,\n                maxWidth: imageCompressionConfig.width,\n                maxHeight: imageCompressionConfig.height,\n                compressionRate: imageCompressionConfig.compressionRate,\n              });\n\n              if (compressed) {\n                mediaFile.uri = compressed.uri;\n                mediaFile.size = compressed.size;\n              }\n            });\n          }\n\n          sendFileMessage(mediaFile);\n        }\n      },\n    });\n  }\n\n  if (input.camera.enableVideo) {\n    sheetItems.push({\n      title: STRINGS.LABELS.CHANNEL_INPUT_ATTACHMENT_CAMERA_VIDEO,\n      icon: 'camera',\n      onPress: async () => {\n        const mediaFile = await fileService.openCamera({\n          mediaType: 'video',\n          onOpenFailure: (error) => {\n            if (error.code === SBUError.CODE.ERR_PERMISSIONS_DENIED) {\n              alert({\n                title: STRINGS.DIALOG.ALERT_PERMISSIONS_TITLE,\n                message: STRINGS.DIALOG.ALERT_PERMISSIONS_MESSAGE(\n                  STRINGS.LABELS.PERMISSION_CAMERA,\n                  STRINGS.LABELS.PERMISSION_APP_NAME,\n                ),\n                buttons: [{ text: STRINGS.DIALOG.ALERT_PERMISSIONS_OK, onPress: () => SBUUtils.openSettings() }],\n              });\n            } else {\n              toast.show(STRINGS.TOAST.OPEN_CAMERA_ERROR, 'error');\n            }\n          },\n        });\n\n        if (mediaFile) {\n          sendFileMessage(mediaFile);\n        }\n      },\n    });\n  }\n\n  if (input.gallery.enablePhoto || input.gallery.enableVideo) {\n    const mediaType = (() => {\n      switch (true) {\n        case input.gallery.enablePhoto && input.gallery.enableVideo:\n          return 'all';\n        case input.gallery.enablePhoto && !input.gallery.enableVideo:\n          return 'photo';\n        case !input.gallery.enablePhoto && input.gallery.enableVideo:\n          return 'video';\n        default:\n          return 'all';\n      }\n    })();\n\n    sheetItems.push({\n      title: STRINGS.LABELS.CHANNEL_INPUT_ATTACHMENT_PHOTO_LIBRARY,\n      icon: 'photo',\n      onPress: async () => {\n        const mediaFiles = await fileService.openMediaLibrary({\n          selectionLimit: 1,\n          mediaType,\n          onOpenFailure: (error) => {\n            if (error.code === SBUError.CODE.ERR_PERMISSIONS_DENIED) {\n              alert({\n                title: STRINGS.DIALOG.ALERT_PERMISSIONS_TITLE,\n                message: STRINGS.DIALOG.ALERT_PERMISSIONS_MESSAGE(\n                  STRINGS.LABELS.PERMISSION_DEVICE_STORAGE,\n                  STRINGS.LABELS.PERMISSION_APP_NAME,\n                ),\n                buttons: [{ text: STRINGS.DIALOG.ALERT_PERMISSIONS_OK, onPress: () => SBUUtils.openSettings() }],\n              });\n            } else {\n              toast.show(STRINGS.TOAST.OPEN_PHOTO_LIBRARY_ERROR, 'error');\n            }\n          },\n        });\n\n        if (mediaFiles && mediaFiles[0]) {\n          const mediaFile = mediaFiles[0];\n\n          // Image compression\n          if (\n            isImage(mediaFile.uri, mediaFile.type) &&\n            shouldCompressImage(mediaFile.type, sbOptions.chat.imageCompressionEnabled)\n          ) {\n            await SBUUtils.safeRun(async () => {\n              const compressed = await mediaService.compressImage({\n                uri: mediaFile.uri,\n                maxWidth: imageCompressionConfig.width,\n                maxHeight: imageCompressionConfig.height,\n                compressionRate: imageCompressionConfig.compressionRate,\n              });\n\n              if (compressed) {\n                mediaFile.uri = compressed.uri;\n                mediaFile.size = compressed.size;\n              }\n            });\n          }\n\n          sendFileMessage(mediaFile);\n        }\n      },\n    });\n  }\n\n  if (input.enableDocument) {\n    sheetItems.push({\n      title: STRINGS.LABELS.CHANNEL_INPUT_ATTACHMENT_FILES,\n      icon: 'document',\n      onPress: async () => {\n        const documentFile = await fileService.openDocument({\n          onOpenFailure: () => toast.show(STRINGS.TOAST.OPEN_FILES_ERROR, 'error'),\n        });\n\n        if (documentFile) {\n          // Image compression\n          if (\n            isImage(documentFile.uri, documentFile.type) &&\n            shouldCompressImage(documentFile.type, sbOptions.chat.imageCompressionEnabled)\n          ) {\n            await SBUUtils.safeRun(async () => {\n              const compressed = await mediaService.compressImage({\n                uri: documentFile.uri,\n                maxWidth: imageCompressionConfig.width,\n                maxHeight: imageCompressionConfig.height,\n                compressionRate: imageCompressionConfig.compressionRate,\n              });\n\n              if (compressed) {\n                documentFile.uri = compressed.uri;\n                documentFile.size = compressed.size;\n              }\n            });\n          }\n\n          sendFileMessage(documentFile);\n        }\n      },\n    });\n  }\n\n  return sheetItems;\n};\n"],"mappings":"AAAA,SAA0BA,QAAQ,EAAEC,QAAQ,QAAQ,yCAAyC;AAC7F,SAA0BC,OAAO,EAAEC,mBAAmB,EAAEC,OAAO,QAAQ,uBAAuB;AAE9F,OAAOC,QAAQ,MAAM,kBAAkB;AACvC,OAAOC,QAAQ,MAAM,kBAAkB;AAEvC,SAASC,eAAe,EAAEC,kBAAkB,EAAEC,eAAe,QAAQ,cAAc;AAEnF,OAAO,MAAMC,oBAAoB,GAAGA,CAACC,OAAwB,EAAEC,eAAyC,KAAK;EAC3G,MAAM;IAAEC,SAAS;IAAEC;EAAuB,CAAC,GAAGL,eAAe,EAAE;EAC/D,MAAM;IAAEM;EAAQ,CAAC,GAAGR,eAAe,EAAE;EACrC,MAAM;IAAES,WAAW;IAAEC;EAAa,CAAC,GAAGT,kBAAkB,EAAE;EAC1D,MAAM;IAAEU;EAAM,CAAC,GAAGlB,QAAQ,EAAE;EAC5B,MAAMmB,KAAK,GAAGlB,QAAQ,EAAE;EAExB,MAAMmB,UAAyC,GAAG,EAAE;EACpD,MAAMC,KAAK,GAAGjB,OAAO,CAAC,MAAM;IAC1B,QAAQ,IAAI;MACV,KAAKO,OAAO,CAACW,aAAa,EAAE;QAC1B,OAAOT,SAAS,CAACU,KAAK,CAACC,WAAW,CAACb,OAAO,CAACU,KAAK;MAClD,KAAKV,OAAO,CAACc,cAAc,EAAE;QAC3B,OAAOZ,SAAS,CAACU,KAAK,CAACG,YAAY,CAACf,OAAO,CAACU,KAAK;MACnD;QACE,OAAO;UACLM,cAAc,EAAE,IAAI;UACpBC,MAAM,EAAE;YAAEC,WAAW,EAAE,IAAI;YAAEC,WAAW,EAAE;UAAK,CAAC;UAChDC,OAAO,EAAE;YAAEF,WAAW,EAAE,IAAI;YAAEC,WAAW,EAAE;UAAK;QAClD,CAAC;IAAC;EAER,CAAC,CAAC;EAEF,IAAIT,KAAK,CAACO,MAAM,CAACC,WAAW,EAAE;IAC5BT,UAAU,CAACY,IAAI,CAAC;MACdC,KAAK,EAAElB,OAAO,CAACmB,MAAM,CAACC,qCAAqC;MAC3DC,IAAI,EAAE,QAAQ;MACdC,OAAO,EAAE,MAAAA,CAAA,KAAY;QACnB,MAAMC,SAAS,GAAG,MAAMtB,WAAW,CAACuB,UAAU,CAAC;UAC7CC,SAAS,EAAE,OAAO;UAClBC,aAAa,EAAGC,KAAK,IAAK;YACxB,IAAIA,KAAK,CAACC,IAAI,KAAKtC,QAAQ,CAACuC,IAAI,CAACC,sBAAsB,EAAE;cACvD3B,KAAK,CAAC;gBACJe,KAAK,EAAElB,OAAO,CAAC+B,MAAM,CAACC,uBAAuB;gBAC7CC,OAAO,EAAEjC,OAAO,CAAC+B,MAAM,CAACG,yBAAyB,CAC/ClC,OAAO,CAACmB,MAAM,CAACgB,iBAAiB,EAChCnC,OAAO,CAACmB,MAAM,CAACiB,mBAAmB,CACnC;gBACDC,OAAO,EAAE,CAAC;kBAAEC,IAAI,EAAEtC,OAAO,CAAC+B,MAAM,CAACQ,oBAAoB;kBAAEjB,OAAO,EAAEA,CAAA,KAAM/B,QAAQ,CAACiD,YAAY;gBAAG,CAAC;cACjG,CAAC,CAAC;YACJ,CAAC,MAAM;cACLpC,KAAK,CAACqC,IAAI,CAACzC,OAAO,CAAC0C,KAAK,CAACC,iBAAiB,EAAE,OAAO,CAAC;YACtD;UACF;QACF,CAAC,CAAC;QAEF,IAAIpB,SAAS,EAAE;UACb;UACA,IACEpC,OAAO,CAACoC,SAAS,CAACqB,GAAG,EAAErB,SAAS,CAACsB,IAAI,CAAC,IACtCzD,mBAAmB,CAACmC,SAAS,CAACsB,IAAI,EAAE/C,SAAS,CAACgD,IAAI,CAACC,uBAAuB,CAAC,EAC3E;YACA,MAAMxD,QAAQ,CAACyD,OAAO,CAAC,YAAY;cACjC,MAAMC,UAAU,GAAG,MAAM/C,YAAY,CAACgD,aAAa,CAAC;gBAClDN,GAAG,EAAErB,SAAS,CAACqB,GAAG;gBAClBO,QAAQ,EAAEpD,sBAAsB,CAACqD,KAAK;gBACtCC,SAAS,EAAEtD,sBAAsB,CAACuD,MAAM;gBACxCC,eAAe,EAAExD,sBAAsB,CAACwD;cAC1C,CAAC,CAAC;cAEF,IAAIN,UAAU,EAAE;gBACd1B,SAAS,CAACqB,GAAG,GAAGK,UAAU,CAACL,GAAG;gBAC9BrB,SAAS,CAACiC,IAAI,GAAGP,UAAU,CAACO,IAAI;cAClC;YACF,CAAC,CAAC;UACJ;UAEA3D,eAAe,CAAC0B,SAAS,CAAC;QAC5B;MACF;IACF,CAAC,CAAC;EACJ;EAEA,IAAIjB,KAAK,CAACO,MAAM,CAACE,WAAW,EAAE;IAC5BV,UAAU,CAACY,IAAI,CAAC;MACdC,KAAK,EAAElB,OAAO,CAACmB,MAAM,CAACsC,qCAAqC;MAC3DpC,IAAI,EAAE,QAAQ;MACdC,OAAO,EAAE,MAAAA,CAAA,KAAY;QACnB,MAAMC,SAAS,GAAG,MAAMtB,WAAW,CAACuB,UAAU,CAAC;UAC7CC,SAAS,EAAE,OAAO;UAClBC,aAAa,EAAGC,KAAK,IAAK;YACxB,IAAIA,KAAK,CAACC,IAAI,KAAKtC,QAAQ,CAACuC,IAAI,CAACC,sBAAsB,EAAE;cACvD3B,KAAK,CAAC;gBACJe,KAAK,EAAElB,OAAO,CAAC+B,MAAM,CAACC,uBAAuB;gBAC7CC,OAAO,EAAEjC,OAAO,CAAC+B,MAAM,CAACG,yBAAyB,CAC/ClC,OAAO,CAACmB,MAAM,CAACgB,iBAAiB,EAChCnC,OAAO,CAACmB,MAAM,CAACiB,mBAAmB,CACnC;gBACDC,OAAO,EAAE,CAAC;kBAAEC,IAAI,EAAEtC,OAAO,CAAC+B,MAAM,CAACQ,oBAAoB;kBAAEjB,OAAO,EAAEA,CAAA,KAAM/B,QAAQ,CAACiD,YAAY;gBAAG,CAAC;cACjG,CAAC,CAAC;YACJ,CAAC,MAAM;cACLpC,KAAK,CAACqC,IAAI,CAACzC,OAAO,CAAC0C,KAAK,CAACC,iBAAiB,EAAE,OAAO,CAAC;YACtD;UACF;QACF,CAAC,CAAC;QAEF,IAAIpB,SAAS,EAAE;UACb1B,eAAe,CAAC0B,SAAS,CAAC;QAC5B;MACF;IACF,CAAC,CAAC;EACJ;EAEA,IAAIjB,KAAK,CAACU,OAAO,CAACF,WAAW,IAAIR,KAAK,CAACU,OAAO,CAACD,WAAW,EAAE;IAC1D,MAAMU,SAAS,GAAG,CAAC,MAAM;MACvB,QAAQ,IAAI;QACV,KAAKnB,KAAK,CAACU,OAAO,CAACF,WAAW,IAAIR,KAAK,CAACU,OAAO,CAACD,WAAW;UACzD,OAAO,KAAK;QACd,KAAKT,KAAK,CAACU,OAAO,CAACF,WAAW,IAAI,CAACR,KAAK,CAACU,OAAO,CAACD,WAAW;UAC1D,OAAO,OAAO;QAChB,KAAK,CAACT,KAAK,CAACU,OAAO,CAACF,WAAW,IAAIR,KAAK,CAACU,OAAO,CAACD,WAAW;UAC1D,OAAO,OAAO;QAChB;UACE,OAAO,KAAK;MAAC;IAEnB,CAAC,GAAG;IAEJV,UAAU,CAACY,IAAI,CAAC;MACdC,KAAK,EAAElB,OAAO,CAACmB,MAAM,CAACuC,sCAAsC;MAC5DrC,IAAI,EAAE,OAAO;MACbC,OAAO,EAAE,MAAAA,CAAA,KAAY;QACnB,MAAMqC,UAAU,GAAG,MAAM1D,WAAW,CAAC2D,gBAAgB,CAAC;UACpDC,cAAc,EAAE,CAAC;UACjBpC,SAAS;UACTC,aAAa,EAAGC,KAAK,IAAK;YACxB,IAAIA,KAAK,CAACC,IAAI,KAAKtC,QAAQ,CAACuC,IAAI,CAACC,sBAAsB,EAAE;cACvD3B,KAAK,CAAC;gBACJe,KAAK,EAAElB,OAAO,CAAC+B,MAAM,CAACC,uBAAuB;gBAC7CC,OAAO,EAAEjC,OAAO,CAAC+B,MAAM,CAACG,yBAAyB,CAC/ClC,OAAO,CAACmB,MAAM,CAAC2C,yBAAyB,EACxC9D,OAAO,CAACmB,MAAM,CAACiB,mBAAmB,CACnC;gBACDC,OAAO,EAAE,CAAC;kBAAEC,IAAI,EAAEtC,OAAO,CAAC+B,MAAM,CAACQ,oBAAoB;kBAAEjB,OAAO,EAAEA,CAAA,KAAM/B,QAAQ,CAACiD,YAAY;gBAAG,CAAC;cACjG,CAAC,CAAC;YACJ,CAAC,MAAM;cACLpC,KAAK,CAACqC,IAAI,CAACzC,OAAO,CAAC0C,KAAK,CAACqB,wBAAwB,EAAE,OAAO,CAAC;YAC7D;UACF;QACF,CAAC,CAAC;QAEF,IAAIJ,UAAU,IAAIA,UAAU,CAAC,CAAC,CAAC,EAAE;UAC/B,MAAMpC,SAAS,GAAGoC,UAAU,CAAC,CAAC,CAAC;;UAE/B;UACA,IACExE,OAAO,CAACoC,SAAS,CAACqB,GAAG,EAAErB,SAAS,CAACsB,IAAI,CAAC,IACtCzD,mBAAmB,CAACmC,SAAS,CAACsB,IAAI,EAAE/C,SAAS,CAACgD,IAAI,CAACC,uBAAuB,CAAC,EAC3E;YACA,MAAMxD,QAAQ,CAACyD,OAAO,CAAC,YAAY;cACjC,MAAMC,UAAU,GAAG,MAAM/C,YAAY,CAACgD,aAAa,CAAC;gBAClDN,GAAG,EAAErB,SAAS,CAACqB,GAAG;gBAClBO,QAAQ,EAAEpD,sBAAsB,CAACqD,KAAK;gBACtCC,SAAS,EAAEtD,sBAAsB,CAACuD,MAAM;gBACxCC,eAAe,EAAExD,sBAAsB,CAACwD;cAC1C,CAAC,CAAC;cAEF,IAAIN,UAAU,EAAE;gBACd1B,SAAS,CAACqB,GAAG,GAAGK,UAAU,CAACL,GAAG;gBAC9BrB,SAAS,CAACiC,IAAI,GAAGP,UAAU,CAACO,IAAI;cAClC;YACF,CAAC,CAAC;UACJ;UAEA3D,eAAe,CAAC0B,SAAS,CAAC;QAC5B;MACF;IACF,CAAC,CAAC;EACJ;EAEA,IAAIjB,KAAK,CAACM,cAAc,EAAE;IACxBP,UAAU,CAACY,IAAI,CAAC;MACdC,KAAK,EAAElB,OAAO,CAACmB,MAAM,CAAC6C,8BAA8B;MACpD3C,IAAI,EAAE,UAAU;MAChBC,OAAO,EAAE,MAAAA,CAAA,KAAY;QACnB,MAAM2C,YAAY,GAAG,MAAMhE,WAAW,CAACiE,YAAY,CAAC;UAClDxC,aAAa,EAAEA,CAAA,KAAMtB,KAAK,CAACqC,IAAI,CAACzC,OAAO,CAAC0C,KAAK,CAACyB,gBAAgB,EAAE,OAAO;QACzE,CAAC,CAAC;QAEF,IAAIF,YAAY,EAAE;UAChB;UACA,IACE9E,OAAO,CAAC8E,YAAY,CAACrB,GAAG,EAAEqB,YAAY,CAACpB,IAAI,CAAC,IAC5CzD,mBAAmB,CAAC6E,YAAY,CAACpB,IAAI,EAAE/C,SAAS,CAACgD,IAAI,CAACC,uBAAuB,CAAC,EAC9E;YACA,MAAMxD,QAAQ,CAACyD,OAAO,CAAC,YAAY;cACjC,MAAMC,UAAU,GAAG,MAAM/C,YAAY,CAACgD,aAAa,CAAC;gBAClDN,GAAG,EAAEqB,YAAY,CAACrB,GAAG;gBACrBO,QAAQ,EAAEpD,sBAAsB,CAACqD,KAAK;gBACtCC,SAAS,EAAEtD,sBAAsB,CAACuD,MAAM;gBACxCC,eAAe,EAAExD,sBAAsB,CAACwD;cAC1C,CAAC,CAAC;cAEF,IAAIN,UAAU,EAAE;gBACdgB,YAAY,CAACrB,GAAG,GAAGK,UAAU,CAACL,GAAG;gBACjCqB,YAAY,CAACT,IAAI,GAAGP,UAAU,CAACO,IAAI;cACrC;YACF,CAAC,CAAC;UACJ;UAEA3D,eAAe,CAACoE,YAAY,CAAC;QAC/B;MACF;IACF,CAAC,CAAC;EACJ;EAEA,OAAO5D,UAAU;AACnB,CAAC"}