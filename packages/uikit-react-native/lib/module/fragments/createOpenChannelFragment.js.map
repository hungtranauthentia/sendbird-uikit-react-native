{"version":3,"names":["React","useMemo","useState","SendbirdError","useOpenChannelMessages","useToast","NOOP","PASS","SBErrorCode","messageComparator","useFreshCallback","OpenChannelMessageRenderer","ScrollToBottomButton","StatusComposition","UNKNOWN_USER_ID","createOpenChannelModule","useLocalization","useSendbirdChat","pubsub","createOpenChannelFragment","initModule","OpenChannelModule","_ref","channel","onChannelDeleted","onPressHeaderLeft","onPressHeaderRightWithSettings","onPressHeaderRightWithParticipants","onBeforeSendUserMessage","onBeforeSendFileMessage","onBeforeUpdateUserMessage","onBeforeUpdateFileMessage","onPressMediaMessage","renderMessage","renderNewMessagesButton","renderScrollToBottomButton","props","createElement","enableMessageGrouping","keyboardAvoidOffset","flatListProps","queryCreator","sortComparator","sdk","currentUser","STRINGS","show","showToast","openChannelPubSub","messages","newMessages","next","prev","hasNext","sendFileMessage","sendUserMessage","updateFileMessage","updateUserMessage","resendMessage","deleteMessage","loading","userId","onError","error","code","RESOURCE_NOT_FOUND","CHANNEL_NOT_FOUND","BANNED_USER_SEND_MESSAGE_NOT_ALLOWED","TOAST","GET_CHANNEL_ERROR","UNKNOWN_ERROR","onMessagesReceived","publish","type","data","isOperator","_renderMessage","memoizedFlatListProps","ListEmptyComponent","StatusEmpty","contentContainerStyle","flexGrow","onPending","message","onSent","onPressSendUserMessage","params","processedParams","onPressSendFileMessage","onPressUpdateUserMessage","messageId","onPressUpdateFileMessage","Provider","Header","rightIconName","onPressHeaderRight","LoadingComponent","StatusLoading","MessageList","currentUserId","onTopReached","onBottomReached","scrolledAwayFromBottom","onScrolledAwayFromBottom","onResendFailedMessage","onDeleteMessage","Input","shouldRenderInput"],"sources":["createOpenChannelFragment.tsx"],"sourcesContent":["import React, { useMemo, useState } from 'react';\n\nimport { SendbirdError } from '@sendbird/chat';\nimport { useOpenChannelMessages } from '@sendbird/uikit-chat-hooks';\nimport { useToast } from '@sendbird/uikit-react-native-foundation';\nimport {\n  NOOP,\n  PASS,\n  SBErrorCode,\n  SendbirdFileMessage,\n  SendbirdUserMessage,\n  messageComparator,\n  useFreshCallback,\n} from '@sendbird/uikit-utils';\n\nimport OpenChannelMessageRenderer from '../components/OpenChannelMessageRenderer';\nimport ScrollToBottomButton from '../components/ScrollToBottomButton';\nimport StatusComposition from '../components/StatusComposition';\nimport { UNKNOWN_USER_ID } from '../constants';\nimport { createOpenChannelModule } from '../domain/openChannel';\nimport type {\n  OpenChannelFragment,\n  OpenChannelModule,\n  OpenChannelProps,\n  OpenChannelPubSubContextPayload,\n} from '../domain/openChannel/types';\nimport { useLocalization, useSendbirdChat } from '../hooks/useContext';\nimport pubsub from '../utils/pubsub';\n\nconst createOpenChannelFragment = (initModule?: Partial<OpenChannelModule>): OpenChannelFragment => {\n  const OpenChannelModule = createOpenChannelModule(initModule);\n\n  return ({\n    channel,\n    onChannelDeleted = NOOP,\n    onPressHeaderLeft = NOOP,\n    onPressHeaderRightWithSettings = NOOP,\n    onPressHeaderRightWithParticipants = NOOP,\n\n    onBeforeSendUserMessage = PASS,\n    onBeforeSendFileMessage = PASS,\n    onBeforeUpdateUserMessage = PASS,\n    onBeforeUpdateFileMessage = PASS,\n    onPressMediaMessage = NOOP,\n\n    renderMessage,\n    renderNewMessagesButton = () => null,\n    renderScrollToBottomButton = (props) => <ScrollToBottomButton {...props} />,\n\n    enableMessageGrouping = true,\n    keyboardAvoidOffset,\n    flatListProps,\n    queryCreator,\n    sortComparator = messageComparator,\n  }) => {\n    const { sdk, currentUser } = useSendbirdChat();\n\n    const { STRINGS } = useLocalization();\n    const { show: showToast } = useToast();\n\n    const [openChannelPubSub] = useState(() => pubsub<OpenChannelPubSubContextPayload>());\n\n    const {\n      messages,\n      newMessages,\n      next,\n      prev,\n      hasNext,\n      sendFileMessage,\n      sendUserMessage,\n      updateFileMessage,\n      updateUserMessage,\n      resendMessage,\n      deleteMessage,\n      loading,\n    } = useOpenChannelMessages(sdk, channel, currentUser?.userId, {\n      queryCreator,\n      sortComparator,\n      onChannelDeleted,\n      onError(error) {\n        if (error instanceof SendbirdError) {\n          switch (error.code) {\n            case SBErrorCode.RESOURCE_NOT_FOUND:\n            case SBErrorCode.CHANNEL_NOT_FOUND:\n            case SBErrorCode.BANNED_USER_SEND_MESSAGE_NOT_ALLOWED: {\n              return showToast(STRINGS.TOAST.GET_CHANNEL_ERROR, 'error');\n            }\n          }\n        }\n\n        showToast(STRINGS.TOAST.UNKNOWN_ERROR, 'error');\n      },\n      onMessagesReceived(messages) {\n        openChannelPubSub.publish({ type: 'MESSAGES_RECEIVED', data: { messages } });\n      },\n    });\n\n    const isOperator = channel.isOperator(currentUser?.userId ?? UNKNOWN_USER_ID);\n\n    const _renderMessage: OpenChannelProps['MessageList']['renderMessage'] = useFreshCallback((props) => {\n      if (renderMessage) return renderMessage(props);\n      return <OpenChannelMessageRenderer {...props} />;\n    });\n\n    const memoizedFlatListProps = useMemo(\n      () => ({\n        ListEmptyComponent: <OpenChannelModule.StatusEmpty />,\n        contentContainerStyle: { flexGrow: 1 },\n        ...flatListProps,\n      }),\n      [loading, flatListProps],\n    );\n\n    const onPending = (message: SendbirdFileMessage | SendbirdUserMessage) => {\n      openChannelPubSub.publish({ type: 'MESSAGE_SENT_PENDING', data: { message } });\n    };\n    const onSent = (message: SendbirdFileMessage | SendbirdUserMessage) => {\n      openChannelPubSub.publish({ type: 'MESSAGE_SENT_SUCCESS', data: { message } });\n    };\n\n    const onPressSendUserMessage: OpenChannelProps['Input']['onPressSendUserMessage'] = useFreshCallback(\n      async (params) => {\n        const processedParams = await onBeforeSendUserMessage(params);\n        const message = await sendUserMessage(processedParams, onPending);\n        onSent(message);\n      },\n    );\n    const onPressSendFileMessage: OpenChannelProps['Input']['onPressSendFileMessage'] = useFreshCallback(\n      async (params) => {\n        const processedParams = await onBeforeSendFileMessage(params);\n        const message = await sendFileMessage(processedParams, onPending);\n        onSent(message);\n      },\n    );\n    const onPressUpdateUserMessage: OpenChannelProps['Input']['onPressUpdateUserMessage'] = useFreshCallback(\n      async (message, params) => {\n        const processedParams = await onBeforeUpdateUserMessage(params);\n        await updateUserMessage(message.messageId, processedParams);\n      },\n    );\n    const onPressUpdateFileMessage: OpenChannelProps['Input']['onPressUpdateFileMessage'] = useFreshCallback(\n      async (message, params) => {\n        const processedParams = await onBeforeUpdateFileMessage(params);\n        await updateFileMessage(message.messageId, processedParams);\n      },\n    );\n\n    return (\n      <OpenChannelModule.Provider\n        openChannelPubSub={openChannelPubSub}\n        channel={channel}\n        keyboardAvoidOffset={keyboardAvoidOffset}\n      >\n        <OpenChannelModule.Header\n          onPressHeaderLeft={onPressHeaderLeft}\n          rightIconName={isOperator ? 'info' : 'members'}\n          onPressHeaderRight={isOperator ? onPressHeaderRightWithSettings : onPressHeaderRightWithParticipants}\n        />\n        <StatusComposition loading={loading} LoadingComponent={<OpenChannelModule.StatusLoading />}>\n          <OpenChannelModule.MessageList\n            channel={channel}\n            hasNext={hasNext}\n            enableMessageGrouping={enableMessageGrouping}\n            currentUserId={currentUser?.userId}\n            renderMessage={_renderMessage}\n            messages={messages}\n            newMessages={newMessages}\n            onTopReached={prev}\n            onBottomReached={next}\n            scrolledAwayFromBottom={false}\n            onScrolledAwayFromBottom={NOOP}\n            renderNewMessagesButton={renderNewMessagesButton}\n            renderScrollToBottomButton={renderScrollToBottomButton}\n            onResendFailedMessage={resendMessage}\n            onDeleteMessage={deleteMessage}\n            onPressMediaMessage={onPressMediaMessage}\n            flatListProps={memoizedFlatListProps}\n          />\n          <OpenChannelModule.Input\n            shouldRenderInput\n            onPressSendUserMessage={onPressSendUserMessage}\n            onPressSendFileMessage={onPressSendFileMessage}\n            onPressUpdateUserMessage={onPressUpdateUserMessage}\n            onPressUpdateFileMessage={onPressUpdateFileMessage}\n          />\n        </StatusComposition>\n      </OpenChannelModule.Provider>\n    );\n  };\n};\n\nexport default createOpenChannelFragment;\n"],"mappings":"AAAA,OAAOA,KAAK,IAAIC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AAEhD,SAASC,aAAa,QAAQ,gBAAgB;AAC9C,SAASC,sBAAsB,QAAQ,4BAA4B;AACnE,SAASC,QAAQ,QAAQ,yCAAyC;AAClE,SACEC,IAAI,EACJC,IAAI,EACJC,WAAW,EAGXC,iBAAiB,EACjBC,gBAAgB,QACX,uBAAuB;AAE9B,OAAOC,0BAA0B,MAAM,0CAA0C;AACjF,OAAOC,oBAAoB,MAAM,oCAAoC;AACrE,OAAOC,iBAAiB,MAAM,iCAAiC;AAC/D,SAASC,eAAe,QAAQ,cAAc;AAC9C,SAASC,uBAAuB,QAAQ,uBAAuB;AAO/D,SAASC,eAAe,EAAEC,eAAe,QAAQ,qBAAqB;AACtE,OAAOC,MAAM,MAAM,iBAAiB;AAEpC,MAAMC,yBAAyB,GAAIC,UAAuC,IAA0B;EAClG,MAAMC,iBAAiB,GAAGN,uBAAuB,CAACK,UAAU,CAAC;EAE7D,OAAOE,IAAA,IAsBD;IAAA,IAtBE;MACNC,OAAO;MACPC,gBAAgB,GAAGlB,IAAI;MACvBmB,iBAAiB,GAAGnB,IAAI;MACxBoB,8BAA8B,GAAGpB,IAAI;MACrCqB,kCAAkC,GAAGrB,IAAI;MAEzCsB,uBAAuB,GAAGrB,IAAI;MAC9BsB,uBAAuB,GAAGtB,IAAI;MAC9BuB,yBAAyB,GAAGvB,IAAI;MAChCwB,yBAAyB,GAAGxB,IAAI;MAChCyB,mBAAmB,GAAG1B,IAAI;MAE1B2B,aAAa;MACbC,uBAAuB,GAAGA,CAAA,KAAM,IAAI;MACpCC,0BAA0B,GAAIC,KAAK,iBAAKpC,KAAA,CAAAqC,aAAA,CAACzB,oBAAoB,EAAKwB,KAAK,CAAI;MAE3EE,qBAAqB,GAAG,IAAI;MAC5BC,mBAAmB;MACnBC,aAAa;MACbC,YAAY;MACZC,cAAc,GAAGjC;IACnB,CAAC,GAAAa,IAAA;IACC,MAAM;MAAEqB,GAAG;MAAEC;IAAY,CAAC,GAAG3B,eAAe,EAAE;IAE9C,MAAM;MAAE4B;IAAQ,CAAC,GAAG7B,eAAe,EAAE;IACrC,MAAM;MAAE8B,IAAI,EAAEC;IAAU,CAAC,GAAG1C,QAAQ,EAAE;IAEtC,MAAM,CAAC2C,iBAAiB,CAAC,GAAG9C,QAAQ,CAAC,MAAMgB,MAAM,EAAmC,CAAC;IAErF,MAAM;MACJ+B,QAAQ;MACRC,WAAW;MACXC,IAAI;MACJC,IAAI;MACJC,OAAO;MACPC,eAAe;MACfC,eAAe;MACfC,iBAAiB;MACjBC,iBAAiB;MACjBC,aAAa;MACbC,aAAa;MACbC;IACF,CAAC,GAAGxD,sBAAsB,CAACuC,GAAG,EAAEpB,OAAO,EAAEqB,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEiB,MAAM,EAAE;MAC5DpB,YAAY;MACZC,cAAc;MACdlB,gBAAgB;MAChBsC,OAAOA,CAACC,KAAK,EAAE;QACb,IAAIA,KAAK,YAAY5D,aAAa,EAAE;UAClC,QAAQ4D,KAAK,CAACC,IAAI;YAChB,KAAKxD,WAAW,CAACyD,kBAAkB;YACnC,KAAKzD,WAAW,CAAC0D,iBAAiB;YAClC,KAAK1D,WAAW,CAAC2D,oCAAoC;cAAE;gBACrD,OAAOpB,SAAS,CAACF,OAAO,CAACuB,KAAK,CAACC,iBAAiB,EAAE,OAAO,CAAC;cAC5D;UAAC;QAEL;QAEAtB,SAAS,CAACF,OAAO,CAACuB,KAAK,CAACE,aAAa,EAAE,OAAO,CAAC;MACjD,CAAC;MACDC,kBAAkBA,CAACtB,QAAQ,EAAE;QAC3BD,iBAAiB,CAACwB,OAAO,CAAC;UAAEC,IAAI,EAAE,mBAAmB;UAAEC,IAAI,EAAE;YAAEzB;UAAS;QAAE,CAAC,CAAC;MAC9E;IACF,CAAC,CAAC;IAEF,MAAM0B,UAAU,GAAGpD,OAAO,CAACoD,UAAU,CAAC,CAAA/B,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEiB,MAAM,KAAI/C,eAAe,CAAC;IAE7E,MAAM8D,cAAgE,GAAGlE,gBAAgB,CAAE0B,KAAK,IAAK;MACnG,IAAIH,aAAa,EAAE,OAAOA,aAAa,CAACG,KAAK,CAAC;MAC9C,oBAAOpC,KAAA,CAAAqC,aAAA,CAAC1B,0BAA0B,EAAKyB,KAAK,CAAI;IAClD,CAAC,CAAC;IAEF,MAAMyC,qBAAqB,GAAG5E,OAAO,CACnC,OAAO;MACL6E,kBAAkB,eAAE9E,KAAA,CAAAqC,aAAA,CAAChB,iBAAiB,CAAC0D,WAAW,OAAG;MACrDC,qBAAqB,EAAE;QAAEC,QAAQ,EAAE;MAAE,CAAC;MACtC,GAAGzC;IACL,CAAC,CAAC,EACF,CAACoB,OAAO,EAAEpB,aAAa,CAAC,CACzB;IAED,MAAM0C,SAAS,GAAIC,OAAkD,IAAK;MACxEnC,iBAAiB,CAACwB,OAAO,CAAC;QAAEC,IAAI,EAAE,sBAAsB;QAAEC,IAAI,EAAE;UAAES;QAAQ;MAAE,CAAC,CAAC;IAChF,CAAC;IACD,MAAMC,MAAM,GAAID,OAAkD,IAAK;MACrEnC,iBAAiB,CAACwB,OAAO,CAAC;QAAEC,IAAI,EAAE,sBAAsB;QAAEC,IAAI,EAAE;UAAES;QAAQ;MAAE,CAAC,CAAC;IAChF,CAAC;IAED,MAAME,sBAA2E,GAAG3E,gBAAgB,CAClG,MAAO4E,MAAM,IAAK;MAChB,MAAMC,eAAe,GAAG,MAAM3D,uBAAuB,CAAC0D,MAAM,CAAC;MAC7D,MAAMH,OAAO,GAAG,MAAM5B,eAAe,CAACgC,eAAe,EAAEL,SAAS,CAAC;MACjEE,MAAM,CAACD,OAAO,CAAC;IACjB,CAAC,CACF;IACD,MAAMK,sBAA2E,GAAG9E,gBAAgB,CAClG,MAAO4E,MAAM,IAAK;MAChB,MAAMC,eAAe,GAAG,MAAM1D,uBAAuB,CAACyD,MAAM,CAAC;MAC7D,MAAMH,OAAO,GAAG,MAAM7B,eAAe,CAACiC,eAAe,EAAEL,SAAS,CAAC;MACjEE,MAAM,CAACD,OAAO,CAAC;IACjB,CAAC,CACF;IACD,MAAMM,wBAA+E,GAAG/E,gBAAgB,CACtG,OAAOyE,OAAO,EAAEG,MAAM,KAAK;MACzB,MAAMC,eAAe,GAAG,MAAMzD,yBAAyB,CAACwD,MAAM,CAAC;MAC/D,MAAM7B,iBAAiB,CAAC0B,OAAO,CAACO,SAAS,EAAEH,eAAe,CAAC;IAC7D,CAAC,CACF;IACD,MAAMI,wBAA+E,GAAGjF,gBAAgB,CACtG,OAAOyE,OAAO,EAAEG,MAAM,KAAK;MACzB,MAAMC,eAAe,GAAG,MAAMxD,yBAAyB,CAACuD,MAAM,CAAC;MAC/D,MAAM9B,iBAAiB,CAAC2B,OAAO,CAACO,SAAS,EAAEH,eAAe,CAAC;IAC7D,CAAC,CACF;IAED,oBACEvF,KAAA,CAAAqC,aAAA,CAAChB,iBAAiB,CAACuE,QAAQ;MACzB5C,iBAAiB,EAAEA,iBAAkB;MACrCzB,OAAO,EAAEA,OAAQ;MACjBgB,mBAAmB,EAAEA;IAAoB,gBAEzCvC,KAAA,CAAAqC,aAAA,CAAChB,iBAAiB,CAACwE,MAAM;MACvBpE,iBAAiB,EAAEA,iBAAkB;MACrCqE,aAAa,EAAEnB,UAAU,GAAG,MAAM,GAAG,SAAU;MAC/CoB,kBAAkB,EAAEpB,UAAU,GAAGjD,8BAA8B,GAAGC;IAAmC,EACrG,eACF3B,KAAA,CAAAqC,aAAA,CAACxB,iBAAiB;MAAC+C,OAAO,EAAEA,OAAQ;MAACoC,gBAAgB,eAAEhG,KAAA,CAAAqC,aAAA,CAAChB,iBAAiB,CAAC4E,aAAa;IAAI,gBACzFjG,KAAA,CAAAqC,aAAA,CAAChB,iBAAiB,CAAC6E,WAAW;MAC5B3E,OAAO,EAAEA,OAAQ;MACjB8B,OAAO,EAAEA,OAAQ;MACjBf,qBAAqB,EAAEA,qBAAsB;MAC7C6D,aAAa,EAAEvD,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEiB,MAAO;MACnC5B,aAAa,EAAE2C,cAAe;MAC9B3B,QAAQ,EAAEA,QAAS;MACnBC,WAAW,EAAEA,WAAY;MACzBkD,YAAY,EAAEhD,IAAK;MACnBiD,eAAe,EAAElD,IAAK;MACtBmD,sBAAsB,EAAE,KAAM;MAC9BC,wBAAwB,EAAEjG,IAAK;MAC/B4B,uBAAuB,EAAEA,uBAAwB;MACjDC,0BAA0B,EAAEA,0BAA2B;MACvDqE,qBAAqB,EAAE9C,aAAc;MACrC+C,eAAe,EAAE9C,aAAc;MAC/B3B,mBAAmB,EAAEA,mBAAoB;MACzCQ,aAAa,EAAEqC;IAAsB,EACrC,eACF7E,KAAA,CAAAqC,aAAA,CAAChB,iBAAiB,CAACqF,KAAK;MACtBC,iBAAiB;MACjBtB,sBAAsB,EAAEA,sBAAuB;MAC/CG,sBAAsB,EAAEA,sBAAuB;MAC/CC,wBAAwB,EAAEA,wBAAyB;MACnDE,wBAAwB,EAAEA;IAAyB,EACnD,CACgB,CACO;EAEjC,CAAC;AACH,CAAC;AAED,eAAexE,yBAAyB"}