{"version":3,"names":["React","useChannelHandler","useUserList","useActionMenu","NOOP","ifThenOr","isDifferentChannel","useFreshCallback","useUniqHandlerId","StatusComposition","UserActionBar","UNKNOWN_USER_ID","createOpenChannelOperatorsModule","useLocalization","useSendbirdChat","useUserProfile","createOpenChannelOperatorsFragment","initModule","OpenChannelOperatorsModule","_ref","onPressHeaderLeft","onPressHeaderRight","channel","renderUser","queryCreator","createOperatorListQuery","limit","handlerId","STRINGS","sdk","currentUser","openMenu","show","users","deleteUser","upsertUser","loading","refresh","next","error","onUserBanned","eventChannel","user","userId","onOperatorUpdated","updatedUsers","operatorsAdded","length","forEach","_renderUser","props","createElement","muted","uri","profileUrl","name","nickname","LABELS","USER_NO_NAME","USER_BAR_ME_POSTFIX","disabled","onPressAvatar","onPressActionMenu","isOperator","title","menuItems","UNREGISTER_OPERATOR","onPress","removeOperators","then","Provider","Header","LoadingComponent","StatusLoading","Boolean","ErrorComponent","StatusError","onPressRetry","List","operators","onLoadNext","ListEmptyComponent","StatusEmpty"],"sources":["createOpenChannelOperatorsFragment.tsx"],"sourcesContent":["import React from 'react';\n\nimport { useChannelHandler, useUserList } from '@sendbird/uikit-chat-hooks';\nimport { useActionMenu } from '@sendbird/uikit-react-native-foundation';\nimport { NOOP, ifThenOr, isDifferentChannel, useFreshCallback, useUniqHandlerId } from '@sendbird/uikit-utils';\n\nimport StatusComposition from '../components/StatusComposition';\nimport UserActionBar from '../components/UserActionBar';\nimport { UNKNOWN_USER_ID } from '../constants';\nimport { createOpenChannelOperatorsModule } from '../domain/openChannelOperators';\nimport type { OpenChannelOperatorsFragment, OpenChannelOperatorsModule } from '../domain/openChannelOperators/types';\nimport { useLocalization, useSendbirdChat, useUserProfile } from '../hooks/useContext';\n\nconst createOpenChannelOperatorsFragment = (\n  initModule?: Partial<OpenChannelOperatorsModule>,\n): OpenChannelOperatorsFragment => {\n  const OpenChannelOperatorsModule = createOpenChannelOperatorsModule(initModule);\n\n  return ({\n    onPressHeaderLeft = NOOP,\n    onPressHeaderRight = NOOP,\n    channel,\n    renderUser,\n    queryCreator = () => channel.createOperatorListQuery({ limit: 20 }),\n  }) => {\n    const handlerId = useUniqHandlerId('OpenChannelOperatorsFragment');\n\n    const { STRINGS } = useLocalization();\n    const { sdk, currentUser } = useSendbirdChat();\n    const { openMenu } = useActionMenu();\n    const { show } = useUserProfile();\n\n    const { users, deleteUser, upsertUser, loading, refresh, next, error } = useUserList(sdk, { queryCreator });\n\n    useChannelHandler(\n      sdk,\n      handlerId,\n      {\n        onUserBanned(eventChannel, user) {\n          if (isDifferentChannel(eventChannel, channel)) return;\n          deleteUser(user.userId);\n        },\n        onOperatorUpdated(eventChannel, updatedUsers) {\n          if (isDifferentChannel(eventChannel, channel)) return;\n          const operatorsAdded = users.length < updatedUsers.length;\n          if (operatorsAdded) updatedUsers.forEach(upsertUser);\n        },\n      },\n      'open',\n    );\n\n    const _renderUser: NonNullable<typeof renderUser> = useFreshCallback((props) => {\n      if (renderUser) return renderUser(props);\n\n      const { user } = props;\n      return (\n        <UserActionBar\n          muted={false}\n          uri={user.profileUrl}\n          name={\n            (user.nickname || STRINGS.LABELS.USER_NO_NAME) +\n            (user.userId === currentUser?.userId ? STRINGS.LABELS.USER_BAR_ME_POSTFIX : '')\n          }\n          disabled={user.userId === currentUser?.userId}\n          onPressAvatar={() => show(user)}\n          onPressActionMenu={ifThenOr(channel.isOperator(currentUser?.userId ?? UNKNOWN_USER_ID), () => {\n            openMenu({\n              title: user.nickname || STRINGS.LABELS.USER_NO_NAME,\n              menuItems: [\n                {\n                  title: STRINGS.LABELS.UNREGISTER_OPERATOR,\n                  onPress: () => channel.removeOperators([user.userId]).then(() => deleteUser(user.userId)),\n                },\n              ],\n            });\n          })}\n        />\n      );\n    });\n\n    return (\n      <OpenChannelOperatorsModule.Provider channel={channel}>\n        <OpenChannelOperatorsModule.Header\n          onPressHeaderLeft={onPressHeaderLeft}\n          onPressHeaderRight={onPressHeaderRight}\n        />\n        <StatusComposition\n          loading={loading}\n          LoadingComponent={<OpenChannelOperatorsModule.StatusLoading />}\n          error={Boolean(error)}\n          ErrorComponent={<OpenChannelOperatorsModule.StatusError onPressRetry={refresh} />}\n        >\n          <OpenChannelOperatorsModule.List\n            operators={users}\n            renderUser={_renderUser}\n            onLoadNext={next}\n            ListEmptyComponent={<OpenChannelOperatorsModule.StatusEmpty />}\n          />\n        </StatusComposition>\n      </OpenChannelOperatorsModule.Provider>\n    );\n  };\n};\n\nexport default createOpenChannelOperatorsFragment;\n"],"mappings":"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"}