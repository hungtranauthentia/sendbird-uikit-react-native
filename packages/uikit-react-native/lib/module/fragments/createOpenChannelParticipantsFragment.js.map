{"version":3,"names":["React","useRef","useChannelHandler","useUserList","useActionMenu","ASYNC_NOOP","ifThenOr","isDifferentChannel","useFreshCallback","useUniqHandlerId","StatusComposition","UserActionBar","UNKNOWN_USER_ID","createUserListModule","useLocalization","useSendbirdChat","useUserProfile","RETURN_EMPTY_STRING","createOpenChannelParticipantsFragment","initModule","UserListModule","_ref","channel","onPressHeaderLeft","renderUser","sortComparator","queryCreator","createParticipantListQuery","limit","handlerId","refreshSchedule","STRINGS","sdk","currentUser","openMenu","show","users","refresh","loading","next","error","upsertUser","deleteUser","onUserExited","eventChannel","user","userId","onUserBanned","onOperatorUpdated","current","clearTimeout","setTimeout","onUserMuted","isOpenChannel","isMuted","onUserUnmuted","_renderUser","selectedUsers","setSelectedUsers","isUserMuted","isUserOperator","isOperator","isCurrentUserOperator","createElement","muted","uri","profileUrl","label","LABELS","USER_BAR_OPERATOR","name","nickname","USER_NO_NAME","USER_BAR_ME_POSTFIX","disabled","onPressActionMenu","menuItems","push","title","UNREGISTER_OPERATOR","REGISTER_AS_OPERATOR","onPress","removeOperators","addOperators","UNMUTE","MUTE","unmuteUser","muteUser","BAN","style","banUser","onPressAvatar","Provider","headerRight","headerTitle","OPEN_CHANNEL_PARTICIPANTS","HEADER_TITLE","Header","onPressHeaderRight","LoadingComponent","StatusLoading","Boolean","ErrorComponent","StatusError","onPressRetry","List","onLoadNext","ListEmptyComponent","StatusEmpty"],"sources":["createOpenChannelParticipantsFragment.tsx"],"sourcesContent":["import React, { useRef } from 'react';\n\nimport { useChannelHandler, useUserList } from '@sendbird/uikit-chat-hooks';\nimport type { ActionMenuItem } from '@sendbird/uikit-react-native-foundation';\nimport { useActionMenu } from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdParticipant } from '@sendbird/uikit-utils';\nimport { ASYNC_NOOP, ifThenOr, isDifferentChannel, useFreshCallback, useUniqHandlerId } from '@sendbird/uikit-utils';\n\nimport StatusComposition from '../components/StatusComposition';\nimport UserActionBar from '../components/UserActionBar';\nimport { UNKNOWN_USER_ID } from '../constants';\nimport type { OpenChannelParticipantsFragment } from '../domain/openChannelUserList/types';\nimport createUserListModule from '../domain/userList/module/createUserListModule';\nimport type { UserListModule } from '../domain/userList/types';\nimport { useLocalization, useSendbirdChat, useUserProfile } from '../hooks/useContext';\n\nconst RETURN_EMPTY_STRING = () => '';\nconst createOpenChannelParticipantsFragment = (\n  initModule?: Partial<UserListModule<SendbirdParticipant>>,\n): OpenChannelParticipantsFragment => {\n  const UserListModule = createUserListModule<SendbirdParticipant>(initModule);\n\n  return ({\n    channel,\n    onPressHeaderLeft,\n    renderUser,\n    sortComparator,\n    queryCreator = () => channel.createParticipantListQuery({ limit: 20 }),\n  }) => {\n    const handlerId = useUniqHandlerId('OpenChannelParticipantsFragment');\n\n    const refreshSchedule = useRef<NodeJS.Timeout>();\n    const { STRINGS } = useLocalization();\n    const { sdk, currentUser } = useSendbirdChat();\n    const { openMenu } = useActionMenu();\n    const { show } = useUserProfile();\n\n    const { users, refresh, loading, next, error, upsertUser, deleteUser } = useUserList(sdk, {\n      queryCreator,\n      sortComparator,\n    });\n\n    useChannelHandler(\n      sdk,\n      handlerId,\n      {\n        onUserExited(eventChannel, user) {\n          if (isDifferentChannel(eventChannel, channel)) return;\n          deleteUser(user.userId);\n        },\n        onUserBanned(eventChannel, user) {\n          if (isDifferentChannel(eventChannel, channel)) return;\n          deleteUser(user.userId);\n        },\n        onOperatorUpdated(eventChannel) {\n          if (isDifferentChannel(eventChannel, channel)) return;\n          if (refreshSchedule.current) clearTimeout(refreshSchedule.current);\n          refreshSchedule.current = setTimeout(() => refresh(), 500);\n        },\n        onUserMuted(eventChannel, user) {\n          if (isDifferentChannel(eventChannel, channel) || !eventChannel.isOpenChannel()) return;\n          // @ts-ignore - SDK should migrate User to Participant\n          user.isMuted = true;\n          upsertUser(user);\n        },\n        onUserUnmuted(eventChannel, user) {\n          if (isDifferentChannel(eventChannel, channel) || !eventChannel.isOpenChannel()) return;\n          // @ts-ignore - SDK should migrate User to Participant\n          user.isMuted = false;\n          upsertUser(user);\n        },\n      },\n      'open',\n    );\n\n    const _renderUser: NonNullable<typeof renderUser> = useFreshCallback((user, selectedUsers, setSelectedUsers) => {\n      if (renderUser) return renderUser(user, selectedUsers, setSelectedUsers);\n\n      const isUserMuted = user.isMuted;\n      const isUserOperator = channel.isOperator(user.userId);\n      const isCurrentUserOperator = channel.isOperator(currentUser?.userId ?? UNKNOWN_USER_ID);\n\n      return (\n        <UserActionBar\n          muted={isUserMuted}\n          uri={user.profileUrl}\n          label={ifThenOr(isUserOperator, STRINGS.LABELS.USER_BAR_OPERATOR, '')}\n          name={\n            (user.nickname || STRINGS.LABELS.USER_NO_NAME) +\n            ifThenOr(user.userId === currentUser?.userId, STRINGS.LABELS.USER_BAR_ME_POSTFIX, '')\n          }\n          disabled={user.userId === currentUser?.userId}\n          onPressActionMenu={ifThenOr(isCurrentUserOperator, () => {\n            const menuItems: ActionMenuItem['menuItems'] = [];\n\n            menuItems.push({\n              title: ifThenOr(isUserOperator, STRINGS.LABELS.UNREGISTER_OPERATOR, STRINGS.LABELS.REGISTER_AS_OPERATOR),\n              onPress: ifThenOr(\n                isUserOperator,\n                () => channel.removeOperators([user.userId]),\n                () => channel.addOperators([user.userId]),\n              ),\n            });\n\n            menuItems.push({\n              title: ifThenOr(isUserMuted, STRINGS.LABELS.UNMUTE, STRINGS.LABELS.MUTE),\n              onPress: ifThenOr(\n                isUserMuted,\n                () => channel.unmuteUser(user),\n                () => channel.muteUser(user),\n              ),\n            });\n\n            menuItems.push({\n              title: STRINGS.LABELS.BAN,\n              style: 'destructive',\n              onPress: () => channel.banUser(user),\n            });\n\n            openMenu({ title: user.nickname || STRINGS.LABELS.USER_NO_NAME, menuItems });\n          })}\n          onPressAvatar={() => show(user)}\n        />\n      );\n    });\n\n    return (\n      <UserListModule.Provider\n        headerRight={RETURN_EMPTY_STRING}\n        headerTitle={STRINGS.OPEN_CHANNEL_PARTICIPANTS.HEADER_TITLE}\n      >\n        <UserListModule.Header onPressHeaderRight={ASYNC_NOOP} onPressHeaderLeft={onPressHeaderLeft} />\n        <StatusComposition\n          loading={loading}\n          LoadingComponent={<UserListModule.StatusLoading />}\n          error={Boolean(error)}\n          ErrorComponent={<UserListModule.StatusError onPressRetry={refresh} />}\n        >\n          <UserListModule.List\n            users={users as SendbirdParticipant[]}\n            renderUser={_renderUser}\n            onLoadNext={next}\n            ListEmptyComponent={<UserListModule.StatusEmpty />}\n          />\n        </StatusComposition>\n      </UserListModule.Provider>\n    );\n  };\n};\n\nexport default createOpenChannelParticipantsFragment;\n"],"mappings":"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"}