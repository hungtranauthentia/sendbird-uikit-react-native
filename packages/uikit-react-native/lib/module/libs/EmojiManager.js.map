{"version":3,"names":["InternalLocalCacheStorage","MemoryStorage","constructor","_defineProperty","getAllKeys","Object","keys","_data","getItem","key","removeItem","setItem","value","EmojiManager","internalStorage","arguments","length","undefined","container","get","emojiStorage","strItem","freeze","JSON","parse","set","stringify","emojiContainer","category","emojiCategories","_emojiCategoryMap","id","emoji","emojis","_allEmojiMap","_allEmoji","values","emojiCategoryMap","allEmojiMap","allEmoji","emojiHash","_this$emojiStorage$co"],"sources":["EmojiManager.ts"],"sourcesContent":["import type { SendbirdEmoji, SendbirdEmojiCategory, SendbirdEmojiContainer } from '@sendbird/uikit-utils';\n\nimport type { LocalCacheStorage } from '../types';\nimport InternalLocalCacheStorage from './InternalLocalCacheStorage';\n\nclass MemoryStorage implements LocalCacheStorage {\n  _data: Record<string, string> = {};\n\n  async getAllKeys(): Promise<readonly string[] | string[]> {\n    return Object.keys(this._data);\n  }\n\n  async getItem(key: string): Promise<string | null> {\n    return this._data[key];\n  }\n\n  async removeItem(key: string): Promise<void> {\n    delete this._data[key];\n  }\n\n  async setItem(key: string, value: string): Promise<void> {\n    this._data[key] = value;\n  }\n}\n\nclass EmojiManager {\n  static key = 'sendbird-uikit@emoji-manager';\n\n  constructor(\n    private internalStorage: InternalLocalCacheStorage = new InternalLocalCacheStorage(new MemoryStorage()),\n  ) {}\n\n  private emojiStorage = {\n    container: null as null | SendbirdEmojiContainer,\n    get: async () => {\n      if (!this.emojiStorage.container) {\n        const strItem = await this.internalStorage.getItem(EmojiManager.key);\n        if (strItem) this.emojiStorage.container = Object.freeze(JSON.parse(strItem));\n      }\n      return this.emojiStorage.container;\n    },\n    set: async (container: SendbirdEmojiContainer) => {\n      this.emojiStorage.container = Object.freeze(container);\n      await this.internalStorage.setItem(EmojiManager.key, JSON.stringify(container));\n    },\n  };\n\n  private _emojiCategoryMap: Record<string, SendbirdEmojiCategory> = {};\n  public get emojiCategoryMap() {\n    return this._emojiCategoryMap;\n  }\n\n  private _allEmojiMap: Record<string, SendbirdEmoji> = {};\n  public get allEmojiMap() {\n    return this._allEmojiMap;\n  }\n\n  private _allEmoji: SendbirdEmoji[] = [];\n  public get allEmoji() {\n    return this._allEmoji;\n  }\n\n  public init = async (emojiContainer?: SendbirdEmojiContainer) => {\n    if (emojiContainer) await this.emojiStorage.set(emojiContainer);\n\n    const container = await this.emojiStorage.get();\n\n    if (container) {\n      for (const category of container.emojiCategories) {\n        this._emojiCategoryMap[category.id] = category;\n        for (const emoji of category.emojis) {\n          this._allEmojiMap[emoji.key] = emoji;\n        }\n      }\n      this._allEmoji = Object.values(this._allEmojiMap);\n    }\n  };\n\n  public get emojiHash() {\n    return this.emojiStorage.container?.emojiHash;\n  }\n}\n\nexport default EmojiManager;\n"],"mappings":"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"}