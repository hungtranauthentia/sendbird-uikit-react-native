{"version":3,"names":["React","View","useSafeAreaInsets","ChannelFrozenBanner","createStyleSheet","useAlert","useBottomSheet","useToast","useUIKitTheme","Logger","getAvailableUriFromFileMessage","getFileExtension","getFileType","isMyMessage","isVoiceMessage","messageKeyExtractor","shouldRenderReaction","toMegabyte","useFreshCallback","useLocalization","usePlatformService","useSendbirdChat","useUserProfile","SBUUtils","ChatFlatList","ReactionAddons","ChannelMessageList","_ref","ref","searchItem","hasNext","channel","onEditMessage","onReplyMessage","onDeleteMessage","onResendFailedMessage","onPressMediaMessage","onPressParentMessage","currentUserId","renderNewMessagesButton","renderScrollToBottomButton","renderMessage","messages","newMessages","enableMessageGrouping","onScrolledAwayFromBottom","scrolledAwayFromBottom","onBottomReached","onTopReached","flatListProps","onPressNewMessagesButton","onPressScrollToBottomButton","STRINGS","colors","show","left","right","createMessagePressActions","useCreateMessagePressActions","safeAreaLayout","paddingLeft","paddingRight","renderItem","_ref2","item","index","onPress","onLongPress","bottomSheetItem","message","prevMessage","nextMessage","onShowUserProfile","focused","startingPoint","createdAt","isFirstItem","createElement","style","flex","backgroundColor","background","isFrozen","styles","frozenBanner","text","LABELS","CHANNEL_MESSAGE_LIST_FROZEN","_extends","data","keyExtractor","contentContainerStyle","frozenListPadding","newMsgButton","visible","length","scrollButton","_ref3","toast","openSheet","alert","clipboardService","fileService","sbOptions","onResendFailure","error","TOAST","RESEND_MSG_ERROR","onDeleteFailure","DELETE_MSG_ERROR","onCopyText","isUserMessage","setString","COPY_OK","onDownloadFile","isFileMessage","size","DOWNLOAD_START","save","fileUrl","url","fileName","name","fileType","type","then","response","DOWNLOAD_OK","log","catch","err","DOWNLOAD_ERROR","onOpenFile","includes","openURL","openSheetForFailedMessage","sheetItems","title","CHANNEL_MESSAGE_FAILED_RETRY","CHANNEL_MESSAGE_FAILED_REMOVE","titleColor","ui","dialog","default","none","destructive","alertForMessageDelete","CHANNEL_MESSAGE_DELETE_CONFIRM_TITLE","buttons","CHANNEL_MESSAGE_DELETE_CONFIRM_CANCEL","CHANNEL_MESSAGE_DELETE_CONFIRM_OK","_ref4","menu","copy","icon","CHANNEL_MESSAGE_COPY","edit","CHANNEL_MESSAGE_EDIT","delete","disabled","threadInfo","replyCount","undefined","CHANNEL_MESSAGE_DELETE","reply","Boolean","parentMessageId","CHANNEL_MESSAGE_REPLY","download","CHANNEL_MESSAGE_SAVE","push","isEphemeral","sendingStatus","isGroupChannel","uikit","groupChannel","replyType","configs","uikitWithAppInfo","HeaderComponent","isSuper","enableReactionsSupergroup","enableReactions","_ref5","onClose","BottomSheet","position","zIndex","top","paddingBottom","bottom","alignSelf","forwardRef"],"sources":["index.tsx"],"sourcesContent":["import React, { Ref } from 'react';\nimport { FlatList, FlatListProps, ListRenderItem, View } from 'react-native';\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\n\nimport {\n  BottomSheetItem,\n  ChannelFrozenBanner,\n  createStyleSheet,\n  useAlert,\n  useBottomSheet,\n  useToast,\n  useUIKitTheme,\n} from '@sendbird/uikit-react-native-foundation';\nimport {\n  Logger,\n  SendbirdFileMessage,\n  SendbirdGroupChannel,\n  SendbirdMessage,\n  SendbirdOpenChannel,\n  SendbirdUserMessage,\n  getAvailableUriFromFileMessage,\n  getFileExtension,\n  getFileType,\n  isMyMessage,\n  isVoiceMessage,\n  messageKeyExtractor,\n  shouldRenderReaction,\n  toMegabyte,\n  useFreshCallback,\n} from '@sendbird/uikit-utils';\n\nimport type { UserProfileContextType } from '../../contexts/UserProfileCtx';\nimport { useLocalization, usePlatformService, useSendbirdChat, useUserProfile } from '../../hooks/useContext';\nimport SBUUtils from '../../libs/SBUUtils';\nimport ChatFlatList from '../ChatFlatList';\nimport { ReactionAddons } from '../ReactionAddons';\n\ntype PressActions = { onPress?: () => void; onLongPress?: () => void; bottomSheetItem?: BottomSheetItem };\ntype HandleableMessage = SendbirdUserMessage | SendbirdFileMessage;\ntype CreateMessagePressActions = (params: { message: SendbirdMessage }) => PressActions;\nexport type ChannelMessageListProps<T extends SendbirdGroupChannel | SendbirdOpenChannel> = {\n  enableMessageGrouping: boolean;\n  currentUserId?: string;\n  channel: T;\n  messages: SendbirdMessage[];\n  newMessages: SendbirdMessage[];\n  searchItem?: { startingPoint: number };\n\n  scrolledAwayFromBottom: boolean;\n  onScrolledAwayFromBottom: (value: boolean) => void;\n  onTopReached: () => void;\n  onBottomReached: () => void;\n  hasNext: () => boolean;\n\n  onPressNewMessagesButton: (animated?: boolean) => void;\n  onPressScrollToBottomButton: (animated?: boolean) => void;\n\n  onEditMessage: (message: HandleableMessage) => void;\n  onReplyMessage?: (message: HandleableMessage) => void; // only available on group channel\n  onDeleteMessage: (message: HandleableMessage) => Promise<void>;\n  onResendFailedMessage: (failedMessage: HandleableMessage) => Promise<HandleableMessage | void>;\n  onPressParentMessage?: (parentMessage: SendbirdMessage) => void;\n  onPressMediaMessage?: (message: SendbirdFileMessage, deleteMessage: () => Promise<void>, uri: string) => void;\n\n  renderMessage: (props: {\n    focused: boolean;\n    message: SendbirdMessage;\n    prevMessage?: SendbirdMessage;\n    nextMessage?: SendbirdMessage;\n    onPress?: () => void;\n    onLongPress?: () => void;\n    onPressParentMessage?: ChannelMessageListProps<T>['onPressParentMessage'];\n    onShowUserProfile?: UserProfileContextType['show'];\n    channel: T;\n    currentUserId?: ChannelMessageListProps<T>['currentUserId'];\n    enableMessageGrouping: ChannelMessageListProps<T>['enableMessageGrouping'];\n    bottomSheetItem?: BottomSheetItem;\n    isFirstItem: boolean;\n  }) => React.ReactElement | null;\n  renderNewMessagesButton:\n    | null\n    | ((props: { visible: boolean; onPress: () => void; newMessages: SendbirdMessage[] }) => React.ReactElement | null);\n  renderScrollToBottomButton: null | ((props: { visible: boolean; onPress: () => void }) => React.ReactElement | null);\n  flatListProps?: Omit<FlatListProps<SendbirdMessage>, 'data' | 'renderItem'>;\n} & {\n  ref?: Ref<FlatList<SendbirdMessage>> | undefined;\n};\n\nconst ChannelMessageList = <T extends SendbirdGroupChannel | SendbirdOpenChannel>(\n  {\n    searchItem,\n    hasNext,\n    channel,\n    onEditMessage,\n    onReplyMessage,\n    onDeleteMessage,\n    onResendFailedMessage,\n    onPressMediaMessage,\n    onPressParentMessage,\n    currentUserId,\n    renderNewMessagesButton,\n    renderScrollToBottomButton,\n    renderMessage,\n    messages,\n    newMessages,\n    enableMessageGrouping,\n    onScrolledAwayFromBottom,\n    scrolledAwayFromBottom,\n    onBottomReached,\n    onTopReached,\n    flatListProps,\n    onPressNewMessagesButton,\n    onPressScrollToBottomButton,\n  }: ChannelMessageListProps<T>,\n  ref: React.ForwardedRef<FlatList<SendbirdMessage>>,\n) => {\n  const { STRINGS } = useLocalization();\n  const { colors } = useUIKitTheme();\n  const { show } = useUserProfile();\n  const { left, right } = useSafeAreaInsets();\n  const createMessagePressActions = useCreateMessagePressActions({\n    channel,\n    currentUserId,\n    onEditMessage,\n    onReplyMessage,\n    onDeleteMessage,\n    onResendFailedMessage,\n    onPressMediaMessage,\n  });\n\n  const safeAreaLayout = { paddingLeft: left, paddingRight: right };\n\n  const renderItem: ListRenderItem<SendbirdMessage> = useFreshCallback(({ item, index }) => {\n    const { onPress, onLongPress, bottomSheetItem } = createMessagePressActions({ message: item });\n    return renderMessage({\n      message: item,\n      prevMessage: messages[index + 1],\n      nextMessage: messages[index - 1],\n      onPress,\n      onLongPress,\n      onPressParentMessage,\n      onShowUserProfile: show,\n      enableMessageGrouping,\n      channel,\n      currentUserId,\n      focused: (searchItem?.startingPoint ?? -1) === item.createdAt,\n      bottomSheetItem,\n      isFirstItem: index === 0,\n    });\n  });\n\n  return (\n    <View style={[{ flex: 1, backgroundColor: colors.background }, safeAreaLayout]}>\n      {channel.isFrozen && (\n        <ChannelFrozenBanner style={styles.frozenBanner} text={STRINGS.LABELS.CHANNEL_MESSAGE_LIST_FROZEN} />\n      )}\n      <ChatFlatList\n        {...flatListProps}\n        onTopReached={onTopReached}\n        onBottomReached={onBottomReached}\n        onScrolledAwayFromBottom={onScrolledAwayFromBottom}\n        ref={ref}\n        data={messages}\n        renderItem={renderItem}\n        keyExtractor={messageKeyExtractor}\n        contentContainerStyle={[\n          // { minHeight: '100%', justifyContent: 'flex-end' },\n          channel.isFrozen && styles.frozenListPadding,\n          flatListProps?.contentContainerStyle,\n        ]}\n      />\n      {renderNewMessagesButton && (\n        <View style={[styles.newMsgButton, safeAreaLayout]}>\n          {renderNewMessagesButton({\n            visible: newMessages.length > 0 && (hasNext() || scrolledAwayFromBottom),\n            onPress: () => onPressNewMessagesButton(),\n            newMessages,\n          })}\n        </View>\n      )}\n      {renderScrollToBottomButton && (\n        <View style={[styles.scrollButton, safeAreaLayout]}>\n          {renderScrollToBottomButton({\n            visible: hasNext() || scrolledAwayFromBottom,\n            onPress: () => onPressScrollToBottomButton(),\n          })}\n        </View>\n      )}\n    </View>\n  );\n};\n\nconst useCreateMessagePressActions = <T extends SendbirdGroupChannel | SendbirdOpenChannel>({\n  channel,\n  currentUserId,\n  onResendFailedMessage,\n  onEditMessage,\n  onReplyMessage,\n  onDeleteMessage,\n  onPressMediaMessage,\n}: Pick<\n  ChannelMessageListProps<T>,\n  | 'channel'\n  | 'currentUserId'\n  | 'onEditMessage'\n  | 'onReplyMessage'\n  | 'onDeleteMessage'\n  | 'onResendFailedMessage'\n  | 'onPressMediaMessage'\n>): CreateMessagePressActions => {\n  const { colors } = useUIKitTheme();\n  const { STRINGS } = useLocalization();\n  const toast = useToast();\n  const { openSheet } = useBottomSheet();\n  const { alert } = useAlert();\n  const { clipboardService, fileService } = usePlatformService();\n  const { sbOptions } = useSendbirdChat();\n\n  const onResendFailure = (error: Error) => {\n    toast.show(STRINGS.TOAST.RESEND_MSG_ERROR, 'error');\n    Logger.error(STRINGS.TOAST.RESEND_MSG_ERROR, error);\n  };\n\n  const onDeleteFailure = (error: Error) => {\n    toast.show(STRINGS.TOAST.DELETE_MSG_ERROR, 'error');\n    Logger.error(STRINGS.TOAST.DELETE_MSG_ERROR, error);\n  };\n\n  const onCopyText = (message: HandleableMessage) => {\n    if (message.isUserMessage()) {\n      clipboardService.setString(message.message || '');\n      toast.show(STRINGS.TOAST.COPY_OK, 'success');\n    }\n  };\n\n  const onDownloadFile = (message: HandleableMessage) => {\n    if (message.isFileMessage()) {\n      if (toMegabyte(message.size) > 4) {\n        toast.show(STRINGS.TOAST.DOWNLOAD_START, 'success');\n      }\n\n      fileService\n        .save({ fileUrl: message.url, fileName: message.name, fileType: message.type })\n        .then((response) => {\n          toast.show(STRINGS.TOAST.DOWNLOAD_OK, 'success');\n          Logger.log('File saved to', response);\n        })\n        .catch((err) => {\n          toast.show(STRINGS.TOAST.DOWNLOAD_ERROR, 'error');\n          Logger.log('File save failure', err);\n        });\n    }\n  };\n\n  const onOpenFile = (message: HandleableMessage) => {\n    if (message.isFileMessage()) {\n      const fileType = getFileType(message.type || getFileExtension(message.name));\n      if (['image', 'video', 'audio'].includes(fileType)) {\n        onPressMediaMessage?.(message, () => onDeleteMessage(message), getAvailableUriFromFileMessage(message));\n      } else {\n        SBUUtils.openURL(message.url);\n      }\n    }\n  };\n\n  const openSheetForFailedMessage = (message: HandleableMessage) => {\n    openSheet({\n      sheetItems: [\n        {\n          title: STRINGS.LABELS.CHANNEL_MESSAGE_FAILED_RETRY,\n          onPress: () => onResendFailedMessage(message).catch(onResendFailure),\n        },\n        {\n          title: STRINGS.LABELS.CHANNEL_MESSAGE_FAILED_REMOVE,\n          titleColor: colors.ui.dialog.default.none.destructive,\n          onPress: () => alertForMessageDelete(message),\n        },\n      ],\n    });\n  };\n\n  const alertForMessageDelete = (message: HandleableMessage) => {\n    alert({\n      title: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_TITLE,\n      buttons: [\n        { text: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_CANCEL },\n        {\n          text: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_OK,\n          style: 'destructive',\n          onPress: () => {\n            onDeleteMessage(message).catch(onDeleteFailure);\n          },\n        },\n      ],\n    });\n  };\n\n  return ({ message }) => {\n    if (!message.isUserMessage() && !message.isFileMessage()) return {};\n\n    const sheetItems: BottomSheetItem['sheetItems'] = [];\n    const menu = {\n      copy: (message: HandleableMessage) => ({\n        icon: 'copy' as const,\n        title: STRINGS.LABELS.CHANNEL_MESSAGE_COPY,\n        onPress: () => onCopyText(message),\n      }),\n      edit: (message: HandleableMessage) => ({\n        icon: 'edit' as const,\n        title: STRINGS.LABELS.CHANNEL_MESSAGE_EDIT,\n        onPress: () => onEditMessage(message),\n      }),\n      delete: (message: HandleableMessage) => ({\n        disabled: message.threadInfo ? message.threadInfo.replyCount > 0 : undefined,\n        icon: 'delete' as const,\n        title: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE,\n        onPress: () => alertForMessageDelete(message),\n      }),\n      reply: (message: HandleableMessage) => ({\n        disabled: Boolean(message.parentMessageId),\n        icon: 'reply' as const,\n        title: STRINGS.LABELS.CHANNEL_MESSAGE_REPLY,\n        onPress: () => onReplyMessage?.(message),\n      }),\n      download: (message: HandleableMessage) => ({\n        icon: 'download' as const,\n        title: STRINGS.LABELS.CHANNEL_MESSAGE_SAVE,\n        onPress: () => onDownloadFile(message),\n      }),\n    };\n\n    if (message.isUserMessage()) {\n      sheetItems.push(menu.copy(message));\n      if (!channel.isEphemeral) {\n        if (isMyMessage(message, currentUserId) && message.sendingStatus === 'succeeded') {\n          sheetItems.push(menu.edit(message));\n          sheetItems.push(menu.delete(message));\n        }\n        if (channel.isGroupChannel() && sbOptions.uikit.groupChannel.channel.replyType === 'quote_reply') {\n          sheetItems.push(menu.reply(message));\n        }\n      }\n    }\n\n    if (message.isFileMessage()) {\n      if (!isVoiceMessage(message)) {\n        sheetItems.push(menu.download(message));\n      }\n      if (!channel.isEphemeral) {\n        if (isMyMessage(message, currentUserId) && message.sendingStatus === 'succeeded') {\n          sheetItems.push(menu.delete(message));\n        }\n        if (channel.isGroupChannel() && sbOptions.uikit.groupChannel.channel.replyType === 'quote_reply') {\n          sheetItems.push(menu.reply(message));\n        }\n      }\n    }\n\n    const configs = sbOptions.uikitWithAppInfo.groupChannel.channel;\n    const bottomSheetItem: BottomSheetItem = {\n      sheetItems,\n      HeaderComponent: shouldRenderReaction(\n        channel,\n        channel.isGroupChannel() && (channel.isSuper ? configs.enableReactionsSupergroup : configs.enableReactions),\n      )\n        ? ({ onClose }) => <ReactionAddons.BottomSheet message={message} channel={channel} onClose={onClose} />\n        : undefined,\n    };\n\n    switch (true) {\n      case message.sendingStatus === 'pending': {\n        return {\n          onPress: undefined,\n          onLongPress: undefined,\n          bottomSheetItem: undefined,\n        };\n      }\n\n      case message.sendingStatus === 'failed': {\n        return {\n          onPress: () => onResendFailedMessage(message).catch(onResendFailure),\n          onLongPress: () => openSheetForFailedMessage(message),\n          bottomSheetItem,\n        };\n      }\n\n      case message.isFileMessage(): {\n        return {\n          onPress: () => onOpenFile(message),\n          onLongPress: () => openSheet(bottomSheetItem),\n          bottomSheetItem,\n        };\n      }\n\n      default: {\n        return {\n          onPress: undefined,\n          onLongPress: () => openSheet(bottomSheetItem),\n          bottomSheetItem,\n        };\n      }\n    }\n  };\n};\n\nconst styles = createStyleSheet({\n  frozenBanner: {\n    position: 'absolute',\n    zIndex: 999,\n    top: 8,\n    left: 8,\n    right: 8,\n  },\n  frozenListPadding: {\n    paddingBottom: 32,\n  },\n  newMsgButton: {\n    position: 'absolute',\n    zIndex: 999,\n    bottom: 10,\n    alignSelf: 'center',\n  },\n  scrollButton: {\n    position: 'absolute',\n    zIndex: 998,\n    bottom: 10,\n    right: 16,\n  },\n});\n\n// NOTE: Due to Generic inference is not working on forwardRef, we need to cast it as typeof ChannelMessageList and implicit `ref` prop\nexport default React.forwardRef(ChannelMessageList) as typeof ChannelMessageList;\n"],"mappings":"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"}