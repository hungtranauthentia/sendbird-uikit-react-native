{"version":3,"names":["React","useContext","useEffect","useState","Box","Icon","ImageWithPlaceholder","PressBox","Text","VideoThumbnail","createStyleSheet","useUIKitTheme","getFileIconFromMessageType","getMessageType","getThumbnailUriFromFileMessage","truncate","useIIFE","GroupChannelContexts","useLocalization","usePlatformService","useSendbirdChat","GroupChannelMessageParentMessage","_ref","variant","channel","message","childMessage","onPress","currentUser","groupChannelPubSub","PubSub","select","colors","palette","STRINGS","mediaService","parentMessage","setParentMessage","type","subscribe","_ref2","data","updatedParent","messages","find","it","messageId","renderMessageWithText","createElement","style","styles","bubbleContainer","backgroundColor","light","background100","dark","background400","body3","color","onBackground03","suppressHighlighting","numberOfLines","ellipsizeMode","renderFileMessageAsVideoThumbnail","url","image","iconSize","source","fetchThumbnailFromVideoSource","uri","getVideoThumbnail","timeMills","renderFileMessageAsPreview","renderFileMessageAsDownloadable","name","icon","size","containerStyle","fileIcon","mode","maxLen","parentMessageComponent","messageOffsetTimestamp","createdAt","LABELS","MESSAGE_UNAVAILABLE","VOICE_MESSAGE","alignItems","paddingLeft","paddingRight","senderLabel","marginRight","caption1","REPLY_FROM_SENDER_TO_RECEIVER","userId","flexDirection","justifyContent","messageContainer","opacity","marginTop","marginBottom","maxWidth","overflow","borderRadius","paddingHorizontal","paddingBottom","paddingTop","width","height"],"sources":["GroupChannelMessageParentMessage.tsx"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\n\nimport {\n  Box,\n  Icon,\n  ImageWithPlaceholder,\n  PressBox,\n  Text,\n  VideoThumbnail,\n  createStyleSheet,\n  useUIKitTheme,\n} from '@sendbird/uikit-react-native-foundation';\nimport {\n  SendbirdFileMessage,\n  SendbirdGroupChannel,\n  SendbirdMessage,\n  SendbirdUserMessage,\n  getFileIconFromMessageType,\n  getMessageType,\n  getThumbnailUriFromFileMessage,\n  truncate,\n  useIIFE,\n} from '@sendbird/uikit-utils';\n\nimport { GroupChannelContexts } from '../../domain/groupChannel/module/moduleContext';\nimport { useLocalization, usePlatformService, useSendbirdChat } from '../../hooks/useContext';\n\ntype Props = {\n  variant: 'outgoing' | 'incoming';\n  channel: SendbirdGroupChannel;\n  message: SendbirdUserMessage | SendbirdFileMessage;\n  childMessage: SendbirdUserMessage | SendbirdFileMessage;\n  onPress?: (message: SendbirdMessage) => void;\n};\n\nconst GroupChannelMessageParentMessage = ({ variant, channel, message, childMessage, onPress }: Props) => {\n  const { currentUser } = useSendbirdChat();\n  const groupChannelPubSub = useContext(GroupChannelContexts.PubSub);\n  const { select, colors, palette } = useUIKitTheme();\n  const { STRINGS } = useLocalization();\n  const { mediaService } = usePlatformService();\n\n  const [parentMessage, setParentMessage] = useState(() => message);\n  const type = getMessageType(parentMessage);\n\n  useEffect(() => {\n    return groupChannelPubSub.subscribe(({ type, data }) => {\n      if (type === 'MESSAGES_UPDATED') {\n        const updatedParent = data.messages.find((it): it is SendbirdUserMessage | SendbirdFileMessage => {\n          return it.messageId === parentMessage.messageId;\n        });\n        if (updatedParent) setParentMessage(updatedParent);\n      }\n    });\n  }, []);\n\n  const renderMessageWithText = (message: string) => {\n    return (\n      <Box\n        style={styles.bubbleContainer}\n        backgroundColor={select({ light: palette.background100, dark: palette.background400 })}\n      >\n        <Text body3 color={colors.onBackground03} suppressHighlighting numberOfLines={2} ellipsizeMode={'tail'}>\n          {message}\n        </Text>\n      </Box>\n    );\n  };\n\n  const renderFileMessageAsVideoThumbnail = (url: string) => {\n    return (\n      <VideoThumbnail\n        style={styles.image}\n        iconSize={18}\n        source={url}\n        fetchThumbnailFromVideoSource={(uri) => mediaService.getVideoThumbnail({ url: uri, timeMills: 1000 })}\n      />\n    );\n  };\n  const renderFileMessageAsPreview = (url: string) => {\n    return <ImageWithPlaceholder style={styles.image} source={{ uri: url }} />;\n  };\n  const renderFileMessageAsDownloadable = (name: string) => {\n    return (\n      <Box\n        style={styles.bubbleContainer}\n        backgroundColor={select({ light: palette.background100, dark: palette.background400 })}\n      >\n        <Icon\n          icon={getFileIconFromMessageType(type)}\n          size={16}\n          color={colors.onBackground03}\n          containerStyle={styles.fileIcon}\n        />\n        <Text body3 color={colors.onBackground03} numberOfLines={1} ellipsizeMode={'middle'}>\n          {truncate(name, { mode: 'mid', maxLen: 20 })}\n        </Text>\n      </Box>\n    );\n  };\n\n  const parentMessageComponent = useIIFE(() => {\n    if (channel.messageOffsetTimestamp > parentMessage.createdAt) {\n      return renderMessageWithText(STRINGS.LABELS.MESSAGE_UNAVAILABLE);\n    }\n\n    switch (type) {\n      case 'user':\n      case 'user.opengraph': {\n        return renderMessageWithText((parentMessage as SendbirdUserMessage).message);\n      }\n      case 'file':\n      case 'file.audio': {\n        return renderFileMessageAsDownloadable((parentMessage as SendbirdFileMessage).name);\n      }\n      case 'file.video': {\n        return renderFileMessageAsVideoThumbnail(getThumbnailUriFromFileMessage(parentMessage as SendbirdFileMessage));\n      }\n      case 'file.image': {\n        return renderFileMessageAsPreview(getThumbnailUriFromFileMessage(parentMessage as SendbirdFileMessage));\n      }\n      case 'file.voice': {\n        return renderMessageWithText(STRINGS.LABELS.VOICE_MESSAGE);\n      }\n      default: {\n        return null;\n      }\n    }\n  });\n\n  return (\n    <Box>\n      <Box\n        alignItems={variant === 'outgoing' ? 'flex-end' : 'flex-start'}\n        paddingLeft={variant === 'outgoing' ? 0 : 12}\n        paddingRight={variant === 'outgoing' ? 12 : 0}\n      >\n        <PressBox onPress={() => onPress?.(parentMessage)} style={styles.senderLabel}>\n          <Icon icon={'reply-filled'} size={13} color={colors.onBackground03} containerStyle={{ marginRight: 4 }} />\n          <Text caption1 color={colors.onBackground03}>\n            {STRINGS.LABELS.REPLY_FROM_SENDER_TO_RECEIVER(childMessage, parentMessage, currentUser?.userId)}\n          </Text>\n        </PressBox>\n      </Box>\n      <Box\n        flexDirection={'row'}\n        justifyContent={variant === 'outgoing' ? 'flex-end' : 'flex-start'}\n        style={styles.messageContainer}\n      >\n        <PressBox onPress={() => onPress?.(parentMessage)}>{parentMessageComponent}</PressBox>\n      </Box>\n    </Box>\n  );\n};\n\nconst styles = createStyleSheet({\n  messageContainer: {\n    opacity: 0.5,\n    marginTop: 4,\n    marginBottom: -6,\n  },\n  bubbleContainer: {\n    maxWidth: 220,\n    overflow: 'hidden',\n    flexDirection: 'row',\n    alignItems: 'center',\n    borderRadius: 16,\n    paddingHorizontal: 12,\n    paddingBottom: 12,\n    paddingTop: 6,\n  },\n  image: {\n    width: 156,\n    height: 104,\n    borderRadius: 16,\n    overflow: 'hidden',\n  },\n  fileIcon: {\n    width: 16,\n    height: 16,\n    borderRadius: 10,\n    marginRight: 4,\n    marginTop: 2,\n  },\n  senderLabel: {\n    flexDirection: 'row',\n  },\n});\n\nexport default GroupChannelMessageParentMessage;\n"],"mappings":"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"}