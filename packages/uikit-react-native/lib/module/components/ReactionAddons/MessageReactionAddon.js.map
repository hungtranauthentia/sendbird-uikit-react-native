{"version":3,"names":["React","Pressable","createStyleSheet","useUIKitTheme","getReactionCount","DEFAULT_LONG_PRESS_DELAY","UNKNOWN_USER_ID","useReaction","useSendbirdChat","ReactionRoundedButton","NUM_COL","REACTION_MORE_KEY","getUserReacted","reaction","userId","arguments","length","undefined","userIds","indexOf","createOnPressReaction","channel","message","reacted","deleteReaction","key","addReaction","createReactionButtons","getEmoji","emojiLimit","onOpenReactionList","onOpenReactionUserList","currentUserId","reactions","buttons","map","index","isNotLastOfRow","isNotLastOfCol","createElement","onPress","onLongPress","delayLongPress","_ref","pressed","url","count","style","styles","marginRight","marginBottom","push","_ref2","More","MessageReactionAddon","_ref3","_message$reactions","colors","emojiManager","currentUser","openReactionList","openReactionUserList","reactionButtons","allEmojiMap","allEmoji","focusIndex","reactionContainer","backgroundColor","background","borderColor","ui","rounded","enabled","alignItems","flexDirection","flexWrap","padding","borderRadius","borderWidth"],"sources":["MessageReactionAddon.tsx"],"sourcesContent":["import React from 'react';\nimport { Pressable } from 'react-native';\n\nimport type { Emoji } from '@sendbird/chat';\nimport { createStyleSheet, useUIKitTheme } from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdBaseChannel, SendbirdBaseMessage, SendbirdReaction } from '@sendbird/uikit-utils';\nimport { getReactionCount } from '@sendbird/uikit-utils';\n\nimport { DEFAULT_LONG_PRESS_DELAY, UNKNOWN_USER_ID } from '../../constants';\nimport { useReaction, useSendbirdChat } from '../../hooks/useContext';\nimport ReactionRoundedButton from './ReactionRoundedButton';\n\nconst NUM_COL = 4;\nconst REACTION_MORE_KEY = 'reaction-more-button';\n\nconst getUserReacted = (reaction: SendbirdReaction, userId = UNKNOWN_USER_ID) => {\n  return reaction.userIds.indexOf(userId) > -1;\n};\n\nconst createOnPressReaction = (\n  reaction: SendbirdReaction,\n  channel: SendbirdBaseChannel,\n  message: SendbirdBaseMessage,\n  reacted: boolean,\n) => {\n  return () => {\n    if (reacted) {\n      return channel.deleteReaction(message, reaction.key);\n    } else {\n      return channel.addReaction(message, reaction.key);\n    }\n  };\n};\n\nconst createReactionButtons = (\n  channel: SendbirdBaseChannel,\n  message: SendbirdBaseMessage,\n  getEmoji: (key: string) => Emoji,\n  emojiLimit: number,\n  onOpenReactionList: () => void,\n  onOpenReactionUserList: (focusIndex: number) => void,\n  currentUserId?: string,\n) => {\n  const reactions = message.reactions ?? [];\n  const buttons = reactions.map((reaction, index) => {\n    const isNotLastOfRow = index % NUM_COL !== NUM_COL - 1;\n    const isNotLastOfCol = index < NUM_COL && reactions.length >= NUM_COL;\n    return (\n      <Pressable\n        key={reaction.key}\n        onPress={createOnPressReaction(reaction, channel, message, getUserReacted(reaction, currentUserId))}\n        onLongPress={() => onOpenReactionUserList(index)}\n        delayLongPress={DEFAULT_LONG_PRESS_DELAY}\n      >\n        {({ pressed }) => (\n          <ReactionRoundedButton\n            url={getEmoji(reaction.key).url}\n            count={getReactionCount(reaction)}\n            reacted={pressed || getUserReacted(reaction, currentUserId)}\n            style={[isNotLastOfRow && styles.marginRight, isNotLastOfCol && styles.marginBottom]}\n          />\n        )}\n      </Pressable>\n    );\n  });\n  if (buttons.length < emojiLimit) {\n    buttons.push(\n      <Pressable key={REACTION_MORE_KEY} onPress={onOpenReactionList}>\n        {({ pressed }) => <ReactionRoundedButton.More pressed={pressed} />}\n      </Pressable>,\n    );\n  }\n\n  return buttons;\n};\n\nconst MessageReactionAddon = ({ channel, message }: { channel: SendbirdBaseChannel; message: SendbirdBaseMessage }) => {\n  const { colors } = useUIKitTheme();\n  const { emojiManager, currentUser } = useSendbirdChat();\n  const { openReactionList, openReactionUserList } = useReaction();\n\n  if (!message.reactions?.length) return null;\n\n  const reactionButtons = createReactionButtons(\n    channel,\n    message,\n    (key) => emojiManager.allEmojiMap[key],\n    emojiManager.allEmoji.length,\n    () => openReactionList({ channel, message }),\n    (focusIndex) => openReactionUserList({ channel, message, focusIndex }),\n    currentUser?.userId,\n  );\n\n  return (\n    <Pressable\n      style={[\n        styles.reactionContainer,\n        { backgroundColor: colors.background, borderColor: colors.ui.reaction.rounded.enabled.background },\n      ]}\n    >\n      {reactionButtons}\n    </Pressable>\n  );\n};\n\nconst styles = createStyleSheet({\n  reactionContainer: {\n    alignItems: 'stretch',\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    padding: 8,\n    borderRadius: 16,\n    borderWidth: 1,\n  },\n  marginRight: {\n    marginRight: 4.5,\n  },\n  marginBottom: {\n    marginBottom: 4,\n  },\n});\n\nexport default MessageReactionAddon;\n"],"mappings":"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"}