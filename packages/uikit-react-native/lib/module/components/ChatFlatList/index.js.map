{"version":3,"names":["React","forwardRef","useRef","Platform","StyleSheet","useUIKitTheme","NOOP","getMessageUniqId","useFreshCallback","FlatListInternal","isInvertedFlatListFixedVersion","_Platform$constants$r","constants","reactNativeVersion","major","_Platform$constants$r2","minor","_Platform$constants$r3","patch","ANDROID_BUG_ALERT_SHOWED","OS","BOTTOM_DETECT_THRESHOLD","UNREACHABLE_THRESHOLD","Number","MIN_SAFE_INTEGER","ChatFlatList","_ref","ref","_props$data","onTopReached","onBottomReached","onScrolledAwayFromBottom","onScroll","props","select","contentOffsetY","_onScroll","event","contentOffset","nativeEvent","prevOffsetY","current","currOffsetY","y","__DEV__","console","warn","createElement","_extends","bounces","removeClippedSubviews","keyboardDismissMode","keyboardShouldPersistTaps","indicatorStyle","light","dark","inverted","Boolean","data","length","onEndReached","onScrollToIndexFailed","onStartReached","scrollEventThrottle","keyExtractor","style","flex","flatten","maintainVisibleContentPosition","minIndexForVisible","autoscrollToTopThreshold"],"sources":["index.tsx"],"sourcesContent":["import React, { forwardRef, useRef } from 'react';\nimport { FlatListProps, Platform, FlatList as RNFlatList, StyleSheet } from 'react-native';\n\nimport { useUIKitTheme } from '@sendbird/uikit-react-native-foundation';\nimport { NOOP, SendbirdMessage, getMessageUniqId, useFreshCallback } from '@sendbird/uikit-utils';\n\nimport FlatListInternal from './FlatListInternal';\n\nfunction isInvertedFlatListFixedVersion() {\n  if (Platform.constants.reactNativeVersion?.major < 1) {\n    if (Platform.constants.reactNativeVersion?.minor < 73) {\n      if (Platform.constants.reactNativeVersion?.patch < 4) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\nlet ANDROID_BUG_ALERT_SHOWED = Platform.OS !== 'android' || isInvertedFlatListFixedVersion();\nconst BOTTOM_DETECT_THRESHOLD = 50;\nconst UNREACHABLE_THRESHOLD = Number.MIN_SAFE_INTEGER;\n\ntype Props = Omit<FlatListProps<SendbirdMessage>, 'onEndReached'> & {\n  onBottomReached: () => void;\n  onTopReached: () => void;\n  onScrolledAwayFromBottom: (value: boolean) => void;\n};\nconst ChatFlatList = forwardRef<RNFlatList, Props>(function ChatFlatList(\n  { onTopReached, onBottomReached, onScrolledAwayFromBottom, onScroll, ...props },\n  ref,\n) {\n  const { select } = useUIKitTheme();\n  const contentOffsetY = useRef(0);\n\n  const _onScroll = useFreshCallback<NonNullable<Props['onScroll']>>((event) => {\n    onScroll?.(event);\n\n    const { contentOffset } = event.nativeEvent;\n\n    const prevOffsetY = contentOffsetY.current;\n    const currOffsetY = contentOffset.y;\n\n    if (BOTTOM_DETECT_THRESHOLD < prevOffsetY && currOffsetY <= BOTTOM_DETECT_THRESHOLD) {\n      onScrolledAwayFromBottom(false);\n    } else if (BOTTOM_DETECT_THRESHOLD < currOffsetY && prevOffsetY <= BOTTOM_DETECT_THRESHOLD) {\n      onScrolledAwayFromBottom(true);\n    }\n\n    contentOffsetY.current = contentOffset.y;\n  });\n\n  if (__DEV__ && !ANDROID_BUG_ALERT_SHOWED) {\n    ANDROID_BUG_ALERT_SHOWED = true;\n    // eslint-disable-next-line no-console\n    console.warn(\n      'UIKit Warning: The Inverted FlatList had performance issues on Android.\\n' +\n        'This issue was fixed in 0.72.4+\\n' +\n        'Please refer to the link: https://github.com/facebook/react-native/issues/30034',\n    );\n  }\n\n  return (\n    <FlatListInternal\n      bounces={false}\n      removeClippedSubviews\n      keyboardDismissMode={'on-drag'}\n      keyboardShouldPersistTaps={'handled'}\n      indicatorStyle={select({ light: 'black', dark: 'white' })}\n      {...props}\n      // FIXME: inverted list of ListEmptyComponent is reversed {@link https://github.com/facebook/react-native/issues/21196#issuecomment-836937743}\n      inverted={Boolean(props.data?.length)}\n      ref={ref}\n      onEndReached={onTopReached}\n      onScrollToIndexFailed={NOOP}\n      onStartReached={onBottomReached}\n      scrollEventThrottle={16}\n      onScroll={_onScroll}\n      keyExtractor={getMessageUniqId}\n      style={{ flex: 1, ...StyleSheet.flatten(props.style) }}\n      maintainVisibleContentPosition={{ minIndexForVisible: 0, autoscrollToTopThreshold: UNREACHABLE_THRESHOLD }}\n    />\n  );\n});\n\nexport default ChatFlatList;\n"],"mappings":"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"}