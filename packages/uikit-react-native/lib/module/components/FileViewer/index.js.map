{"version":3,"names":["React","useEffect","StatusBar","useSafeAreaInsets","Box","useAlert","useHeaderStyle","useToast","useUIKitTheme","Logger","getFileExtension","getFileType","isMyMessage","toMegabyte","useLocalization","usePlatformService","useSendbirdChat","FileViewerContent","FileViewerFooter","FileViewerHeader","FileViewer","_ref","headerShown","maxZoom","minZoom","headerTopInset","fileMessage","onClose","onPressDownload","onPressDelete","deleteMessage","topInset","statusBarTranslucent","bottom","palette","alert","show","fileService","currentUser","STRINGS","fileType","type","url","canDelete","userId","basicTopInset","onPressDeleteButton","title","LABELS","CHANNEL_MESSAGE_DELETE_CONFIRM_TITLE","buttons","text","CHANNEL_MESSAGE_DELETE_CONFIRM_CANCEL","CHANNEL_MESSAGE_DELETE_CONFIRM_OK","style","onPress","then","catch","TOAST","DELETE_MSG_ERROR","onPressDownloadButton","size","DOWNLOAD_START","save","fileUrl","fileName","name","response","DOWNLOAD_OK","log","err","DOWNLOAD_ERROR","createElement","flex","backgroundColor","background700","barStyle","animated","FILE_VIEWER","TITLE","subtitle","SUBTITLE","bottomInset","src","deleteShown"],"sources":["index.tsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { StatusBar } from 'react-native';\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\n\nimport { Box, useAlert, useHeaderStyle, useToast, useUIKitTheme } from '@sendbird/uikit-react-native-foundation';\nimport type { SendbirdFileMessage } from '@sendbird/uikit-utils';\nimport { Logger, getFileExtension, getFileType, isMyMessage, toMegabyte } from '@sendbird/uikit-utils';\n\nimport { useLocalization, usePlatformService, useSendbirdChat } from '../../hooks/useContext';\nimport FileViewerContent from './FileViewerContent';\nimport FileViewerFooter from './FileViewerFooter';\nimport FileViewerHeader from './FileViewerHeader';\n\ntype Props = {\n  fileMessage: SendbirdFileMessage;\n  deleteMessage: () => Promise<void>;\n\n  onClose: () => void;\n  onPressDownload?: (message: SendbirdFileMessage) => void;\n  onPressDelete?: (message: SendbirdFileMessage) => void;\n\n  headerShown?: boolean;\n  headerTopInset?: number;\n\n  /** This prop is only available on the Image viewer */\n  minZoom?: number;\n  /** This prop is only available on the Image viewer */\n  maxZoom?: number;\n};\n\nconst FileViewer = ({\n  headerShown = true,\n  maxZoom = 3,\n  minZoom = 1,\n  headerTopInset,\n  fileMessage,\n  onClose,\n  onPressDownload,\n  onPressDelete,\n  deleteMessage,\n}: Props) => {\n  const { topInset, statusBarTranslucent } = useHeaderStyle();\n  const { bottom } = useSafeAreaInsets();\n  const { palette } = useUIKitTheme();\n  const { alert } = useAlert();\n  const { show } = useToast();\n\n  const { fileService } = usePlatformService();\n  const { currentUser } = useSendbirdChat();\n  const { STRINGS } = useLocalization();\n\n  const fileType = getFileType(fileMessage.type || getFileExtension(fileMessage.url));\n  const canDelete = isMyMessage(fileMessage, currentUser?.userId);\n  const basicTopInset = statusBarTranslucent ? topInset : 0;\n\n  const onPressDeleteButton = () => {\n    if (!canDelete) return;\n\n    if (onPressDelete) {\n      onPressDelete(fileMessage);\n    } else {\n      alert({\n        title: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_TITLE,\n        buttons: [\n          {\n            text: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_CANCEL,\n          },\n          {\n            text: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_OK,\n            style: 'destructive',\n            onPress: () => {\n              deleteMessage()\n                .then(() => {\n                  onClose();\n                })\n                .catch(() => {\n                  show(STRINGS.TOAST.DELETE_MSG_ERROR, 'error');\n                });\n            },\n          },\n        ],\n      });\n    }\n  };\n\n  const onPressDownloadButton = () => {\n    if (onPressDownload) {\n      onPressDownload(fileMessage);\n    } else {\n      if (toMegabyte(fileMessage.size) > 4) {\n        show(STRINGS.TOAST.DOWNLOAD_START, 'success');\n      }\n\n      fileService\n        .save({ fileUrl: fileMessage.url, fileName: fileMessage.name, fileType: fileMessage.type })\n        .then((response) => {\n          show(STRINGS.TOAST.DOWNLOAD_OK, 'success');\n          Logger.log('File saved to', response);\n        })\n        .catch((err) => {\n          show(STRINGS.TOAST.DOWNLOAD_ERROR, 'error');\n          Logger.log('File save failure', err);\n        });\n    }\n  };\n\n  useEffect(() => {\n    if (fileType === 'file') onClose();\n  }, []);\n\n  return (\n    <Box flex={1} backgroundColor={palette.background700}>\n      <StatusBar barStyle={'light-content'} animated />\n      <FileViewerHeader\n        topInset={headerTopInset ?? basicTopInset}\n        headerShown={headerShown}\n        title={STRINGS.FILE_VIEWER.TITLE(fileMessage)}\n        subtitle={STRINGS.FILE_VIEWER.SUBTITLE(fileMessage)}\n        onClose={onClose}\n      />\n      <FileViewerContent\n        topInset={headerTopInset ?? basicTopInset}\n        bottomInset={bottom}\n        type={fileType}\n        src={fileMessage.url}\n        maxZoom={maxZoom}\n        minZoom={minZoom}\n      />\n      <FileViewerFooter\n        bottomInset={bottom}\n        deleteShown={canDelete}\n        onPressDelete={onPressDeleteButton}\n        onPressDownload={onPressDownloadButton}\n      />\n    </Box>\n  );\n};\n\nexport default FileViewer;\n"],"mappings":"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"}