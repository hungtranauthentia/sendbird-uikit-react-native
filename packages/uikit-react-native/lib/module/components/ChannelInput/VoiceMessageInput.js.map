{"version":3,"names":["React","useEffect","useRef","Animated","Box","Icon","PressBox","ProgressBar","Text","createStyleSheet","useUIKitTheme","conditionChaining","millsToMMSS","useLocalization","useVoiceMessageInput","VoiceMessageInput","_ref","onClose","onSend","STRINGS","colors","actions","state","file","duration","uiColors","ui","voiceMessageInput","default","status","onPressCancel","cancel","onPressSend","send","onPressVoiceMessageAction","startRecording","lessThanMinimumDuration","stopRecording","playPlayer","pausePlayer","renderActionIcon","createElement","icon","size","color","recording","actionIcon","isRecorderState","recordingTime","currentTime","minDuration","remainingTime","playingTime","backgroundColor","background","paddingVertical","paddingHorizontal","style","styles","container","progressBar","current","total","maxDuration","trackColor","progressTrack","overlay","flex","flexDirection","alignItems","justifyContent","paddingRight","RecordingLight","visible","caption1","lineHeight","undefined","marginLeft","textTime","height","CancelButton","label","LABELS","VOICE_MESSAGE_INPUT_CANCEL","onPress","SendButton","disabled","position","activeOpacity","width","borderRadius","actionIconBackground","props","value","Value","animation","loop","sequence","timing","toValue","useNativeDriver","start","reset","View","opacity","active","button","textCancel","numberOfLines","sendIconBackground","padding","sendIcon","borderTopLeftRadius","borderTopRightRadius","marginBottom"],"sources":["VoiceMessageInput.tsx"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport { Animated } from 'react-native';\n\nimport {\n  Box,\n  Icon,\n  PressBox,\n  ProgressBar,\n  Text,\n  createStyleSheet,\n  useUIKitTheme,\n} from '@sendbird/uikit-react-native-foundation';\nimport { conditionChaining, millsToMMSS } from '@sendbird/uikit-utils';\n\nimport { useLocalization } from '../../hooks/useContext';\nimport useVoiceMessageInput from '../../hooks/useVoiceMessageInput';\nimport type { FileType } from '../../platform/types';\n\nexport type VoiceMessageInputProps = {\n  onClose: () => Promise<void>;\n  onSend: (params: { file: FileType; duration: number }) => void;\n};\n\nconst VoiceMessageInput = ({ onClose, onSend }: VoiceMessageInputProps) => {\n  const { STRINGS } = useLocalization();\n  const { colors } = useUIKitTheme();\n  const { actions, state } = useVoiceMessageInput({\n    onSend: (file, duration) => onSend({ file, duration }),\n    onClose,\n  });\n\n  const uiColors = colors.ui.voiceMessageInput.default[state.status !== 'idle' ? 'active' : 'inactive'];\n\n  const onPressCancel = async () => {\n    actions.cancel();\n    onClose();\n  };\n\n  const onPressSend = async () => {\n    actions.send();\n    onClose();\n  };\n\n  const onPressVoiceMessageAction = () => {\n    switch (state.status) {\n      case 'idle':\n        actions.startRecording();\n        break;\n      case 'recording':\n        if (lessThanMinimumDuration) {\n          actions.cancel();\n        } else {\n          actions.stopRecording();\n        }\n        break;\n      case 'recording_completed':\n      case 'playing_paused':\n        actions.playPlayer();\n        break;\n      case 'playing':\n        actions.pausePlayer();\n        break;\n    }\n  };\n  const renderActionIcon = () => {\n    switch (state.status) {\n      case 'idle':\n        return <Icon icon={'recording'} size={20} color={uiColors.recording} />;\n      case 'recording':\n        return <Icon icon={'stop'} size={20} color={uiColors.actionIcon} />;\n      case 'recording_completed':\n      case 'playing_paused':\n        return <Icon icon={'play'} size={20} color={uiColors.actionIcon} />;\n      case 'playing':\n        return <Icon icon={'pause'} size={20} color={uiColors.actionIcon} />;\n    }\n  };\n\n  const isRecorderState = state.status === 'recording' || state.status === 'recording_completed';\n  const lessThanMinimumDuration = state.recordingTime.currentTime < state.recordingTime.minDuration;\n  const remainingTime = state.playingTime.duration - state.playingTime.currentTime;\n\n  return (\n    <Box backgroundColor={uiColors.background} paddingVertical={24} paddingHorizontal={16} style={styles.container}>\n      {/** Progress bar **/}\n      <ProgressBar\n        style={styles.progressBar}\n        current={conditionChaining(\n          [state.status === 'recording', state.status === 'recording_completed'],\n          [state.recordingTime.currentTime, 0, state.playingTime.currentTime],\n        )}\n        total={(isRecorderState ? state.recordingTime.maxDuration : state.playingTime.duration) || 1}\n        trackColor={uiColors.progressTrack}\n        overlay={\n          <Box flex={1} flexDirection={'row'} alignItems={'center'} justifyContent={'flex-end'} paddingRight={16}>\n            <RecordingLight visible={state.status === 'recording'} />\n            <Text caption1 style={{ lineHeight: undefined, marginLeft: 6 }} color={uiColors.textTime}>\n              {millsToMMSS(isRecorderState ? state.recordingTime.currentTime : remainingTime)}\n            </Text>\n          </Box>\n        }\n      />\n\n      <Box height={34} alignItems={'center'} justifyContent={'center'}>\n        {/** Cancel / Send **/}\n        <Box flexDirection={'row'}>\n          <CancelButton label={STRINGS.LABELS.VOICE_MESSAGE_INPUT_CANCEL} onPress={onPressCancel} />\n          <Box flex={1} />\n          <SendButton disabled={state.status === 'idle' || lessThanMinimumDuration} onPress={onPressSend} />\n        </Box>\n\n        {/** Record / Stop / Play / Pause **/}\n        <Box style={{ position: 'absolute' }} alignItems={'center'} justifyContent={'center'}>\n          <PressBox activeOpacity={0.5} onPress={onPressVoiceMessageAction}>\n            <Box\n              width={34}\n              height={34}\n              borderRadius={17}\n              alignItems={'center'}\n              justifyContent={'center'}\n              backgroundColor={uiColors.actionIconBackground}\n            >\n              {renderActionIcon()}\n            </Box>\n          </PressBox>\n        </Box>\n      </Box>\n    </Box>\n  );\n};\n\nconst RecordingLight = (props: { visible: boolean }) => {\n  const { colors } = useUIKitTheme();\n\n  const value = useRef(new Animated.Value(0)).current;\n  const animation = useRef(\n    Animated.loop(\n      Animated.sequence([\n        Animated.timing(value, { toValue: 1, duration: 500, useNativeDriver: true }),\n        Animated.timing(value, { toValue: 0, duration: 500, useNativeDriver: true }),\n      ]),\n    ),\n  ).current;\n\n  useEffect(() => {\n    if (props.visible) animation.start();\n    return () => {\n      animation.reset();\n    };\n  }, [props.visible]);\n\n  if (!props.visible) return null;\n  return (\n    <Animated.View\n      style={{\n        width: 12,\n        height: 12,\n        borderRadius: 6,\n        opacity: value,\n        backgroundColor: colors.ui.voiceMessageInput.default.active.recording,\n      }}\n    />\n  );\n};\n\nconst CancelButton = (props: { onPress: () => void; label: string }) => {\n  const { colors } = useUIKitTheme();\n\n  return (\n    <PressBox activeOpacity={0.8} onPress={props.onPress}>\n      <Box paddingHorizontal={12} height={'100%'} alignItems={'center'} justifyContent={'center'}>\n        <Text button color={colors.ui.voiceMessageInput.default.active.textCancel} numberOfLines={1}>\n          {props.label}\n        </Text>\n      </Box>\n    </PressBox>\n  );\n};\n\nconst SendButton = (props: { onPress: () => void; disabled: boolean }) => {\n  const { colors } = useUIKitTheme();\n\n  const uiColors = colors.ui.voiceMessageInput.default[props.disabled ? 'inactive' : 'active'];\n\n  return (\n    <PressBox disabled={props.disabled} activeOpacity={0.8} onPress={props.onPress}>\n      <Box backgroundColor={uiColors.sendIconBackground} padding={7} borderRadius={40}>\n        <Icon icon={'send'} size={20} color={uiColors.sendIcon} />\n      </Box>\n    </PressBox>\n  );\n};\n\nconst styles = createStyleSheet({\n  container: {\n    borderTopLeftRadius: 8,\n    borderTopRightRadius: 8,\n  },\n  progressBar: {\n    height: 36,\n    marginBottom: 16,\n    borderRadius: 18,\n  },\n});\n\nexport default VoiceMessageInput;\n"],"mappings":"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"}